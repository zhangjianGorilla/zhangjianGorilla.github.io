<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>MySQL 基础 | 个人文档</title><meta name="author" content="Zhang Jian"><meta name="copyright" content="Zhang Jian"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="一、数据库概述1. RDBMS 与 非 RDBMS1.1 关系型数据库 (RDBMS)实质：  这种类型的数据库是最古老的数据库类型，关系型数据库是把复杂的数据结构归结为简单的二元关系 (即二维表格形式)。 关系型数据库以 行（row） 和 列 (column) 的形式存储数据，以便于用户理解。这一系列的行和列被称为表 (table)，一组表组成了一个 库 (database)。 表与表之间的数据">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL 基础">
<meta property="og:url" content="http://example.com/2022/10/25/mysql-basic/index.html">
<meta property="og:site_name" content="个人文档">
<meta property="og:description" content="一、数据库概述1. RDBMS 与 非 RDBMS1.1 关系型数据库 (RDBMS)实质：  这种类型的数据库是最古老的数据库类型，关系型数据库是把复杂的数据结构归结为简单的二元关系 (即二维表格形式)。 关系型数据库以 行（row） 和 列 (column) 的形式存储数据，以便于用户理解。这一系列的行和列被称为表 (table)，一组表组成了一个 库 (database)。 表与表之间的数据">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://1.117.162.142:9000/blog/cover.jpeg">
<meta property="article:published_time" content="2022-10-25T01:58:40.000Z">
<meta property="article:modified_time" content="2022-12-18T05:23:59.240Z">
<meta property="article:author" content="Zhang Jian">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://1.117.162.142:9000/blog/cover.jpeg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2022/10/25/mysql-basic/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-right"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MySQL 基础',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-12-18 13:23:59'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/universe.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-categories-card@1.0.0/lib/categorybar.css"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css" /><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://1.117.162.142:9000/blog/avatar.jpg%2020-56-02-100.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">15</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">18</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('http://1.117.162.142:9000/blog/cover.jpeg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">个人文档</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MySQL 基础</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-10-25T01:58:40.000Z" title="发表于 2022-10-25 09:58:40">2022-10-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-12-18T05:23:59.240Z" title="更新于 2022-12-18 13:23:59">2022-12-18</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">48.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>167分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="MySQL 基础"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="一、数据库概述"><a href="#一、数据库概述" class="headerlink" title="一、数据库概述"></a>一、数据库概述</h2><h3 id="1-RDBMS-与-非-RDBMS"><a href="#1-RDBMS-与-非-RDBMS" class="headerlink" title="1. RDBMS 与 非 RDBMS"></a>1. RDBMS 与 非 RDBMS</h3><h4 id="1-1-关系型数据库-RDBMS"><a href="#1-1-关系型数据库-RDBMS" class="headerlink" title="1.1 关系型数据库 (RDBMS)"></a>1.1 关系型数据库 (RDBMS)</h4><p>实质：</p>
<ul>
<li>这种类型的数据库是<code>最古老</code>的数据库类型，关系型数据库是把复杂的数据结构归结为简单的<code>二元关系</code> (即二维表格形式)。</li>
<li>关系型数据库以 <code>行（row）</code> 和 <code>列 (column)</code> 的形式存储数据，以便于用户理解。这一系列的行和列被称为<code>表 (table)</code>，一组表组成了一个 <code>库 (database)</code>。</li>
<li>表与表之间的数据记录有关系 (relationship)。现实世界中的各种实体以及实体之间的各种联系均用 <code>关系模型</code> 来表示。关系型数据库，就是建立在 <code>关系模型</code> 基础上的数据库。</li>
<li>SQL 就是关系型数据库的查询语言。</li>
</ul>
<p>优势：</p>
<ul>
<li><p>复杂查询</p>
<p>  可以用 SQL 语句方便的在一个表以及多个表之间做非常复杂的数据查询。</p>
</li>
<li><p>事物支持</p>
<p>  使得对于安全性能很高的数据访问要求得以实现。</p>
</li>
</ul>
<h4 id="1-2-非关系型数据库-非RDBMS"><a href="#1-2-非关系型数据库-非RDBMS" class="headerlink" title="1.2 非关系型数据库 (非RDBMS)"></a>1.2 非关系型数据库 (非RDBMS)</h4><p>非关系型数据库，可以看成传统关系型数据库的功能<code>阉割版本</code>，基于键值对存储数据，不需要经过 SQL 层的解析，<code>性能非常高</code>。同时，通过减少不常用的功能，进一步提高性能。目前基本上大部分主流的非关系型数据库都是免费的。</p>
<p>相比于 SQL，NoSQL 泛指非关系型数据库，包括了键值型数据库、文档型数据库、搜索引擎和列存储等，除此之外还包括徒刑数据库。也只有用 NoSQL 一词才能将这些技术囊括进来。</p>
<p><strong>键值型数据库</strong></p>
<p>间质性数据库通过 Key - Value 键值的方式来存储数据，其中 Key 和 Value 可以是简单的对象，也可以是复杂的对象。Key 作为唯一的标识符，有点事查找速度快，在这方面明显优于关系型数据库，缺点是无法像关系型数据库一样使用条件过滤 (比如 WHERE)，如果不知道去哪里找数据，就要遍历所有的键，这就回消耗大量的计算。键值型数据库典型的使用场景是作为<code>内存缓存</code>。<code>Redis</code> 是最流行的键值型数据库。</p>
<p><strong>文档型数据库</strong></p>
<p>此类数据库可存放并获取文档，可以是 XML、JSON 等格式。在数据库中文档作为处理信息的基本单位，一个文档就相当于一条记录。文档数据库所存放的文档，就相当于兼职数据库所存放的“值”。<code>MongoDB</code> 是最流行的文档行数据库，此外，还有 CouchDB等。</p>
<p><strong>搜索引擎数据库</strong></p>
<p>虽然关系型数据库采用了索引提升检索效率，但是针对全文索引效率却较低。搜索引擎数据库是应用在搜索引擎领域的数据存储形式，由于搜索引擎会爬取大量的数据，并以特定的格式进行存储，这样在检索的时候才能保证性能最优。核心原理是<strong>倒排索引</strong>。典型产品：<code>Solr</code>、<code>Elasticsearch</code>、<code>Splunk</code> 等。</p>
<p><strong>列式数据库</strong></p>
<p>列式数据库是相对于行式存储的数据库，Oracle、MySQL、SQL Server 等数据库都是采用的行式存储 (Row-based)，而列式数据库是将数据按列式存储到数据库中，这样做的好处是可以大量降低系统的 I&#x2F;O，适合于分布式文件系统，不足在于功能相对有限。典型产品：<code>HBase</code> 等。</p>
<p><strong>图形数据库</strong></p>
<p>图形数据库，利用了图这种数据结构存储了实体 (对象) 之间的关系。徒刑数据库最典型的例子就是社交网络中人与人的关系，数据模型主要是以节点和边 (关系) 来实现，特点在于能高效地解决复杂的关系问题。图形数据库顾名思义，就是一种存储图形关系的数据库。它利用了图这种数据结构存储了实体 (对象) 之间的关系。关系型数据用于存储明确关系的数据，但对于复杂关系的数据存储却有些力不从心。如社交网络中人物之间的关系，如果用关系型数据库则非常复杂，用图形数据库将非常简单。典型产品：<code>Neo4J</code>、<code>InfoGrid</code> 等。</p>
<p><strong>NoSQL 的演变</strong></p>
<p>由于 SQL 一直称霸 DBMS，因此许多人在思考是否有一种数据库技术能远离 SQL，于是 NoSQL 诞生了，但是随着发展却发现越来越离不开 SQL。到目前为止 NoSQL 阵营中的 DBMS 都会有实现类似 SQL 的功能。下面是 NoSQL 这个名次在不同时期的诠释，从这些释义的变化中可以看出 <code>NoSQL 功能的演变</code>：</p>
<ul>
<li>1970: NoSQL &#x3D; We have no SQL</li>
<li>1980: NoSQL &#x3D; Know SQL</li>
<li>2000: NoSQL &#x3D; No SQL!</li>
<li>2005: NoSQL &#x3D; Not only SQL</li>
<li>2013: NoSQL &#x3D; No, SQL!</li>
</ul>
<p>NoSQL 对 SQL 做出了很好的补充，比如实际开发中，有很多业务需求，其实并不需要完整的关系型数据库功能，非关系型数据库的功能就足够使用了。这种情况下，使用 <code>性能更高、成本更低</code> 的非关系型数据库当然是更明智的选择。比如：日志搜集、排行榜、定时器等。</p>
<h3 id="2-关系型数据库设计规则"><a href="#2-关系型数据库设计规则" class="headerlink" title="2. 关系型数据库设计规则"></a>2. 关系型数据库设计规则</h3><ul>
<li>关系型数据库的典型数据结构就是<strong>数据表</strong>，这些数据表的组成都是结构化的 (Structured)。</li>
<li>将数据放到表中，表再放到库中。</li>
<li>一个数据库中可以有多个表，每个表都有一个名字，用来标识自己。表名具有唯一性。</li>
<li>表具有一些特性，这些特性定义了数据在表中如何存储，类似 Java 和 Python 中“类”的设计。</li>
</ul>
<h4 id="2-1-表、记录、字段"><a href="#2-1-表、记录、字段" class="headerlink" title="2.1 表、记录、字段"></a>2.1 表、记录、字段</h4><ul>
<li>E-R (entity-relationship，实体-联系) 模型中有三个主要概念是：<code>实体集</code>、<code>属性</code>、<code>联系集</code>。</li>
<li>一个实体集 (class) 对应于数据库中的一个表 (table)，一个实体 (instance) 则对应数据库表中的一行 (row)，也称为一条记录 (record)。一个属性 (arrtibute) 对应数据库表中的一列 (column)，也称为一个字段 (field)。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ORM 思想 (Object Relationship Mapping) 体现：</span><br><span class="line">数据库中的一个表  &lt;----&gt;  Java 或 Python 中的一个类</span><br><span class="line">表中的一条数据  &lt;----&gt;  类中的一个对象 (或实体)</span><br><span class="line">表中的一个列。&lt;----&gt;  类中的一个字段、属性 (field)</span><br></pre></td></tr></table></figure>

<h4 id="2-2-表的关联关系"><a href="#2-2-表的关联关系" class="headerlink" title="2.2 表的关联关系"></a>2.2 表的关联关系</h4><ul>
<li><p>表与表之间的数据记录有关系 (relationship)。现实世界中的各种实体以及实体之间的各种联系均用关系模型来表示。</p>
</li>
<li><p>四种：</p>
<ul>
<li><p>一对一关联</p>
<p>  在实际的开发中应用不多，因为一对一可以创建成一张表。两种建表原则：外键唯一、外键是主键</p>
</li>
<li><p>一对多关联</p>
<p>  常见实例场景：客户表和订单表、分类表和商品表、部门表和员工表。一对多建表原则：在从表创建一个字段，字段作为外键指向主表的主键。</p>
</li>
<li><p>多对多关联</p>
<p>  要表示多对多关系，必须创建第三个表，该表通常称为联接表，它将多对多关系划分为两个一对多关系。将这两个表的主键都插入到第三个表中。</p>
</li>
<li><p>自我引用</p>
</li>
</ul>
</li>
</ul>
<h2 id="二、MySQL-安装"><a href="#二、MySQL-安装" class="headerlink" title="二、MySQL 安装"></a>二、MySQL 安装</h2><p>下载地址: <a target="_blank" rel="noopener" href="https://dev.mysql.com/downloads/mysql/">https://dev.mysql.com/downloads/mysql/</a></p>
<h3 id="1-检查是否安装-MySQL，并卸载"><a href="#1-检查是否安装-MySQL，并卸载" class="headerlink" title="1. 检查是否安装 MySQL，并卸载"></a>1. 检查是否安装 MySQL，并卸载</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查安装包</span></span><br><span class="line">rpm -qa | grep -i mysql. <span class="comment"># i 忽略大小写</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查mysql服务</span></span><br><span class="line">systemctl status mysqld.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 卸载</span></span><br><span class="line"><span class="comment"># 关闭mysql服务</span></span><br><span class="line">systemctl stop mysqld.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前mysql安装状况</span></span><br><span class="line">rpm -qa | grep -i mysql</span><br><span class="line">或</span><br><span class="line">yum list installed | grep mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 卸载上述命令查询出来的已安装程序</span></span><br><span class="line">yum remove mysql-xxx mysql-xxx mysql-xxx mysql-xxx. <span class="comment"># 务必卸载干净，反复执行rpm -qa | grep -i mysql确认是否有残留</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除mysql相关文件</span></span><br><span class="line">find / -name mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除上述命令查找出的相关文件</span></span><br><span class="line"><span class="built_in">rm</span> -rf xxx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除 my.cnf</span></span><br><span class="line"><span class="built_in">rm</span> -rf /etc/my.conf</span><br></pre></td></tr></table></figure>

<h3 id="2-安装"><a href="#2-安装" class="headerlink" title="2. 安装"></a>2. 安装</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 由于mysql安装过程中，会通过mysql用户在/tmp目录下新建tmp_db文件，所以给/tmp较大的权限。</span></span><br><span class="line"><span class="built_in">chmod</span> -R 777 /tmp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装前，检查依赖</span></span><br><span class="line">rpm -qa | grep libaio</span><br><span class="line">rpm -qa | grep net-tools</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按顺序安装</span></span><br><span class="line">rpm -ivh mysql-community-common-xxx.rpm</span><br><span class="line">rpm -ivh mysql-community-client-plugins-xxx.rpm</span><br><span class="line">rpm -ivh mysql-community-libs-xxx.rpm</span><br><span class="line">rpm -ivh mysql-community-client-xxx.rpm</span><br><span class="line">rpm -ivh mysql-community-server-xxx.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装过程可能存在错误信息</span></span><br><span class="line">mariadb-libs 被 mysql-community-libs-xxx 取代</span><br><span class="line"><span class="comment"># 执行 yum remove mysql-libs 解决，清除之前安装过的依赖即可。</span></span><br></pre></td></tr></table></figure>

<h3 id="3-查看-MySQL-版本"><a href="#3-查看-MySQL-版本" class="headerlink" title="3. 查看 MySQL 版本"></a>3. 查看 MySQL 版本</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql --version</span><br><span class="line">或</span><br><span class="line">mysqladmin --version</span><br><span class="line"><span class="comment"># 检车是否安装成功</span></span><br><span class="line">rpm -qa | grep -i mysql</span><br></pre></td></tr></table></figure>

<h3 id="4-服务的初始化"><a href="#4-服务的初始化" class="headerlink" title="4. 服务的初始化"></a>4. 服务的初始化</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 为了保证数据库目录与文件的所有者为 mysql 登录用户，如果你是以root身份运行mysql服务，需要执行下面的命令初始化</span></span><br><span class="line">mysqld --initialize --user=mysql</span><br><span class="line"><span class="comment"># --initialize 选项默认以安全模式来初始化，则会为root用户生成一个密码并将改密码标记为过期，登录后需要设置一个新的密码，生成的临时密码会往日志中记录一份。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看密码</span></span><br><span class="line"><span class="built_in">cat</span> /var/log/mysqld.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看服务状态</span></span><br><span class="line">systemctl status mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动服务</span></span><br><span class="line">systemctl start mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看进程</span></span><br><span class="line">ps -ef | grep -i mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看mysql服务是否自动自动</span></span><br><span class="line">systemctl list-unit-files | grep mysqld.service <span class="comment"># 默认是enabled</span></span><br><span class="line"><span class="comment"># 如果不是 enable </span></span><br><span class="line">systemctl <span class="built_in">enable</span> mysqld.service</span><br><span class="line"><span class="comment"># 如果不希望自启动</span></span><br><span class="line">systemctl <span class="built_in">disable</span> mysqld.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录mysql</span></span><br><span class="line">mysql -uroot -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改密码</span></span><br><span class="line">ALTER USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;new_password&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="5-远程登录"><a href="#5-远程登录" class="headerlink" title="5. 远程登录"></a>5. 远程登录</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看网络是否畅通</span></span><br><span class="line">ping ip地址</span><br><span class="line"><span class="comment"># 远程访问端口,保证端口开放</span></span><br><span class="line">telnet ip地址 端口号</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭防火墙或打开端口</span></span><br><span class="line">systemctl stop firewalld.service</span><br><span class="line"><span class="comment"># 查看开放的端口号</span></span><br><span class="line">firewalld-cmd --list-all</span><br><span class="line"><span class="comment"># 设置开放的端口号</span></span><br><span class="line">firewall-cmd --add-service=http --permanent</span><br><span class="line">firewall-cmd --add-port=3306/tcp --permanent</span><br><span class="line"><span class="comment"># 重启防火墙</span></span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置mysql允许远程登录，默认是不允许</span></span><br><span class="line">use mysql;</span><br><span class="line">SELECT host,user FROM user;</span><br><span class="line">UPDATE user SET host=<span class="string">&#x27;%&#x27;</span> WHERE user = <span class="string">&#x27;root&#x27;</span>;</span><br><span class="line"><span class="comment"># 刷新权限</span></span><br><span class="line">flush privileges;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置新连接报错：错误号码：2058，原因是mysql密码加密方式变了，只会在mysql8版本中出现</span></span><br><span class="line">ALTER USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED WITH mysql_native_password BY <span class="string">&#x27;密码&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="6-数据目录"><a href="#6-数据目录" class="headerlink" title="6. 数据目录"></a>6. 数据目录</h3><ul>
<li><p>InnoDB 存储引擎，会在 data\数据库名 目录中产生一个或者两个文件：</p>
<ul>
<li>Xxx.frm文件：描述表结构文件，字段长度等</li>
<li>如果采用<strong>系统表空间</strong>模式，数据信息和索引信息都存储在 <code>ibdata1</code> 中</li>
<li>如果采用<strong>独立表空间</strong>存储模式，会在data\数据库名 中还产生<code>xxx.ibd</code> 文件 (存储数据信息和索引信息)</li>
</ul>
<p>  MySQL 5.7 中会在 data\数据库名 目录下生成db.opt 文件用于保存数据库的相关配置。比如字符集、比较规则。而 MySQL 8.0 不再提供 db.opt 文件，而是合并在 <code>.ibd</code> 文件中。</p>
</li>
<li><p>MyISAM 存储引擎，data\数据库名 文件夹中会产生三个文件：</p>
<ul>
<li>MySQL 5.7 中：xxx.frm：描述表结构文件，字段长度等。</li>
<li>MySQL 8.0 中 xxx.xxx.sdi：描述表结构文件，字段长度等</li>
<li>xxx.MYD (MYData)：数据信息文件，存储数据信息 (如果采用独立表存储模式)</li>
<li>x x x.MYI (MYIndex)：存放索引信息文件</li>
</ul>
</li>
</ul>
<h2 id="三、SQL-概述"><a href="#三、SQL-概述" class="headerlink" title="三、SQL 概述"></a>三、SQL 概述</h2><p> SQL 是用于访问和处理数据库的标准的计算机语言。</p>
<h3 id="1-SQL-的分类"><a href="#1-SQL-的分类" class="headerlink" title="1. SQL 的分类"></a>1. SQL 的分类</h3><ul>
<li>DDL (Data Definition Language，数据定义语言)，这些语句定义了不同的数据库、表、视图、索引等数据库对象，还可以用来创建、删除、修改数据库和数据表的结构。<ul>
<li>主要的语句关键字包括：CREATE、ALTER、DROP、RENAME、TRUNCATE 等。</li>
</ul>
</li>
<li>DML (Data Manipulation Language， 数据操作语言)，用于添加、删除、更新和查找数据库记录，并检查数据完整性。<ul>
<li>主要的语句关键字包括：INSERT、DELETE、UPDATE、SELECT 等。</li>
<li><strong>SELECT 是 SQL 语言的基础，最为重要</strong>。</li>
</ul>
</li>
<li>DCL (Data Control Language，数据控制语言)，用于定义数据库、表、字段、用户的访问权限和安全级别。<ul>
<li>主要的语句关键字包括：COMMIT、ROLLBACK、SACEPOINT、GRANT、REVOKE 等。</li>
</ul>
</li>
</ul>
<h3 id="2-SQL-语言的规则和规范"><a href="#2-SQL-语言的规则和规范" class="headerlink" title="2. SQL 语言的规则和规范"></a>2. SQL 语言的规则和规范</h3><h4 id="2-1-基本规则"><a href="#2-1-基本规则" class="headerlink" title="2.1 基本规则"></a>2.1 基本规则</h4><ul>
<li>SQL 可以写在一行或者多行。为了提高可读性，各子句分行写，必要时使用缩进</li>
<li>每条命令以 “;” 或 \g 或 \G 结束</li>
<li>关键字不能被缩写也不能分行</li>
<li>关于标点符号<ul>
<li>必须保证所有的 ()、单引号、双引号是成对结束的</li>
<li>必须使用英文状态下的半角输入方式</li>
<li>字符串行和日期类型的数据可以使用单引号 (‘ ‘) 表示</li>
<li>列的别名，尽量使用双引号 (“ “)，而且不建议省略 as</li>
</ul>
</li>
</ul>
<h4 id="2-2-SQL大小写规范"><a href="#2-2-SQL大小写规范" class="headerlink" title="2.2 SQL大小写规范"></a>2.2 SQL大小写规范</h4><ul>
<li>MySQL 在 Windows 环境下是大小写不敏感的</li>
<li>MySQL 在 Linux 环境下是大小写敏感的<ul>
<li>数据库名、表名、表的别名、变量名是严格区分大小写的</li>
<li>关键字、函数名、列名 (或字段名)、列的别名 (字段的别名) 是忽略大小写的。</li>
</ul>
</li>
<li>推荐采用统一的书写规范：<ul>
<li>数据库名、表名、表别名、字段名、字段别名等都小写</li>
<li>SQL 关键字、函数名、绑定变量等都大写</li>
</ul>
</li>
</ul>
<h4 id="2-3-注释"><a href="#2-3-注释" class="headerlink" title="2.3 注释"></a>2.3 注释</h4><p>可以使用如下格式的注释结构</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#单行注释</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 单行注释，--后必须空格</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">多行注释</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h4 id="2-4-命名规则"><a href="#2-4-命名规则" class="headerlink" title="2.4 命名规则"></a>2.4 命名规则</h4><ul>
<li>数据库、表名不得超过 30 个字符，变量名限制为 29 个。</li>
<li>必须只能包含 A-Z，a-z，0-9，_ 共63个字符。</li>
<li>数据库名、表名、字段名等对象名中间不要包含空格。</li>
<li>同一个 MySQL 软件中，数据库不能同名，同一个库中，表不能重名，同一个表中，字段不能重名。</li>
<li>必须保证字段没有和保留字、数据库系统或常用方法冲突。如果坚持使用，请在 SQL 语句中使用 &#96;&#96; 引起来。</li>
<li>保持字段名和类型的一致性，在命名字段并为其制定数据类型的时候一定要保证一致性。加入数据类型在一个表里是整数，在另一个表里也一定要是整数。</li>
</ul>
<h3 id="3-最基本的-SELECT-语句"><a href="#3-最基本的-SELECT-语句" class="headerlink" title="3. 最基本的 SELECT 语句"></a>3. 最基本的 SELECT 语句</h3><ul>
<li><p><code>SELECT ···</code></p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span><span class="operator">+</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span><span class="operator">+</span><span class="number">1</span> <span class="keyword">FROM</span> DUAL;  # DUAL 伪表</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>SELECT 字段名1, 字段名2, ··· FROM 表名</code></p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name, age, six <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>SELECT 字段名 AS 别名 FROM 表名</code></p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> u_name name, u_age <span class="keyword">AS</span> age, u_six <span class="keyword">AS</span> &quot;six&quot; <span class="keyword">from</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure>

<p>   别名用 “ “，不要用 ‘ ‘ 号。AS 可省略。</p>
</li>
<li><p>去重：<code>SELECT DISTINCT 字段名 FROM 表名;</code></p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> age <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>空值 (NULL) 参与运算</p>
<p>  NULL 不等于 0、” “、”NULL”，代表暂时没有值，NULL 参与运算，结果也为 NULL。例如：</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> age <span class="operator">+</span> <span class="number">2</span> <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure>

<p>  如果有一条记录的 age 为 NULL，那么执行 SQL 后，这条记录的结果仍然是 NULL。可以通过IFNULL() 函数给 NULL 赋值。</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> IFNULL(age, <span class="number">0</span>) <span class="operator">+</span> <span class="number">2</span> <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure>

<p>  IFNULL() 会先判断 age 的值，如果为 NULL，则赋值为 0。</p>
</li>
<li><p>着重号 &#96;&#96;</p>
<p>  如果字段名或着表名与关键字相同，则需要用 &#96;&#96; 将字段名或表名引起来。例如：</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> total <span class="keyword">FROM</span> `<span class="keyword">order</span>`;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询常数</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> `熊猫` <span class="keyword">AS</span> name, last_name <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>显示表结构 <code>DESCRIBE 表名</code> 或 <code>DESC 表名</code></p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DESCRIBE</span> <span class="keyword">user</span>；</span><br><span class="line">或</span><br><span class="line"><span class="keyword">DESC</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>过滤数据</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> age <span class="operator">&lt;</span> <span class="number">20</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> age <span class="operator">&lt;</span> <span class="number">20</span> <span class="keyword">AND</span> six <span class="operator">=</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="四、运算符"><a href="#四、运算符" class="headerlink" title="四、运算符"></a>四、运算符</h2><h3 id="1-算术运算符"><a href="#1-算术运算符" class="headerlink" title="1. 算术运算符"></a>1. 算术运算符</h3><table>
<thead>
<tr>
<th align="center">运算符</th>
<th align="center">名称</th>
<th align="center">作用</th>
<th align="center">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="center">+</td>
<td align="center">加法运算符</td>
<td align="center">计算两个值或表达式的和</td>
<td align="center">SELECT A + B</td>
</tr>
<tr>
<td align="center">-</td>
<td align="center">减法运算符</td>
<td align="center">计算两个值或表达式的差</td>
<td align="center">SELECT A - B</td>
</tr>
<tr>
<td align="center">*</td>
<td align="center">乘法运算符</td>
<td align="center">计算两个值或表达式的乘积</td>
<td align="center">SELECT A * B</td>
</tr>
<tr>
<td align="center">&#x2F; 或 DIV</td>
<td align="center">除法运算符</td>
<td align="center">计算两个值或表达式的商</td>
<td align="center">SELECT A &#x2F; B, C DIV D</td>
</tr>
<tr>
<td align="center">% 或 MOD</td>
<td align="center">求模 (取余) 运算符</td>
<td align="center">计算两个值或表达式的余数</td>
<td align="center">SELECT A % B, C MOD D</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># <span class="operator">+</span>、<span class="operator">-</span>、<span class="operator">*</span>、<span class="operator">/</span> (或 DIV)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span> <span class="operator">+</span> <span class="number">1</span>, <span class="number">2</span> <span class="operator">-</span> <span class="number">1</span>, <span class="number">3</span> <span class="operator">*</span> <span class="number">2</span>, <span class="number">4</span> <span class="operator">/</span> <span class="number">2</span>, <span class="number">5</span> DIV <span class="number">2</span>, <span class="number">5</span> DIV <span class="number">0</span> <span class="keyword">FROM</span> DUAL;</span><br><span class="line"># 取模运算 <span class="operator">%</span> 或 MOD</span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">4</span> <span class="operator">%</span> <span class="number">3</span>, <span class="number">-41</span> <span class="operator">%</span> <span class="number">2</span>, <span class="number">-42</span> <span class="operator">%</span> <span class="number">-4</span>, <span class="number">33</span> MOD <span class="number">-4</span> <span class="keyword">FROM</span> DUAL; # 结果的符号与被模值的符号相同</span><br></pre></td></tr></table></figure>

<h3 id="2-比较运算符"><a href="#2-比较运算符" class="headerlink" title="2. 比较运算符"></a>2. 比较运算符</h3><p>比较运算符用来对表达式左边的操作数和右边的操作数进行比较，比较的结果为真则返回 1，比较的结果为假则返回 0，其他情况则返回 NULL。</p>
<table>
<thead>
<tr>
<th align="center">运算符</th>
<th align="center">名称</th>
<th align="center">作用</th>
<th align="center">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="center">&#x3D;</td>
<td align="center">等于运算符</td>
<td align="center">判断两个值、字符串或表达式是否相等</td>
<td align="center">SELECT c FROM b WHERE a &#x3D; d</td>
</tr>
<tr>
<td align="center">&lt;&#x3D;&gt;</td>
<td align="center">安全等于运算符</td>
<td align="center">安全地判断两个值、字符串或表达式是否相等</td>
<td align="center">SELECT c FROM d WHERE a &lt;&#x3D;&gt; b</td>
</tr>
<tr>
<td align="center">&lt;&gt; 或 !&#x3D;</td>
<td align="center">不等于运算符</td>
<td align="center">判断两个值、字符串或表达式是否不相等</td>
<td align="center">SELECT c FROM d WHERE a &lt;&gt;b</td>
</tr>
<tr>
<td align="center">&lt;</td>
<td align="center">小于运算符</td>
<td align="center">判断前面的值、字符串或表达式是否小于后面的值、字符串或表达式</td>
<td align="center">SELECT c FROM d WHERE a &lt; b</td>
</tr>
<tr>
<td align="center">&gt;</td>
<td align="center">大于运算符</td>
<td align="center">判断前面的值、字符串或表达式是否大于后面的值、字符串或表达式</td>
<td align="center">SELECT c FROM d WHERE a &gt; b</td>
</tr>
<tr>
<td align="center">&lt;&#x3D;</td>
<td align="center">小于等于运算符</td>
<td align="center">判断前面的值、字符串或表达式是否小于等于后面的值、字符串或表达式</td>
<td align="center">SELECT c FROM d WHERE a &lt;&#x3D; b</td>
</tr>
<tr>
<td align="center">&gt;&#x3D;</td>
<td align="center">大于等于运算符</td>
<td align="center">判断前面的值、字符串或表达式是否大于等于后面的值、字符串或表达式</td>
<td align="center">SELECT c FROM d WHERE a &gt;&#x3D; b</td>
</tr>
</tbody></table>
<p>非符号类型的运算符：</p>
<table>
<thead>
<tr>
<th align="center">运算符</th>
<th align="center">名称</th>
<th align="center">作用</th>
<th align="center">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="center">IS NULL</td>
<td align="center">为空运算符</td>
<td align="center">判断值、字符串或表达式是否为空</td>
<td align="center">SELECT c FROM b WHERE a IS NULL</td>
</tr>
<tr>
<td align="center">IS NOT NULL</td>
<td align="center">不为空运算符</td>
<td align="center">判断值、字符串或表达式是否不为空</td>
<td align="center">SELECT c FROM b WHERE a IS NOTNULL</td>
</tr>
<tr>
<td align="center">LEAST</td>
<td align="center">最小值运算符</td>
<td align="center">在多个值中返回最小值</td>
<td align="center">SELECT c FROM b WHERE a LEAST(e, f)</td>
</tr>
<tr>
<td align="center">GREATEST</td>
<td align="center">最大值运算符</td>
<td align="center">在多个值中返回最大值</td>
<td align="center">SELECT c FROM b WHERE a GREATEST(e, f)</td>
</tr>
<tr>
<td align="center">BETWEEN ··· AND ···</td>
<td align="center">两值之间的运算符</td>
<td align="center">判断一个值是否在两个值之间</td>
<td align="center">SELECT c FROM b WHERE a BETWEEN e AND f</td>
</tr>
<tr>
<td align="center">ISNULL</td>
<td align="center">为空运算符</td>
<td align="center">判断一个值、字符串或表达式是否为空</td>
<td align="center">SELECT c FROM b WHERE a ISNULL</td>
</tr>
<tr>
<td align="center">IN</td>
<td align="center">属于运算符</td>
<td align="center">判断一个值是否为列表中的任意一个值</td>
<td align="center">SELECT c FROM b WHERE a IN (e, f)</td>
</tr>
<tr>
<td align="center">NOT IN</td>
<td align="center">不属于运算符</td>
<td align="center">判断一个值是否为列表中的任意一个值</td>
<td align="center">SELECT c FROM b WHERE a NOT IN (e, f)</td>
</tr>
<tr>
<td align="center">LIKE</td>
<td align="center">模糊匹配运算符</td>
<td align="center">判断一个值是否符合模糊匹配规则</td>
<td align="center">SELECT c FROM b WHERE a LIKE B</td>
</tr>
<tr>
<td align="center">REGEXP</td>
<td align="center">正则表达式运算符</td>
<td align="center">判断一个值是否符合正则表达式的规则</td>
<td align="center">SELECT c FROM b WHERE a REGEXP B</td>
</tr>
<tr>
<td align="center">RLIKE</td>
<td align="center">正则表达式运算符</td>
<td align="center">判断一个值是否符合正则表达式的规则</td>
<td align="center">SELECT c FROM b WHERE a RLIKE B</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># <span class="operator">=</span> <span class="operator">&lt;=&gt;</span> <span class="operator">&lt;&gt;</span> <span class="operator">!=</span> <span class="operator">&lt;</span> <span class="operator">&lt;=</span> <span class="operator">&gt;</span> <span class="operator">&gt;=</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">2</span>, <span class="number">1</span> <span class="operator">!=</span> <span class="number">2</span>, <span class="number">1</span> <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span>, <span class="number">1</span> <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>,  <span class="number">0</span> <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span> <span class="keyword">FROM</span> DUAL; #结果：<span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span>。字符串存在隐士转换，如果转换数值不成功，则看做 <span class="number">0</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span> <span class="operator">=</span> <span class="keyword">NULL</span>, <span class="keyword">NULL</span> <span class="operator">=</span> <span class="keyword">NULL</span> <span class="keyword">FROM</span> DUAL; #结果：<span class="keyword">NULL</span> <span class="keyword">NULL</span> 只要有<span class="keyword">NULL</span>参与判断，都为<span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span> <span class="operator">&lt;=&gt;</span> <span class="keyword">NULL</span>, <span class="keyword">NULL</span> <span class="operator">&lt;=&gt;</span> <span class="keyword">NULL</span> <span class="keyword">FROM</span> DUAL; # 结果：<span class="number">0</span> <span class="number">1</span>。<span class="operator">&lt;=&gt;</span> 可以用来对 <span class="keyword">NULL</span> 进行判断，当两边均为 <span class="keyword">NULL</span> 时，返回 <span class="number">1</span>。一边为 <span class="keyword">NULL</span>，返回 <span class="number">0</span></span><br><span class="line"># <span class="keyword">IS</span> <span class="keyword">NULL</span>、<span class="keyword">NOT</span> <span class="keyword">NULL</span>、ISNULL</span><br><span class="line"><span class="keyword">SELECT</span> user_name, remark <span class="keyword">FROM</span> sys_user <span class="keyword">WHERE</span> remark <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br><span class="line"><span class="keyword">SELECT</span> user_name, remark <span class="keyword">FROM</span> sys_user <span class="keyword">WHERE</span> remark <span class="operator">&lt;=&gt;</span> <span class="keyword">NULL</span>;</span><br><span class="line"><span class="keyword">SELECT</span> user_name, remark <span class="keyword">FROM</span> sys_user <span class="keyword">WHERE</span> ISNULL(remark);</span><br><span class="line"><span class="keyword">SELECT</span> user_name, remark <span class="keyword">FROM</span> sys_user <span class="keyword">WHERE</span> remark <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br><span class="line"># LEAST、GREATEST</span><br><span class="line"><span class="keyword">SELECT</span> LEAST(<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;h&#x27;</span>,<span class="string">&#x27;v&#x27;</span>), GREATEST(<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;h&#x27;</span>,<span class="string">&#x27;v&#x27;</span>) <span class="keyword">FROM</span> DUAL; # 结果：a v</span><br><span class="line"><span class="keyword">SELECT</span> LEAST(user_name, nick_name) <span class="keyword">FROM</span> sys_user;</span><br><span class="line"># <span class="keyword">BETWEEN</span> ··· <span class="keyword">AND</span> ···</span><br><span class="line"><span class="keyword">SELECT</span> user_name <span class="keyword">FROM</span> sys_user <span class="keyword">WHERE</span> dept_id <span class="keyword">BETWEEN</span> <span class="number">100</span> <span class="keyword">AND</span> <span class="number">104</span>;</span><br><span class="line"><span class="keyword">SELECT</span> user_name <span class="keyword">FROM</span> sys_user <span class="keyword">WHERE</span> dept_id <span class="keyword">NOT</span> <span class="keyword">BETWEEN</span> <span class="number">100</span> <span class="keyword">AND</span> <span class="number">104</span>;</span><br><span class="line"># <span class="keyword">IN</span>、<span class="keyword">NOT</span> <span class="keyword">IN</span></span><br><span class="line"><span class="keyword">SELECT</span> user_name <span class="keyword">FROM</span> sys_user <span class="keyword">WHERE</span> dept_id <span class="keyword">IN</span> (<span class="number">100</span>, <span class="number">102</span>);</span><br><span class="line"><span class="keyword">SELECT</span> user_name <span class="keyword">FROM</span> sys_user <span class="keyword">WHERE</span> dept_id <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="number">100</span>, <span class="number">102</span>);</span><br><span class="line"># <span class="keyword">LIKE</span></span><br><span class="line"><span class="keyword">SELECT</span> user_name <span class="keyword">FROM</span> sys_user <span class="keyword">WHERE</span> user_name <span class="keyword">LIKE</span> <span class="string">&#x27;a%&#x27;</span>; #以 a 开头</span><br><span class="line"><span class="keyword">SELECT</span> user_name <span class="keyword">FROM</span> sys_user <span class="keyword">WHERE</span> user_name <span class="keyword">LIKE</span> <span class="string">&#x27;%a&#x27;</span>; #以 a 结尾</span><br><span class="line"><span class="keyword">SELECT</span> user_name <span class="keyword">FROM</span> sys_user <span class="keyword">WHERE</span> user_name <span class="keyword">LIKE</span> <span class="string">&#x27;%a%&#x27;</span>; #包含 a</span><br><span class="line"><span class="keyword">SELECT</span> user_name <span class="keyword">FROM</span> sys_user <span class="keyword">WHERE</span> user_name <span class="keyword">LIKE</span> <span class="string">&#x27;_a%&#x27;</span>; #第二个字符是 a</span><br><span class="line"><span class="keyword">SELECT</span> user_name <span class="keyword">FROM</span> sys_user <span class="keyword">WHERE</span> user_name <span class="keyword">LIKE</span> <span class="string">&#x27;%m%n%&#x27;</span> <span class="keyword">OR</span> user_name <span class="keyword">LIKE</span> <span class="string">&#x27;%n%m%&#x27;</span>; #包含 m 和 n</span><br><span class="line"># REGEXP、RLIKE</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> sys_user <span class="keyword">WHERE</span> user_name REGEXP <span class="string">&#x27;^a&#x27;</span>; #以 a 开头</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> sys_user <span class="keyword">WHERE</span> user_name REGEXP <span class="string">&#x27;s$&#x27;</span>; #以 s 结尾</span><br></pre></td></tr></table></figure>

<h3 id="3-逻辑运算符"><a href="#3-逻辑运算符" class="headerlink" title="3. 逻辑运算符"></a>3. 逻辑运算符</h3><p>逻辑运算符主要用来判断表达式的真假，在 MySQL 中，逻辑运算符的返回结果为 1、0 或者 NULL。</p>
<table>
<thead>
<tr>
<th align="center">运算符</th>
<th align="center">作用</th>
<th align="center">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="center">NOT 或 !</td>
<td align="center">逻辑非</td>
<td align="center">SELECT NOT a</td>
</tr>
<tr>
<td align="center">AND 或 &amp;&amp;</td>
<td align="center">逻辑与</td>
<td align="center">SELECT a AND b, c &amp;&amp; d</td>
</tr>
<tr>
<td align="center">OR 或 ||</td>
<td align="center">逻辑或</td>
<td align="center">SELECT a OR b, c || d</td>
</tr>
<tr>
<td align="center">XOR</td>
<td align="center">逻辑异或</td>
<td align="center">SELECT a XOR b</td>
</tr>
</tbody></table>
<p>::: tip</p>
<p>AND 和 OR 可以一起使用，但是在使用时要注意两者的优先级，由于 AND 的优先级高级 OR，因此先对 AND 两边的操作数进行操作，再与 OR 中的操作数结合。</p>
<p>:::</p>
<h3 id="4-位运算符"><a href="#4-位运算符" class="headerlink" title="4. 位运算符"></a>4. 位运算符</h3><p>位运算符是在二进制数上进行计算的运算符。位运算符会先将操作数变成二进制数，然后进行位运算，最后将计算结果从二进制变回十进制数。</p>
<p>MySQL 支持的位运算符如下：</p>
<table>
<thead>
<tr>
<th align="center">运算符</th>
<th align="center">作用</th>
<th align="center">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="center">&amp;</td>
<td align="center">按位与 (位 AND)</td>
<td align="center">SELECT a &amp; b</td>
</tr>
<tr>
<td align="center">|</td>
<td align="center">按位或 (位 OR)</td>
<td align="center">SELECT a | b</td>
</tr>
<tr>
<td align="center">^</td>
<td align="center">按位异或 (位 XOR)</td>
<td align="center">SELECT a ^ b</td>
</tr>
<tr>
<td align="center">~</td>
<td align="center">按位取反</td>
<td align="center">SELECT a ~ b</td>
</tr>
<tr>
<td align="center">&gt;&gt;</td>
<td align="center">按位右移</td>
<td align="center">SELECT a &gt;&gt; b</td>
</tr>
<tr>
<td align="center">&gt;&gt;</td>
<td align="center">按位左移</td>
<td align="center">SELECT a &lt;&lt; b</td>
</tr>
</tbody></table>
<h3 id="5-运算符的优先级"><a href="#5-运算符的优先级" class="headerlink" title="5. 运算符的优先级"></a>5. 运算符的优先级</h3><table>
<thead>
<tr>
<th align="center">优先级</th>
<th align="center">运算符</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">:&#x3D;，&#x3D; (赋值)</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">||，OR，XOR</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">&amp;&amp;，AND</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">NOT</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">BETWEEN，CASE，WHERE，THEN 和 ELSE</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">&#x3D; (比较运算符)，&lt;&#x3D;&gt;，&gt;&#x3D;，&gt;，&lt;&#x3D;，&lt;，&lt;&gt;，!&#x3D;，IS，LIKE，REGEXP 和 IN</td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">|</td>
</tr>
<tr>
<td align="center">8</td>
<td align="center">&amp;</td>
</tr>
<tr>
<td align="center">9</td>
<td align="center">&lt;&lt; 与 &gt;&gt;</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">- 和 +</td>
</tr>
<tr>
<td align="center">11</td>
<td align="center">*，&#x2F;，DIV，% 和 MOD</td>
</tr>
<tr>
<td align="center">12</td>
<td align="center">^</td>
</tr>
<tr>
<td align="center">13</td>
<td align="center">- (负号) 和 ~ (按位取反)</td>
</tr>
<tr>
<td align="center">14</td>
<td align="center">!</td>
</tr>
<tr>
<td align="center">15</td>
<td align="center">()</td>
</tr>
</tbody></table>
<p>数字编号越大，优先级越高，优先级高的运算符先进行计算。</p>
<h2 id="五、排序与分页"><a href="#五、排序与分页" class="headerlink" title="五、排序与分页"></a>五、排序与分页</h2><h3 id="1-排序数据"><a href="#1-排序数据" class="headerlink" title="1. 排序数据"></a>1. 排序数据</h3><blockquote>
<p>如果 SQL 中没有使用排序，则返回数据默认按照数据添加顺序返回。</p>
</blockquote>
<h4 id="1-1-排序规则"><a href="#1-1-排序规则" class="headerlink" title="1.1 排序规则"></a>1.1 排序规则</h4><ul>
<li>使用 ORDER BY 子句排序。(默认为 ASC 升序)<ul>
<li>ASC (ascend)：升序</li>
<li>DESC (descend)：降序</li>
</ul>
</li>
<li>ORDER BY 子句在 SELECT 语句的结尾。</li>
</ul>
<h4 id="1-2-单列排序"><a href="#1-2-单列排序" class="headerlink" title="1.2 单列排序"></a>1.2 单列排序</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> a <span class="keyword">ORDER</span> <span class="keyword">BY</span> b <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<h4 id="1-3-多列排序"><a href="#1-3-多列排序" class="headerlink" title="1.3 多列排序"></a>1.3 多列排序</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> a <span class="keyword">ORDER</span> <span class="keyword">BY</span> b <span class="keyword">DESC</span>, c <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure>

<h3 id="2-分页"><a href="#2-分页" class="headerlink" title="2. 分页"></a>2. 分页</h3><h4 id="2-1-实现规则"><a href="#2-1-实现规则" class="headerlink" title="2.1 实现规则"></a>2.1 实现规则</h4><ul>
<li><p>分页远离</p>
<p>  所谓分页显示，就是将数据库中的结果集，一段一段显示出来需要的条件。</p>
</li>
<li><p>MySQL 中国使用 LIMIT 实现分页</p>
</li>
<li><p>格式</p>
<p>  <code>LIMIT 偏移量, 行数</code> 或 <code>LIMIT pageNo, pageSize</code></p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> a LIMIT <span class="number">0</span>, <span class="number">10</span>; # 前 <span class="number">10</span> 条记录</span><br></pre></td></tr></table></figure>
</li>
<li><p>分页显示公式：**(当前页数 - 1) * 每页条数，每页条数**</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> a LIMIT (pageNo <span class="operator">-</span> <span class="number">1</span>) <span class="operator">*</span> pageSize, pageSize;</span><br></pre></td></tr></table></figure>
</li>
<li><p>注意：LIMIT 子句必须放在整个 SELECT 语句的最后。</p>
</li>
<li><p>使用 LIMIT 的好处</p>
<p>  约束返回结果的数量可以<code>减少数据表的网络传输量</code>，也可以<code>提升查询效率</code>。如果知道返回结果只有 1 条，就可以使用 <code>LIMIT 1</code>，告诉 SELECT 语句只需要返回一条记录即可。这样的好处就是 SELECT 不需要扫描完整的表，只需要检索到一条符合条件的记录即可返回。</p>
</li>
</ul>
<p>:::tip</p>
<p>MySQL 8.0 中可以使用 <code>LIMIT 3 OFFSET 4</code>，意思是获取从第 5 条记录开始后面的 3 条记录，和 <code>LIMIT 4, 3;</code> 返回的结果相同。</p>
<p>:::</p>
<h2 id="六、多表查询"><a href="#六、多表查询" class="headerlink" title="六、多表查询"></a>六、多表查询</h2><h3 id="1-笛卡尔积-交叉连接"><a href="#1-笛卡尔积-交叉连接" class="headerlink" title="1. 笛卡尔积 (交叉连接)"></a>1. 笛卡尔积 (交叉连接)</h3><p>笛卡尔乘积是一个数学运算。假设有两个集合 X 和 Y，那么 X 和 Y 的笛卡尔积就是 X 和 Y 的所有可能组合，也就是第一个对象来自于 X，第二个对象来自于 Y 的所有可能。组合的个数几位两个集合中元素个数的乘积。</p>
<h4 id="1-1-产生笛卡尔积错误的条件："><a href="#1-1-产生笛卡尔积错误的条件：" class="headerlink" title="1.1 产生笛卡尔积错误的条件："></a>1.1 产生笛卡尔积错误的条件：</h4><ul>
<li>省略多个表的连接条件 (或关联条件)</li>
<li>连接条件 (或关联条件) 无效</li>
<li>所有表中的所有行互相连接</li>
</ul>
<h3 id="2-7-种-SQL-JOIN-的实现"><a href="#2-7-种-SQL-JOIN-的实现" class="headerlink" title="2. 7 种 SQL JOIN 的实现"></a>2. 7 种 SQL JOIN 的实现</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://1.117.162.142:9000/blog/sqljoin.png" alt="sqljoin"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>左连接</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">column</span>, ··· <span class="keyword">FROM</span> table1 t1 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> table2 t2 <span class="keyword">ON</span> t1.key <span class="operator">=</span> t2.key;</span><br><span class="line">#<span class="number">2.</span>右连接</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">column</span>, ··· <span class="keyword">FROM</span> table1 t1 <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> table2 t2 <span class="keyword">ON</span> t1.key <span class="operator">=</span> t2.key;</span><br><span class="line">#<span class="number">3.</span>左连接不包含相同部分</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">column</span>, ··· <span class="keyword">FROM</span> table1 t1 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> table2 t2 <span class="keyword">ON</span> t1.key <span class="operator">=</span> t2.key <span class="keyword">WHERE</span> t2.key <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br><span class="line">#<span class="number">4.</span>右连接不包含相同部分</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">column</span>, ··· <span class="keyword">FROM</span> table1 t1 <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> table2 t2 <span class="keyword">ON</span> t1.key <span class="operator">=</span> t2.key <span class="keyword">WHERE</span> t1.key <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<p>mysql 不支持 SQL 99 的 FULL JOIN，但是可以使用 UNION 操作符来替代。</p>
<h4 id="2-1-合并查询结果"><a href="#2-1-合并查询结果" class="headerlink" title="2.1 合并查询结果"></a>2.1 合并查询结果</h4><p>利用 UNION 关键字，可以给出多条 SELECT 语句，并将它们的结果组合成单个结果集。合并式，两个表对应的列数和数据类型必须相同，并且相互对应。各个 SELECT 语句之间使用 UNION 或 UNION ALL 关键字分隔。</p>
<p>语法格式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">column</span>, ··· <span class="keyword">FROM</span> table1</span><br><span class="line"><span class="keyword">UNION</span> [<span class="keyword">ALL</span>]</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">column</span>, ··· <span class="keyword">FROM</span> table2;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-UNION-的使用"><a href="#2-2-UNION-的使用" class="headerlink" title="2.2 UNION 的使用"></a>2.2 UNION 的使用</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://1.117.162.142:9000/blog/union%E6%93%8D%E4%BD%9C%E7%AC%A6.png" alt="UNION操作符"></p>
<p>UNION 操作符返回两个查询的结果集的并集，然后去除重复记录。</p>
<h4 id="2-3-UNION-ALL-操作符"><a href="#2-3-UNION-ALL-操作符" class="headerlink" title="2.3 UNION ALL 操作符"></a>2.3 UNION ALL 操作符</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://1.117.162.142:9000/blog/unionall%E6%93%8D%E4%BD%9C%E7%AC%A6.png" alt="unionall操作符"></p>
<p>UNION ALL 操作符返回两个查询的结果集的并集。对于两个结果集的重复部分，不去重。</p>
<p>:::tip</p>
<p>执行 UNION ALL 语句时所需要的资源比 UNION 语句少。如果明确知道合并数据后的结果数据不存在重复数据，或者不需要去除重复的数据，则尽量使用 UNION ALL 语句，以提高数据查询的效率。</p>
<p>:::</p>
<p>用 UNION ALL 替换 FULL JOIN。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">5.</span>满外连接</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">column</span>, ··· <span class="keyword">FROM</span> table1 t1 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> table2 t2 <span class="keyword">ON</span> t1.key <span class="operator">=</span> t2.key</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">column</span>, ··· <span class="keyword">FROM</span> table1 t1 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> table2 t2 <span class="keyword">ON</span> a.key <span class="operator">=</span> t1.key <span class="keyword">WHERE</span> t2.key <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br><span class="line">#<span class="number">6.</span>满外连接，不包含相同部分</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">column</span>, ··· <span class="keyword">FROM</span> table1 t1 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> table2 t2 <span class="keyword">ON</span> t1.key <span class="operator">=</span> t2.key <span class="keyword">WHERE</span> t2.key <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">column</span>, ··· <span class="keyword">FROM</span> table1 t1 <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> table2 t2 <span class="keyword">ON</span> t1.key <span class="operator">=</span> t2.key <span class="keyword">WHERE</span> t1.key <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<h2 id="七、函数"><a href="#七、函数" class="headerlink" title="七、函数"></a>七、函数</h2><h3 id="1-不同-DBMS-函数的差异"><a href="#1-不同-DBMS-函数的差异" class="headerlink" title="1. 不同 DBMS 函数的差异"></a>1. 不同 DBMS 函数的差异</h3><p>在使用 SQL 语言的时候，不是直接和着门语言打交道，而是通过它使用不同的数据库软件，即 DBMS。<strong>DBMS 之间的差异性很大，远大于同一个语言不通版本之间的差异</strong>。实际上，只有很少的函数是被 DBMS 同时支持的。比如，大多数 DBMS 使用 || 或者 + 来做拼接符，而在 MySQL 中的字符串拼接函数为 concat()。大部分 DBMS 会有自己特定的函数，这就意味着<strong>采用 SQL 函数的代码可移植性是很差的</strong>，因此在使用函数的时候需要特别注意。</p>
<h3 id="2-MySQL-的内置函数及分类"><a href="#2-MySQL-的内置函数及分类" class="headerlink" title="2. MySQL 的内置函数及分类"></a>2. MySQL 的内置函数及分类</h3><p>MySQL 提供了丰富的内置函数，这些函数使得数据的维护与管理更加方便，能够更好地提供数据的分析与统计功能，在一定程度上提高了开发人员进行数据与统计的效率。</p>
<p>MySQL 提供的内置函数从 <code>实现的功能角度</code> 可以分为数值函数、字符串函数、日期和时间函数、流程控制函数、加密与解密函数、获取 MySQL 信息函数、聚合函数等。这些内置函数可以分为两类：<code>单行函数</code>、<code>聚合函数 (或分组函数)</code>。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://1.117.162.142:9000/blog/%E4%B8%A4%E7%A7%8Dsql%E5%87%BD%E6%95%B0.png" alt="两种sql函数"></p>
<h3 id="3-单行函数"><a href="#3-单行函数" class="headerlink" title="3. 单行函数"></a>3. 单行函数</h3><ul>
<li>操作数据对象</li>
<li>接受参数返回一个结果</li>
<li><strong>只对一行进行变换</strong></li>
<li><strong>每行返回一个结果</strong></li>
<li>可以嵌套</li>
<li>参数可以是一列或一个值</li>
</ul>
<h4 id="3-1-数值函数"><a href="#3-1-数值函数" class="headerlink" title="3.1 数值函数"></a>3.1 数值函数</h4><p>基本函数：</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>ABS(x)</td>
<td>返回 x 的绝对值</td>
</tr>
<tr>
<td>SIGN(x)</td>
<td>返回 x 的符号。整数返回 1，负数返回 -1，0 返回 0</td>
</tr>
<tr>
<td>PI()</td>
<td>返回圆周率的值</td>
</tr>
<tr>
<td>CEIL(x)，CEILING(x)</td>
<td>返回大于或等于某个值的最小整数</td>
</tr>
<tr>
<td>FLOOR(x)</td>
<td>返回小于或等于某个值的最大整数</td>
</tr>
<tr>
<td>LEAST(e1, e2, e3, ···)</td>
<td>返回列表中的最小值</td>
</tr>
<tr>
<td>GREATEST(e1, e2, e3, ···)</td>
<td>返回列表中的最大值</td>
</tr>
<tr>
<td>MOD(x, y)</td>
<td>返回 x 除以 y 后的余数</td>
</tr>
<tr>
<td>RAND()</td>
<td>返回 0～1 的随机值</td>
</tr>
<tr>
<td>RAND(x)</td>
<td>返回 0～1 的随机值，其中 x 的值用作种子值，相同的 x 值会产生相同的随机数</td>
</tr>
<tr>
<td>ROUND(x)</td>
<td>返回一个对 x 的值进行四舍五入后，最接近于 x 的整数</td>
</tr>
<tr>
<td>ROUND(x, y)</td>
<td>返回一个对 x 的值进行四舍五入后最接近 x 的值，并保留到小数点后 y 位</td>
</tr>
<tr>
<td>TRUNCATE(x, y)</td>
<td>返回数字 x 截断为 y 位小数的结果</td>
</tr>
<tr>
<td>SQRT(x)</td>
<td>返回 x 的平方根。当 x 的值为负数时，返回 NULL</td>
</tr>
</tbody></table>
<p><strong>数值函数可以嵌套</strong>。</p>
<p>角度与弧度互换函数：</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>RADIANS(x)</td>
<td>将角度转化为弧度，其中，参数 x 为角度值</td>
</tr>
<tr>
<td>DEGREES(x)</td>
<td>将弧度转化为角度，其中，参数 x 为弧度值</td>
</tr>
</tbody></table>
<p>三角函数：</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>SIN(x)</td>
<td>返回 x 的正弦值，其中，参数 x 为弧度值</td>
</tr>
<tr>
<td>ASIN(x)</td>
<td>返回 x 的反正弦值，即获取正弦为 x 的值。如果 x 的值不在 -1 到 1 之间，则返回 NULL</td>
</tr>
<tr>
<td>COS(x)</td>
<td>返回 x 的余弦值，其中，参数 x 为弧度值</td>
</tr>
<tr>
<td>ACOS(x)</td>
<td>返回 x 的反余弦值，即获取余弦为 x 的值。如果 x 的值不在 -1 到 1 之间，则返回 NULL</td>
</tr>
<tr>
<td>TAN(x)</td>
<td>返回 x 的正切值，其中，参数 x 为弧度值</td>
</tr>
<tr>
<td>ATAN(x)</td>
<td>返回 x 的反正切值，即返回正切值为 x 的值</td>
</tr>
<tr>
<td>ATAN2(m, n)</td>
<td>返回两个参数的反正切值</td>
</tr>
<tr>
<td>COT(x)</td>
<td>返回 x 的余切值，其中，x 为弧度值</td>
</tr>
</tbody></table>
<p>指数与对数：</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>POW(x, y), POWER(x, y)</td>
<td>返回 x 的 y 次方</td>
</tr>
<tr>
<td>EXP(x)</td>
<td>返回 e 的 x 次方，其中 e 是一个常数，2.718281828459045</td>
</tr>
<tr>
<td>LN(x), LOG(x)</td>
<td>返回以 e 为底的 x 的对数，当 x &lt;&#x3D; 0 时，返回的结果为 NULL</td>
</tr>
<tr>
<td>LOG10(x)</td>
<td>返回以 10 为底的 x 的对数，当 x &lt;&#x3D; 0 时，返回的结果为 NULL</td>
</tr>
<tr>
<td>LOG2(x)</td>
<td>返回以 2 为底的 x 的对数，当 x &lt;&#x3D; 0 时，返回的结果为 NULL</td>
</tr>
</tbody></table>
<p>进制间的转换：</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>BIN(x)</td>
<td>返回 x 的二进制编码</td>
</tr>
<tr>
<td>HEX(x)</td>
<td>返回 x 的十六进制编码</td>
</tr>
<tr>
<td>OCT(x)</td>
<td>返回 x 的八进制编码</td>
</tr>
<tr>
<td>CONV(x, f1, f2)</td>
<td>返回 f1 进制数变成 f2 进制数</td>
</tr>
</tbody></table>
<h4 id="3-2-字符串函数"><a href="#3-2-字符串函数" class="headerlink" title="3.2 字符串函数"></a>3.2 字符串函数</h4><table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>ASCII(s)</td>
<td>返回字符串 s 中的第一个字符的 ASCII 码值</td>
</tr>
<tr>
<td>CHAE_LENGTH(s)</td>
<td>返回字符串 s 的字符数。作用与CHAEACTER_LENGTH(s) 相同</td>
</tr>
<tr>
<td>LENGTH(s)</td>
<td>返回字符串 s 的字节数，和字符集有关</td>
</tr>
<tr>
<td>CONCAT(s1, s2, s3, ···)</td>
<td>连接 s1, s2, s3, ··· 为一个字符串</td>
</tr>
<tr>
<td>CONCAT_WS(x, s1, s2, s3, ···)</td>
<td>同 CANCAT(s1, s2, s3, ···) 函数，但是每个字符串之间要加上 x</td>
</tr>
<tr>
<td>INSERT(str, idx, len, replacestr)</td>
<td>将字符串 str 从 idx 位置开始，len 个字符长的子串替换为字符串 replacestr</td>
</tr>
<tr>
<td>REPLACE(str, a, b)</td>
<td>用字符串 b 替换字符串 str 中所有出现的字符串 a</td>
</tr>
<tr>
<td>UPPER(s) 或 UCASE(s)</td>
<td>将字符串 s 的所有字母转成大写字母</td>
</tr>
<tr>
<td>LOWER(s) 或 LCASE(s)</td>
<td>将字符串 s 的所有字母转成小写字母</td>
</tr>
<tr>
<td>LEFT(str, n)</td>
<td>返回字符串 str 最左边的 n 个字符</td>
</tr>
<tr>
<td>RIGHT(str, n)</td>
<td>返回字符串 str 最右边的 n 个字符</td>
</tr>
<tr>
<td>LPAD(str, len, pad)</td>
<td>用字符串 pad 对 str 最左边进行填充，直到 str 的长度为 len 个字符</td>
</tr>
<tr>
<td>RPAD(str, len, pad)</td>
<td>用字符串 pad 对 str 最右边进行填充，直到 str 的长度为 len 个字符</td>
</tr>
<tr>
<td>LTRIM(s)</td>
<td>去掉字符串 s 左侧的空格</td>
</tr>
<tr>
<td>RTRIM(s)</td>
<td>去掉字符串 s 右侧的空格</td>
</tr>
<tr>
<td>TRIM(s)</td>
<td>去掉字符串 s 开始与结尾的空格</td>
</tr>
<tr>
<td>TRIM(s1FROM s)</td>
<td>去掉字符串 s 开始与结尾的 s1</td>
</tr>
<tr>
<td>TRIM(LEADING s1 FROM s)</td>
<td>去掉字符串 s 开始处的 s1</td>
</tr>
<tr>
<td>TRIM(TRAILING s1 FROM s)</td>
<td>去掉字符串 s 结尾处的 s1</td>
</tr>
<tr>
<td>REPEAT(str, n)</td>
<td>返回 str 重复 n 次的结果</td>
</tr>
<tr>
<td>SPACE(n)</td>
<td>返回 n 个空格</td>
</tr>
<tr>
<td>STRCMP(s1, s2)</td>
<td>比较字符串s1，s2 的 ASCII 码值的大小</td>
</tr>
<tr>
<td>SUBSTR(s, index, len)</td>
<td>返回从字符串 s 的 index 位置其 len 个字符，作用与 SUBSTRING(s, n, len) 相同</td>
</tr>
<tr>
<td>LOCATE(substr, str)</td>
<td>返回字符串 substr 在字符串 str 中首次出现的位置，作用与 POSITION(substrate IN str)、INSTR(str, substr) 相同。未找到，返回 0</td>
</tr>
<tr>
<td>ELT(m, s1, s2, ···, sn)</td>
<td>返回指定位置的字符串，如果 m &#x3D; 1，则返回 s1，如果 m &#x3D; 2，则返回 s2，如果 m &#x3D; n，则返回 sn</td>
</tr>
<tr>
<td>FIELD(s1, s2, ···, sn)</td>
<td>返回字符串 s 在字符串列表中第一次出现的位置</td>
</tr>
<tr>
<td>FIND_IN_SET(s1, s2)</td>
<td>返回字符串 s1 在字符串 s2 中出现的位置。其中，字符串 s2 是一个以逗号分隔的字符串</td>
</tr>
<tr>
<td>REVERSE(s)</td>
<td>返回s反转后的字符串</td>
</tr>
<tr>
<td>NULLIF(value1, value2)</td>
<td>比较两个字符串，如果 value1 与 value2 相等，则返回 NULL，否则返回 value1</td>
</tr>
</tbody></table>
<p>:::tip</p>
<p>MySQL 中，字符串的位置是从 1 开始的。</p>
<p>:::</p>
<h4 id="3-3-日期和时间函数"><a href="#3-3-日期和时间函数" class="headerlink" title="3.3 日期和时间函数"></a>3.3 日期和时间函数</h4><p>获取日期、时间：</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>CURDATE(), CURRENT_DATE()</td>
<td>返回当前日期，只包含年、月、日</td>
</tr>
<tr>
<td>CURTIME(), CURRENT_TIME()</td>
<td>返回当前时间，只包含时、分、秒</td>
</tr>
<tr>
<td>NOW() &#x2F; SYSDATE() &#x2F; CURRENT_TIMESTAMP() &#x2F; LOCALTIME() &#x2F; LOCALTIMESTAMP()</td>
<td>返回当前系统日期和时间</td>
</tr>
<tr>
<td>UTC_DATE()</td>
<td>返回 UTC (世界标准时间) 日期</td>
</tr>
<tr>
<td>UTC_TIME()</td>
<td>返回 UTC (世界标准时间) 时间</td>
</tr>
</tbody></table>
<p>日期与时间戳的转换：</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>UNIX_TIMESTAMP()</td>
<td>以 UNIX 时间戳的形式返回当前时间。SELECT UNIX_TIMESTAMP() -&gt; 1634348884</td>
</tr>
<tr>
<td>UNIX_TIMESTAMP(date)</td>
<td>将时间 date 以 UNIX 时间戳的形式返回。</td>
</tr>
<tr>
<td>FROM_UNIXTIME(timestamp)</td>
<td>将 UNIX 时间戳的时间转换为普通格式的时间</td>
</tr>
</tbody></table>
<p>获取月份、星期、星期数、天数等函数：</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>YEAE(date) &#x2F; MONTH(date) &#x2F; DAY(date)</td>
<td>返回具体的日期值</td>
</tr>
<tr>
<td>HOUR(time) &#x2F; MINUTE(time) &#x2F; SECOND(time)</td>
<td>返回具体的时间值</td>
</tr>
<tr>
<td>MONTHNAME(date)</td>
<td>返回月份：January，······</td>
</tr>
<tr>
<td>DAYNAME(date)</td>
<td>返回星期几：MONDAY， TUESDAY……SUNDAY</td>
</tr>
<tr>
<td>WEEKDAY(date)</td>
<td>返回周几，注意，周 1 是 0，周 2 是 1，……，周日是 6</td>
</tr>
<tr>
<td>QUARTER(date)</td>
<td>返回日期对应的季度，范围为 1～4</td>
</tr>
<tr>
<td>WEEK(date), WEEKOFYEAR(date)</td>
<td>返回一年中的第几周</td>
</tr>
<tr>
<td>DAYOFYEAR(date)</td>
<td>返回日期是一年中的第几天</td>
</tr>
<tr>
<td>DAYOFMONTH(date)</td>
<td>返回日期位于所在月份的第几天</td>
</tr>
<tr>
<td>DAYOFWEEK(date)</td>
<td>返回周几，注意：周日是 1，周一是 2，……，周六是 7</td>
</tr>
</tbody></table>
<p>日期的操作函数：</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>EXTRACT(type FROM date)</td>
<td>返回指定日期中特定的部分，type 指定返回值</td>
</tr>
</tbody></table>
<p>EXTRACT(type FROM date) 函数中 type 的取值与含义：</p>
<table>
<thead>
<tr>
<th>type 取值</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>MICROSECOND</td>
<td>返回毫秒数</td>
</tr>
<tr>
<td>SECOND</td>
<td>返回秒数</td>
</tr>
<tr>
<td>MINUTE</td>
<td>返回分钟数</td>
</tr>
<tr>
<td>HOUR</td>
<td>返回小时数</td>
</tr>
<tr>
<td>DAY</td>
<td>返回天数</td>
</tr>
<tr>
<td>WEEK</td>
<td>返回日期在一年中的第几个星期</td>
</tr>
<tr>
<td>MONTH</td>
<td>返回日期在一年中的第几个月</td>
</tr>
<tr>
<td>QUARTER</td>
<td>返回日期在一年中的第几个季度</td>
</tr>
<tr>
<td>YEAE</td>
<td>返回日期的年份</td>
</tr>
<tr>
<td>SECOND_MICROSECOND</td>
<td>返回秒和毫秒值</td>
</tr>
<tr>
<td>MINUTE_MICROSECOND</td>
<td>返回分钟和毫秒值</td>
</tr>
<tr>
<td>MINUTE_SECOND</td>
<td>返回分钟和秒值</td>
</tr>
<tr>
<td>HOUR_MICROSECOND</td>
<td>返回小时和毫秒值</td>
</tr>
<tr>
<td>HOUR_SECOND</td>
<td>返回小时和秒值</td>
</tr>
<tr>
<td>HOUR_MINUTE</td>
<td>返回小时和分钟值</td>
</tr>
<tr>
<td>DAY_MICROSECOND</td>
<td>返回天和毫秒值</td>
</tr>
<tr>
<td>DAY_SECOND</td>
<td>返回天和秒值</td>
</tr>
<tr>
<td>DAY_MINUTE</td>
<td>返回天和分钟值</td>
</tr>
<tr>
<td>DAY_HOUR</td>
<td>返回天和小时</td>
</tr>
<tr>
<td>YEAR_MONTH</td>
<td>返回年和月</td>
</tr>
</tbody></table>
<p>时间和秒种转换的函数：</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>TIME_TO_SEC(time)</td>
<td>将 time 转化为妙并返回结果值。转化的公式为：<code>小时 * 3600 + 分钟 * 60 + 秒</code></td>
</tr>
<tr>
<td>SEC_TO_TIME(seconds)</td>
<td>将 seconds 描述转化为包含小时、分钟和秒的时间</td>
</tr>
</tbody></table>
<p>计算日期和时间的函数：</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>DATE_ADD(datetime, INTERVAL express type), ADDDATE(date, INTERVAL express type)</td>
<td>返回与给定日期时间相差 INTERVAL 时间段的日期时间</td>
</tr>
<tr>
<td>DATE_SUB(date, INTERVAL expr type), SUBDATE(date, INTERVAL express type)</td>
<td>返回与 date 相差 INTERVAL 时间间隔的日期</td>
</tr>
<tr>
<td>ADDTIME(time1, time2)</td>
<td>返回 time1 加上 time2 的时间，当 time2 为一个数字时，代表的是秒，可以为负数</td>
</tr>
<tr>
<td>SUBTIME(time1, time2)</td>
<td>返回 time1 减去 time2 的时间，当 time2 为一个数字时，代表的是秒，可以为负数</td>
</tr>
<tr>
<td>DATEDIFF(date1, date2)</td>
<td>返回 date1 - date2 的日期间隔天数</td>
</tr>
<tr>
<td>TIMEDIFF(time1, time2)</td>
<td>返回 time1 - time2 的时间间隔</td>
</tr>
<tr>
<td>FROM_DAYS(N)</td>
<td>返回从 0000 年 1 月 1 日起，N 天以后的日期</td>
</tr>
<tr>
<td>TO_DAYS(date)</td>
<td>返回日期 date 距离 0000 年 1 月 1 日的天数</td>
</tr>
<tr>
<td>LAST_DAY(date)</td>
<td>返回 date 所在月份的最后一天的日期</td>
</tr>
<tr>
<td>MAKEDATE(year, n)</td>
<td>针对给定年份与所在年份中的天数返回一个日期</td>
</tr>
<tr>
<td>MAKETIME(hour, minute, second)</td>
<td>将给定的小时、分钟和秒组合成时间并返回</td>
</tr>
<tr>
<td>PERIOD_ADD(time, n)</td>
<td>返回 time 加上 n 后的时间</td>
</tr>
</tbody></table>
<p>上述函数中 type 的取值：</p>
<table>
<thead>
<tr>
<th>时间类型</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>HOUR</td>
<td>小时</td>
</tr>
<tr>
<td>MINUTE</td>
<td>分钟</td>
</tr>
<tr>
<td>SECOND</td>
<td>秒</td>
</tr>
<tr>
<td>YEAR</td>
<td>年</td>
</tr>
<tr>
<td>MONTH</td>
<td>月</td>
</tr>
<tr>
<td>DAY</td>
<td>日</td>
</tr>
<tr>
<td>YEAR_MONTH</td>
<td>年和月</td>
</tr>
<tr>
<td>DAY_HOUR</td>
<td>日和小时</td>
</tr>
<tr>
<td>DAY_MINUTE</td>
<td>日和分钟</td>
</tr>
<tr>
<td>DAY_SECOND</td>
<td>日和秒</td>
</tr>
<tr>
<td>HOUR_MINUTE</td>
<td>小时和分钟</td>
</tr>
<tr>
<td>HOUR_SECOND</td>
<td>小时和秒</td>
</tr>
<tr>
<td>MINUTE_SECOND</td>
<td>分钟和秒</td>
</tr>
</tbody></table>
<p>日期的格式化与解析</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>DATE_FORMAT(date, fmt)</td>
<td>按照字符串 fmt 格式化日期 date 值</td>
</tr>
<tr>
<td>TIME_FORMAT(time, fmt)</td>
<td>按照字符串 fmt 格式化时间 time 值</td>
</tr>
<tr>
<td>GET_FORMAT(date_type, format_type)</td>
<td>返回日期字符串的显示格式</td>
</tr>
<tr>
<td>STR_TO_DATE(str, fmt)</td>
<td>按照字符串 fmt 对 str 进行解析，解析为一个日期</td>
</tr>
</tbody></table>
<p> 上述非 GET_FORMAT 函数中 fmt 参数常用的格式符：</p>
<table>
<thead>
<tr>
<th>格式符</th>
<th>说明</th>
<th>格式符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>%Y</td>
<td>4 位数字表示年份</td>
<td>%y</td>
<td>表示两位数字表示年份</td>
</tr>
<tr>
<td>%M</td>
<td>月名表示月份（January, ……）</td>
<td>%m</td>
<td>两位数字表示月份(01, 02, ···)</td>
</tr>
<tr>
<td>%b</td>
<td>缩写的月名(Jan., Feb., ······)</td>
<td>%c</td>
<td>数字表示月份 (1, 2, 3, ···)</td>
</tr>
<tr>
<td>%D</td>
<td>英文后缀表示月中的天数 (1st, 2nd, 3rd, ···)</td>
<td>%d</td>
<td>两位数字表示月中的天数 (01, 02, ···)</td>
</tr>
<tr>
<td>%e</td>
<td>数字形式表示月中的天数 (1, 2, 3, 4, 5, ···)</td>
<td></td>
<td></td>
</tr>
<tr>
<td>%H</td>
<td>两位数字表示小数，24小时制 (01，02，···)</td>
<td>%h 和 %I</td>
<td>两位数字表示小时，12小时制 (01, 02, ···)</td>
</tr>
<tr>
<td>%k</td>
<td>数字形式的消失，24小时制 (1, 2, 3)</td>
<td>%l</td>
<td>数字形式表示小时，12小时制 (1，2，3，4，···)</td>
</tr>
<tr>
<td>%i</td>
<td>两位数字表示分钟 (00, 01, 02)</td>
<td>%S 和 %s</td>
<td>两位数字表示秒 (00, 01, 02, ···)</td>
</tr>
<tr>
<td>%W</td>
<td>一周中的星期名称 (Sunday, ···)</td>
<td>%a</td>
<td>一周中的星期缩写 (Sun., Mon., Tues., ···)</td>
</tr>
<tr>
<td>%w</td>
<td>以数字表示周中的天数 (0 &#x3D; Sunday, 1 &#x3D; Monday, ···)</td>
<td></td>
<td></td>
</tr>
<tr>
<td>%j</td>
<td>以 3 位数字表示年中的天数 (001, 002, ···)</td>
<td>%U</td>
<td>以数字表示年中的第几周，(1, 2, 3) 其中 Sunday 位周中第一天</td>
</tr>
<tr>
<td>%u</td>
<td>以数字表示年中的第几周，(1, 2, 3, ···) 其中Monday 为周中第一天</td>
<td></td>
<td></td>
</tr>
<tr>
<td>%T</td>
<td>24 小时制</td>
<td>%r</td>
<td>12 小时制</td>
</tr>
<tr>
<td>%p</td>
<td>AM 或 PM</td>
<td>%%</td>
<td>表示 %</td>
</tr>
</tbody></table>
<p>GET_FORMAT 函数中 date_type 和 format_type参数取值如下：</p>
<table>
<thead>
<tr>
<th>日期类型</th>
<th>格式化类型</th>
<th>返回的格式化字符串</th>
</tr>
</thead>
<tbody><tr>
<td>DATE</td>
<td>USA</td>
<td>%m.%d.%Y</td>
</tr>
<tr>
<td>DATE</td>
<td>JIS</td>
<td>%Y-%m-%d</td>
</tr>
<tr>
<td>DATE</td>
<td>ISO</td>
<td>%Y-%m-%d</td>
</tr>
<tr>
<td>DATE</td>
<td>EUR</td>
<td>%d.%m.%Y</td>
</tr>
<tr>
<td>DATE</td>
<td>INTERNAL</td>
<td>%Y%m%d</td>
</tr>
<tr>
<td>TIME</td>
<td>USA</td>
<td>%h:%i%s%p</td>
</tr>
<tr>
<td>TIME</td>
<td>JIS</td>
<td>%H:%i:%s</td>
</tr>
<tr>
<td>TIME</td>
<td>ISO</td>
<td>%H:%i:%s</td>
</tr>
<tr>
<td>TIME</td>
<td>EUR</td>
<td>%H.%i.%s</td>
</tr>
<tr>
<td>TIME</td>
<td>INTERNAL</td>
<td>%H%i%s</td>
</tr>
<tr>
<td>DATETIME</td>
<td>USA</td>
<td>%Y-%m-%d %H.%i.%s</td>
</tr>
<tr>
<td>DATETIME</td>
<td>JIS</td>
<td>%Y-%m-%d %H:%i:%s</td>
</tr>
<tr>
<td>DATETIME</td>
<td>ISO</td>
<td>%Y-%m-%d %H:%i:%s</td>
</tr>
<tr>
<td>DATETIME</td>
<td>EUR</td>
<td>%Y-%m-%d %H.%i.%s</td>
</tr>
<tr>
<td>DATETIME</td>
<td>INTERNAL</td>
<td>%Y%m%d %H%i%s</td>
</tr>
</tbody></table>
<h4 id="3-4-流程控制函数"><a href="#3-4-流程控制函数" class="headerlink" title="3.4 流程控制函数"></a>3.4 流程控制函数</h4><p>流程处理函数可以根据不同的条件，执行不同的处理流程，可以在 SQL 语句中实现不同的条件选择。MySQL 中的流程处理函数主要包括 IF()、IFNULL() 和 CASE() 函数。</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>IF(value, value1, value2)</td>
<td>如果value的值为 TRUE，返回 value1，否则返回value2</td>
</tr>
<tr>
<td>IFNULL(value1, value2)</td>
<td>如果 value1 不为 NULL，返回 value1，否则返回 value2</td>
</tr>
<tr>
<td>CASE WHEN 条件1 THEN 结果1 WHEN 条件2 THEN 结果2 ······[ELSE resultn] END</td>
<td>相当于 Java 的 if···else if···else</td>
</tr>
<tr>
<td>CASE expo WHEN 常量值1 THEN 值1 WHEN 常量值1 THEN 值1 ……[ELSE 值n] END</td>
<td>相当于 Java 的 switch···case···</td>
</tr>
</tbody></table>
<h4 id="3-5-加密与解密函数"><a href="#3-5-加密与解密函数" class="headerlink" title="3.5 加密与解密函数"></a>3.5 加密与解密函数</h4><p>加密与解密函数主要用于对数据库中的数据进行加密和解密处理，以防止数据被他人窃取。这些函数在保证数据库安全时非常有用。</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>PASSWORD(str)</td>
<td>返回字符串 str 的加密版本，41位长的字符串。加密结果不可逆，常用于用户的密码加密。(8.0 已弃用)</td>
</tr>
<tr>
<td>MD5(str)</td>
<td>返回字符串 str 的 md5 加密后的值，也是一种加密方式。若参数为 NULL，则会返回 NULL。</td>
</tr>
<tr>
<td>SHA(str)</td>
<td>从原明文密码 str 计算并返回加密后的密码字符串，当参数为 NULL 时，返回 NULL。SHA 加密算法比 MD5 更加安全。</td>
</tr>
<tr>
<td>ENCODE(value, password_seed)</td>
<td>返回使用 password_seed 作为加密密码加密 value。</td>
</tr>
<tr>
<td>DECODE(value, password_seed)</td>
<td>返回使用 password_seed 作为加密密码解密 value。</td>
</tr>
</tbody></table>
<h4 id="3-6-MySQL-信息函数"><a href="#3-6-MySQL-信息函数" class="headerlink" title="3.6 MySQL 信息函数"></a>3.6 MySQL 信息函数</h4><p>MySQL 中内置了一些可以查询 MySQL 信息的函数，这些函数主要用于帮助数据库开发或运维人员更好地对数据库进行维护工作。</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>VERSION()</td>
<td>返回当前 MySQL 的版本号</td>
</tr>
<tr>
<td>CONNECTION_ID()</td>
<td>返回当前 MySQL 服务器的连接数</td>
</tr>
<tr>
<td>DATABASE(), SCHEMA()</td>
<td>返回 MySQL 命令行当前所在的数据库</td>
</tr>
<tr>
<td>USER(), CURRENT_USER(), SYSTEM_USER(), SESSION_USER()</td>
<td>返回当前连接 MySQL 的用户名，返回结果格式为“主机名@用户名”</td>
</tr>
<tr>
<td>CHARSET(value)</td>
<td>返回字符串 value 自变量的字符集</td>
</tr>
<tr>
<td>COLLATION(value)</td>
<td>返回字符串 value 的比较规则</td>
</tr>
</tbody></table>
<h4 id="3-7-其他函数"><a href="#3-7-其他函数" class="headerlink" title="3.7 其他函数"></a>3.7 其他函数</h4><p>MySQL 中有些函数无法对其进行具体分类，但是这些函数在 MySQL 的开发和运维过程中也是不容忽视的。</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>FORMAT(value, n)</td>
<td>返回对数字 value 进行格式化后的结果数据。n 表示四舍五入后保留到小数点后 n 位</td>
</tr>
<tr>
<td>CONV(value, from, to)</td>
<td>将 value 的值进行不同进制之间的转换</td>
</tr>
<tr>
<td>INET_ATON(ipvalue)</td>
<td>将以点分隔的 IP 地址转化为一个数字</td>
</tr>
<tr>
<td>INET_NTOA(value)</td>
<td>将数字形式的 IP 地址转化为以点分隔的 IP 地址</td>
</tr>
<tr>
<td>BENCHMARK(n, expr)</td>
<td>将表达式 expr 重复执行 n 次。用于测试 MySQL 处理 expr 表达式所耗费的时间</td>
</tr>
<tr>
<td>CONVERT(value USING char_code)</td>
<td>将 value 所使用的字符编码修改为 char_code</td>
</tr>
</tbody></table>
<h3 id="4-聚合函数"><a href="#4-聚合函数" class="headerlink" title="4. 聚合函数"></a>4. 聚合函数</h3><p>聚合函数也叫聚集、分组函数，它是对一组数据进行汇总的函数，输入的是一组数据的集合，输出的是单个值。<strong>聚合函数不能嵌套</strong>。          </p>
<h4 id="4-1-MySQL-中常用的聚合函数类型："><a href="#4-1-MySQL-中常用的聚合函数类型：" class="headerlink" title="4.1 MySQL 中常用的聚合函数类型："></a>4.1 MySQL 中常用的聚合函数类型：</h4><ul>
<li><p>AVG() 和 SUM()</p>
<p>  只适用于数值类型的字段或变量</p>
</li>
<li><p>MAX() 和 MIN()</p>
<p>  适用于数值类型、字符串类型、日期时间类型的字段或变量</p>
</li>
<li><p>COUNT()</p>
<p>  作用：计算制定字段在查询结果中出现的个数</p>
<p>  计算表中有多少条记录：<code>COUNT(*)、COUNT(1)</code>。COUNT(具体字段) 并不能准确的计算出表中记录条数，因为有可能为 NULL。</p>
<p>  <code>AVG = SUM / COUNT</code></p>
</li>
</ul>
<h4 id="4-2-GROUP-BY-的使用"><a href="#4-2-GROUP-BY-的使用" class="headerlink" title="4.2 GROUP BY 的使用"></a>4.2 GROUP BY 的使用</h4><p>使用 GROUP BY 子句将表中的数据分成若干组</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">column</span>, group_function(<span class="keyword">column</span>)</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">table</span>   </span><br><span class="line">[<span class="keyword">WHERE</span> <span class="keyword">condition</span>]</span><br><span class="line">[<span class="keyword">GROUP</span> <span class="keyword">BY</span> group_by_expression]</span><br><span class="line">[<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">column</span>];</span><br></pre></td></tr></table></figure>

<p>:::tip</p>
<p>SELECT 中出现的非组函数的字段必须声明在 GROUP BY 中。</p>
<p>反之，GROUP BY 中生命的字段可以不出现在 SELECT 中。</p>
<p>:::</p>
<p><strong>GROUP BY 中使用 WITH ROLLUP</strong></p>
<p>使用 WITH ROLLUP 关键字之后，在所有查询出的分组记录之后增加一条记录，该记录计算查询出的所有记录的综合，即统计记录数量。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">column</span>, group_function(<span class="keyword">column</span>)</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">table</span></span><br><span class="line">[<span class="keyword">WHERE</span> <span class="keyword">condition</span>]</span><br><span class="line">[<span class="keyword">GROUP</span> <span class="keyword">BY</span> group_by_expression <span class="keyword">WITH</span> <span class="keyword">ROLLUP</span>];</span><br></pre></td></tr></table></figure>

<p>:::tip</p>
<p>当使用 ROLLUP时，不能同时使用 ORDER BY 子句进行结果排序，即 ROLLUP 和 ORDER BY 是互相排斥的。</p>
<p>:::</p>
<h4 id="4-3-HAVING-的使用"><a href="#4-3-HAVING-的使用" class="headerlink" title="4.3 HAVING 的使用"></a>4.3 HAVING 的使用</h4><p>过滤分组：HAVING 子句</p>
<ol>
<li>行已被分组。</li>
<li>使用了聚合函数。</li>
<li>满足 HAVING 子句中条件的分组将被显示。</li>
<li>HAVING 不能单独使用，必须要跟 GROUP BY 一起使用。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">column</span>, group_function</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">table</span></span><br><span class="line">[<span class="keyword">WHERE</span> <span class="keyword">condition</span>]</span><br><span class="line">[<span class="keyword">GROUP</span> <span class="keyword">BY</span> group_by_expression]</span><br><span class="line">[<span class="keyword">HAVING</span> group_condition]</span><br><span class="line">[<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">column</span>];</span><br></pre></td></tr></table></figure>

<p><strong>WHERE 和 HAVING 的对比</strong></p>
<p>区别一：<strong>WHERE 可以直接使用表中的字段作为筛选条件，但不能使用分组中的计算函数作为筛选条件；HAVING 必须要与 GROUP BY 配合使用，可以把分组计算的函数和分组字段作为筛选条件</strong>。</p>
<p>这决定了，在需要对数据进行分组统计的时候，HAVING 可以完成 WHERE 不能完成的任务。这是因为，在查询语法结构中，WHERE 在 GROUP BY 之前，所以无法对分组结果进行筛选。HAVING 在 GROUP BY 之后，可以使用分组字段和分组中的计算函数，对分组的结果集进行筛选，这个功能是 WHERE 无法完成的。另外，WHERE 排除的记录不在包括在分组中。</p>
<p>区别二：<strong>如果需要通过连接从关联表中获取需要的数据，WHERE 是先筛选后连接，而 HAVING 是先连接后筛选</strong>。</p>
<p>这一点，就决定了在关联查询中，WHERE 比 HAVING 更高效。因为 WHERE 可以先筛选，用一个筛选后的较小数据集和关联表进行连接，这样占用的资源比较少，执行效率也比较高。HAVING 则需要先把结果集准备好，也就是用未被筛选的数据集进行关联，然后对这个大的数据集进行筛选，这样占用的资源就比较多，执行效率也较低。</p>
<table>
<thead>
<tr>
<th></th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody><tr>
<td>WHERE</td>
<td>先筛选数据在关联，执行效率高</td>
<td>不能使用分组中的计算函数进行筛选</td>
</tr>
<tr>
<td>HAVING</td>
<td>可以使用分组中的计算函数</td>
<td>在最后的结果集中进行筛选，执行效率较低</td>
</tr>
</tbody></table>
<p> 开发中的选择：</p>
<p>WHERE 和 HAVING 也不是互相排斥的，可以在一个查询里面同时使用 WHERE 和 HAVING。包含分组统计函数的条件用 HAVING，普通条件用 WHERE。这样，既利用了 WHERE 条件的高效快速，又发挥了HAVING 可以使用包含分组统计函数的查询条件的优点。当数据量特别大的时候，运行效率会有很大的差别。</p>
<h4 id="4-4-SQL-语句的执行过程"><a href="#4-4-SQL-语句的执行过程" class="headerlink" title="4.4 SQL 语句的执行过程"></a>4.4 SQL 语句的执行过程</h4><p>查询的结构</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">column</span>, group_function</span><br><span class="line"><span class="keyword">FROM</span> table1</span><br><span class="line">[<span class="keyword">LEFT</span> <span class="operator">/</span> <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> table2 <span class="keyword">ON</span> <span class="keyword">condition</span>]</span><br><span class="line">[<span class="keyword">WHERE</span> <span class="keyword">condition</span>]</span><br><span class="line">[<span class="keyword">GROUP</span> <span class="keyword">BY</span> group_by_expression]</span><br><span class="line">[<span class="keyword">HAVING</span> group_condition]</span><br><span class="line">[<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">column</span> <span class="keyword">ASC</span> <span class="operator">/</span> <span class="keyword">DESC</span>]</span><br><span class="line">[LIMIT pageNum, pageSize];</span><br></pre></td></tr></table></figure>

<p>SELECT 执行顺序：</p>
<ol>
<li><p>关键字的顺序是不能颠倒的：</p>
 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ... <span class="keyword">FROM</span> ... <span class="keyword">WHERE</span> ... <span class="keyword">GROUP</span> <span class="keyword">BY</span> ... <span class="keyword">HAVING</span> ... <span class="keyword">ORDER</span> <span class="keyword">BY</span> ... LIMIT ...</span><br></pre></td></tr></table></figure>
</li>
<li><p>SELECT 语句的执行顺序：</p>
 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">HAVING</span> <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">DISTINCT</span> <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="operator">-</span><span class="operator">&gt;</span> LIMIT</span><br></pre></td></tr></table></figure>

 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> left_table</span><br><span class="line"><span class="keyword">ON</span> join_condition</span><br><span class="line"><span class="keyword">LEFT</span> <span class="operator">/</span> <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> right_table</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">condition</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> group_by_list</span><br><span class="line"><span class="keyword">HAVING</span> having_condition</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line"><span class="keyword">DISTINCT</span> select_list</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> order_by_condition</span><br><span class="line">LIMIT limit_number;</span><br></pre></td></tr></table></figure>

<p> 在 SELECT 语句执行这些步骤的时候，每个步骤都会产生一个虚拟表，然后将这个虚拟表传入下一个步骤中作为输入。需要注意的是，这些步骤隐含在 SQL 的执行过程中，对于我们来说是不可见的。</p>
</li>
<li><p>SQL 的执行原理</p>
<p> SELECT 是先执行 FROM 这一步的。在这个阶段，如果是多张表联查，还会经历下面的几个步骤：</p>
<ol>
<li>首先先通过 CROSS JOIN 求笛卡尔积，相当于得到虚拟表 vt1-1；</li>
<li>通过 ON 进行筛选，在虚拟表 vt1-1 的基础上进行筛选，得到虚拟表 vt1-2；</li>
<li>添加外部行。如果使用的是左连接、右连接或者全连接，就会涉及到外部行，也就是在虚拟表 vt1-2 的基础上增加外部行，得到虚拟表 vt1-3。</li>
</ol>
<p> 当然如果我们操作的是两张以上的表，还会重复上面的步骤，知道所有表都被处理完为止。这个过程得到是我们的原始数据。</p>
<p> 当我们拿到了查询数据表的原始数据，也就是最终的虚拟表 vt1，就可以在此基础上再进行 WHERE 阶段。在这个阶段中，会根据 vt1 表的结果进行筛选过滤，得到虚拟表 vt2。</p>
<p> 然后进入第三步和第四步，也就是 GROUP 和 HAVING 阶段。在这个阶段中，实际上是在虚拟表 vt2 的基础上进行分组和分组过滤，得到中间的虚拟表 vt3 和 vt4。</p>
<p> 当我们完成了条件筛选部分之后，就可以筛选表中提取的字段，也就是进入到 SELECT 和 DISTINCT 阶段。</p>
<p> 首先在 SELECT 阶段会提取想要的字段，然后在 DISTINCT 阶段过滤掉重复的行，分别得到中间的虚拟表 vt5-1 和 vt5-2。</p>
<p> 当我们提取了想要的字段数据之后，就可以按照指定的字段进行排序，也就是 ORDER BY 阶段，得到虚拟表 vt6。</p>
<p> 最后在 vt6 的基础上，取出指定行的记录，也就是 LIMIT 阶段，得到最终的结果，对应的是虚拟表 vt7。</p>
<p> 当然我们在写 SELECT 语句的时候，不一定存在所有的关键字，相应的阶段就会省略。</p>
</li>
</ol>
<h2 id="八、子查询"><a href="#八、子查询" class="headerlink" title="八、子查询"></a>八、子查询</h2><h3 id="1-子查询的基本使用"><a href="#1-子查询的基本使用" class="headerlink" title="1. 子查询的基本使用"></a>1. 子查询的基本使用</h3><ul>
<li><p>子查询的基本语法结构：</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> select_list</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">table</span></span><br><span class="line"><span class="keyword">WHERE</span> expr operator</span><br><span class="line">									(<span class="keyword">SELECT</span> select_list</span><br><span class="line">                   <span class="keyword">FROM</span> <span class="keyword">table</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>子查询在主查询之前一次执行完成。</p>
</li>
<li><p>子查询的结果被主查询使用。</p>
</li>
<li><p>注意事项：</p>
<ul>
<li>子查询要包含在括号内</li>
<li>将子查询放在比较条件的右侧</li>
<li>单行操作符对应单行子查询，多行操作符对应多行子查询</li>
</ul>
</li>
</ul>
<h3 id="2-子查询的分类"><a href="#2-子查询的分类" class="headerlink" title="2. 子查询的分类"></a>2. 子查询的分类</h3><p>按子查询的结果返回一条还是多条记录分：</p>
<ul>
<li>单行子查询</li>
<li>多行子查询</li>
</ul>
<p>按子查询是否被执行多次分：</p>
<ul>
<li>相关子查询</li>
<li>不相关子查询</li>
</ul>
<p>子查询从数据表中查询了数据结果，如果这个数据结果只执行一次，然后这个数据结果作为主查询的条件进行执行，那么这样的子查询叫做不相关子查询。同样，如果子查询需要执行多次，即采用循环的方式，先从外部查询开始，每次都传入子查询进行查询，然后再将结果反馈给外部，这种嵌套的执行方式就称为相关子查询。</p>
<p>单行子查询比较操作符：</p>
<table>
<thead>
<tr>
<th>操作符</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>&#x3D;</td>
<td>Equal to</td>
</tr>
<tr>
<td>&gt;</td>
<td>Greater than</td>
</tr>
<tr>
<td>&gt;&#x3D;</td>
<td>Greater than or equal to</td>
</tr>
<tr>
<td>&lt;</td>
<td>Less than</td>
</tr>
<tr>
<td>&lt;&#x3D;</td>
<td>Less than or equal to</td>
</tr>
<tr>
<td>&lt;&gt;</td>
<td>Not equal to</td>
</tr>
</tbody></table>
<p>多行子查询比较操作符：</p>
<table>
<thead>
<tr>
<th>操作符</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>IN</td>
<td>等于列表中的任意一个</td>
</tr>
<tr>
<td>ANY</td>
<td>需要和单行比较操作符一起使用，和子查询返回的某一个值比较</td>
</tr>
<tr>
<td>ALL</td>
<td>需要和单行比较操作符一起使用，和子查询返回的所有值比较</td>
</tr>
<tr>
<td>SOME</td>
<td>实际上是 ANY 的别名，作用相同，一般常使用 ANY</td>
</tr>
</tbody></table>
<p>相关子查询</p>
<p>如果子查询的执行依赖于外部查询，通常情况下都是因为子查询中的表用到了外部的表，并进行了条件关联，因此每执行一次外部查询，子查询都要重新计算一次，这样的子查询就称之为关联子查询。</p>
<p>相关子查询按照一行接一行的顺序执行，主查询的每一行都执行一次子查询。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, column2,...</span><br><span class="line"><span class="keyword">FROM</span> table1 <span class="keyword">outer</span></span><br><span class="line"><span class="keyword">WHERE</span> column1 operator</span><br><span class="line">									(<span class="keyword">SELECT</span> column1, column2</span><br><span class="line">                   <span class="keyword">FROM</span> table2</span><br><span class="line">                   <span class="keyword">WHERE</span> expr1 <span class="operator">=</span> outer.expr2);</span><br></pre></td></tr></table></figure>

<p>:::tip</p>
<p>在查询语句中，除了在 GROUP BY 和 LIMIT 中不能使用子查询，其他地方都能使用子查询</p>
<p>:::</p>
<h2 id="九、创建和管理表"><a href="#九、创建和管理表" class="headerlink" title="九、创建和管理表"></a>九、创建和管理表</h2><h3 id="1-基础知识"><a href="#1-基础知识" class="headerlink" title="1. 基础知识"></a>1. 基础知识</h3><h4 id="1-1-一条数据存储的过程"><a href="#1-1-一条数据存储的过程" class="headerlink" title="1.1 一条数据存储的过程"></a>1.1 一条数据存储的过程</h4><p>存储数据是处理数据的第一步。只有正确地把数据存储起来，才能进行有效的处理和分析。否则，只能是一团乱麻，无从下手。一个完整的数据存储过程总共有 4 步，分别是<strong>创建数据库、确认字段、创建数据表、插入数据</strong>。</p>
<p>从系统结构的层次看，MySQL 数据库系统从大到小依次是数据库<code>服务器</code>、<code>数据库</code>、<code>数据表</code>、数据表的<code>行和列</code>。所以需要先创建一个数据库，而不是直接创建数据表。</p>
<h4 id="1-2-标识符命名规则"><a href="#1-2-标识符命名规则" class="headerlink" title="1.2 标识符命名规则"></a>1.2 标识符命名规则</h4><ul>
<li>数据库名、表名不得超过 30 个字符，变量名限制为 29 个</li>
<li>必须只能包含 A-Z，a-z，0-9，_ 共 63 个字符</li>
<li>数据库名、表名、字段名等对象名中间不要包含空格</li>
<li>同一个 MySQL 软件中，数据库不能同名；同一个库中，表不能重名；同一个表中，字段不能重名</li>
<li>必须保证字段没有和保留子、数据库系统或常用方法冲突。如果坚持使用，要在 SQL 中使用 &#96;&#96; 引起来</li>
<li>保持字段名和类型的一致性：在命名字段并为其制定数据类型的时候一定要保证一致性，加入数据类型在一个表里是整数，那在另一个表里可就别变成字符型了。</li>
</ul>
<h4 id="1-3-MySQL-中的数据类型"><a href="#1-3-MySQL-中的数据类型" class="headerlink" title="1.3 MySQL 中的数据类型"></a>1.3 MySQL 中的数据类型</h4><table>
<thead>
<tr>
<th>类型</th>
<th>类型举例</th>
</tr>
</thead>
<tbody><tr>
<td>整数类型</td>
<td>TINYINT、SMALLINT、MEDIUMINT、INT (或 INTEGER)、BIGINT</td>
</tr>
<tr>
<td>浮点类型</td>
<td>FLOAT、DOUBLE</td>
</tr>
<tr>
<td>定点数类型</td>
<td>DECIMAL</td>
</tr>
<tr>
<td>位类型</td>
<td>BIT</td>
</tr>
<tr>
<td>日期时间类型</td>
<td>YEAR、TIME、DATE、DATETIME、TIMESTAMP</td>
</tr>
<tr>
<td>文本字符串类型</td>
<td>CHAR、VARCHAR、TINYTEXT、TEXT、MEDIUMTEXT、LONGTEXT</td>
</tr>
<tr>
<td>枚举类型</td>
<td>ENUM</td>
</tr>
<tr>
<td>集合类型</td>
<td>SET</td>
</tr>
<tr>
<td>二进制字符串类型</td>
<td>BINARY、VAEBINARY、TINYBLOB、BLOB、MEDIUMBLOB、LONGBLOB</td>
</tr>
<tr>
<td>JSON类型</td>
<td>JSON 对象、JSON 数组</td>
</tr>
<tr>
<td>空间数据类型</td>
<td>单值：GEOMETRY、POINT、LINESTRING、POLYGON；<br />集合：MULTIPOINT、MULTILINESTRING、MULTIPOLYGON、GEOMETRYCOLLECTION</td>
</tr>
</tbody></table>
<p>其中，常用的几类类型介绍如下：</p>
<table>
<thead>
<tr>
<th>数据类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>INT</td>
<td>从 -2<sup>31</sup> 到 2<sup>31</sup> - 1 的整型数据。存储大小为 4 个字节</td>
</tr>
<tr>
<td>CHAR(size)</td>
<td>定长字符数据。若未指定，默认为 1 个字符，最大长度 255</td>
</tr>
<tr>
<td>VARCHAR(size)</td>
<td>可变长字符数据，根据字符串实际长度保存，必须指定长度</td>
</tr>
<tr>
<td>FLOAT(M, D)</td>
<td>单精度，占用 4 个字节，M &#x3D; 整数位 + 小数位，D &#x3D; 小数位。D ≤ M ≤ 255，0 ≤ D ≤ 30，默认 M + D ≤ 6</td>
</tr>
<tr>
<td>DOUBLE(M, D)</td>
<td>双精度，占用 8 个字节，D ≤ M ≤ 255，0 ≤ D ≤ 30，默认 M + D ≤ 15</td>
</tr>
<tr>
<td>DECIMAL(M, D)</td>
<td>高精度小数，占用 M + 2 个字节，D ≤ M ≤ 65，0 ≤ D ≤ 30，最大取值范围与 DOUBLE 相同</td>
</tr>
<tr>
<td>DATE</td>
<td>日期型数据，格式 ‘YYYY-MM-DD’</td>
</tr>
<tr>
<td>BLOB</td>
<td>二进制形式的长文本数据，最大可达 4G</td>
</tr>
<tr>
<td>TEXT</td>
<td>长文本数据，最大可达 4G</td>
</tr>
</tbody></table>
<h3 id="2-创建和管理数据库"><a href="#2-创建和管理数据库" class="headerlink" title="2. 创建和管理数据库"></a>2. 创建和管理数据库</h3><h4 id="2-1-创建数据库"><a href="#2-1-创建数据库" class="headerlink" title="2.1 创建数据库"></a>2.1 创建数据库</h4><ul>
<li><p>方式一：创建数据库</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE 数据库名；</span><br></pre></td></tr></table></figure>
</li>
<li><p>方式二：创建数据库并指定字符集</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE 数据库名 <span class="type">CHARACTER</span> <span class="keyword">SET</span> 字符集；</span><br></pre></td></tr></table></figure>
</li>
<li><p>方式三：判断数据库是否已经存在，不存在则创建数据库 (推荐)</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> 数据库名；</span><br></pre></td></tr></table></figure></li>
</ul>
<p>如果 MySQL 中已经存在相关的数据库，则忽略创建语句，不再创建数据库。</p>
<p>:::tip</p>
<p>DATABASE 不能改名。一些可视化工具可以改名，它是建新库，把所有表复制到新库，再删旧库完成的。</p>
<p>:::  </p>
<h4 id="2-2-使用数据库"><a href="#2-2-使用数据库" class="headerlink" title="2.2 使用数据库"></a>2.2 使用数据库</h4><ul>
<li><p>查看当前所有的数据库</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> DATABASE;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看当前正在使用的数据库</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DATABASE();</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看置顶库下所有的表</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> TABLES <span class="keyword">FROM</span> 数据库名;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看数据库的创建信息</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> DATABASE 数据库名;</span><br><span class="line">或</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> DATABASE 数据库名\G</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用、切换数据库</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USE 数据库名;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-3-修改数据库"><a href="#2-3-修改数据库" class="headerlink" title="2.3 修改数据库"></a>2.3 修改数据库</h4><ul>
<li><p>更改数据库字符集</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> DATABASE 数据库名 <span class="type">CHARACTER</span> <span class="keyword">SET</span> 字符集; #比如：gbk、utf 等</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-4-删除数据库"><a href="#2-4-删除数据库" class="headerlink" title="2.4 删除数据库"></a>2.4 删除数据库</h4><ul>
<li><p>方式一：删除指定的数据库</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> DATABASE 数据库名;</span><br></pre></td></tr></table></figure>
</li>
<li><p>方式二：删除指定的数据库 (推荐)</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> DATABASE IF <span class="keyword">EXISTS</span> 数据库名;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-创建和管理表"><a href="#3-创建和管理表" class="headerlink" title="3. 创建和管理表"></a>3. 创建和管理表</h3><h4 id="3-1-创建表"><a href="#3-1-创建表" class="headerlink" title="3.1 创建表"></a>3.1 创建表</h4><p>方式一：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> 表名(</span><br><span class="line">		字段<span class="number">1</span>，数据类型 [约束条件] [默认值],</span><br><span class="line">  	字段<span class="number">2</span>，数据类型 [约束条件] [默认值],</span><br><span class="line">    字段<span class="number">3</span>，数据类型 [约束条件] [默认值],</span><br><span class="line">    ……</span><br><span class="line">  	[表约束条件]</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>方式二：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> 表名 </span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">column</span> </span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">table</span> </span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br></pre></td></tr></table></figure>

<p>将查询结果作为表数据进行创建。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DESC</span> 表名;#显示表结构</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表名\G #查看数据表结构和创建时的详细语句等</span><br></pre></td></tr></table></figure>

<h4 id="3-2-修改表"><a href="#3-2-修改表" class="headerlink" title="3.2 修改表"></a>3.2 修改表</h4><p>使用 ALTER TABLE 语句可以实现：</p>
<ul>
<li>向已有的表中添加列</li>
<li>修改现有表中的列</li>
<li>删除现有表中的列</li>
<li>重命名现有表中的列</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#添加字段</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">ADD</span> 字段名 字段类型 <span class="keyword">FIRST</span> <span class="operator">/</span> AFTER 字段名; #<span class="keyword">FIRST</span> 表示添加到最前面，AFTER 指定添加到某字段后面</span><br><span class="line">#修改字段</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 MODIFY 字段名</span><br><span class="line">#重命字段名</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 CHANGE 字段名</span><br><span class="line">#删除字段</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> 字段名</span><br></pre></td></tr></table></figure>

<h4 id="3-3-重命名表"><a href="#3-3-重命名表" class="headerlink" title="3.3 重命名表"></a>3.3 重命名表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RENAME <span class="keyword">TABLE</span> oldName <span class="keyword">TO</span> newName;</span><br><span class="line">或</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">table</span> oldName RENAME <span class="keyword">TO</span> newName;</span><br></pre></td></tr></table></figure>

<h4 id="3-4-删除表"><a href="#3-4-删除表" class="headerlink" title="3.4 删除表"></a>3.4 删除表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> 表名;</span><br><span class="line">或</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> 表名;</span><br></pre></td></tr></table></figure>

<p>:::warning</p>
<p>DROP TABLE 语句不能回滚</p>
<p>:::</p>
<h4 id="3-5-清空表"><a href="#3-5-清空表" class="headerlink" title="3.5 清空表"></a>3.5 清空表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> 表名；</span><br><span class="line">或</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> 表名;</span><br></pre></td></tr></table></figure>

<p>:::warning</p>
<p>TRUNCATE TABLE 语句不能回滚</p>
<p>:::</p>
<h3 id="4-DCL-中的-COMMIT-和-ROLLBACK-的使用"><a href="#4-DCL-中的-COMMIT-和-ROLLBACK-的使用" class="headerlink" title="4. DCL 中的 COMMIT 和 ROLLBACK 的使用"></a>4. DCL 中的 COMMIT 和 ROLLBACK 的使用</h3><p><strong>COMMIT</strong>：提交数据。一旦执行 COMMIT，则数据被永久的保存在了数据库中，意味着数据不可以回滚。</p>
<p><strong>ROLLBACK</strong>：回滚数据。一旦执行 ROLLBACK，则可以实现数据的回滚。回滚到最近的一次 COMMIT 之后。</p>
<p><strong>DDL 和 DML 说明：</strong></p>
<ol>
<li>DDL 的操作一旦执行，就不可以回滚。指令 SET autocommit &#x3D; FALSE 对 DDL 无效。因为在执行完 DDL 之后，一定回执行一次 COMMIT。而此时 COMMIT 操作不受 SET autocommit &#x3D; FALSE 的影响。</li>
<li>DML 的操作默认情况也是一旦执行就不可回滚。但是可以在执行 DML 之前执行 SET  autocommit &#x3D; FALSE，则执行的 DML 操作就可以实现回滚。</li>
</ol>
<blockquote>
<p>阿里开发规范：</p>
<p>【参考】TRUNCATE TABLE 比 DELETE 速度快，且使用的系统和事物日志资源少，但 TRUNCATE 无事物且不出发 TRIGGER，有可能造成事故，故不建议再开发代码中使用此语句。</p>
<p>说明：TRUNCATE TABLE 在功能上与不带 WHERE 子句的 DELETE 语句相同。</p>
</blockquote>
<h3 id="5-阿里巴巴《Java-开发手册》之-MySQL-字段命名"><a href="#5-阿里巴巴《Java-开发手册》之-MySQL-字段命名" class="headerlink" title="5. 阿里巴巴《Java 开发手册》之 MySQL 字段命名"></a>5. 阿里巴巴《Java 开发手册》之 MySQL 字段命名</h3><ul>
<li><p>【强制】表名、字段名必须使用小写字母或数字， 禁止出现数字开头，禁止两个下划线中间只<br>  出现数字。数据库字段名的修改代价很大，因为无法进行预发布，所以字段名称需要慎重考虑。</p>
<ul>
<li>正例： getter_admin， task_config， level3_name</li>
<li>反例： GetterAdmin， taskConfig， level_3_name</li>
</ul>
</li>
<li><p>【强制】禁用保留字，如 desc、 range、 match、 delayed 等， 请参考 MySQL 官方保留字。</p>
</li>
<li><p>【强制】表必备三字段： id, gmt_create, gmt_modified。</p>
<ul>
<li>说明： 其中 id 必为主键，类型为 unsigned bigint、单表时自增、步长为 1。 gmt_create,<br>  gmt_modified 的类型均为 date_time 类型。</li>
</ul>
</li>
<li><p>【推荐】表的命名最好是加上“业务名称_表的作用”。</p>
<ul>
<li>正例： tiger_task &#x2F; tiger_reader &#x2F; mpp_config</li>
</ul>
</li>
<li><p>【推荐】库名与应用名称尽量一致。</p>
</li>
<li><p>【参考】合适的字符存储长度，不但节约数据库表空间、节约索引存储，更重要的是提升检索速度。</p>
<ul>
<li>正例： 如下表，其中无符号值可以避免误存负数， 且扩大了表示范围。</li>
</ul>
<table>
<thead>
<tr>
<th>对象</th>
<th>年龄区间</th>
<th>类型</th>
<th>字节</th>
<th>表示范围</th>
</tr>
</thead>
<tbody><tr>
<td>人</td>
<td>150岁之内</td>
<td>tinying unsigned</td>
<td>1</td>
<td>无符号值：0～255</td>
</tr>
<tr>
<td>龟</td>
<td>数百岁</td>
<td>smallint unsigned</td>
<td>2</td>
<td>无符号值：0～65535</td>
</tr>
<tr>
<td>恐龙化石</td>
<td>数千万年</td>
<td>int unsigned</td>
<td>4</td>
<td>无符号值：0～约 43 亿</td>
</tr>
<tr>
<td>太阳</td>
<td>约 50 亿年</td>
<td>bigint unsigned</td>
<td>8</td>
<td>无符号值：0～约 10<sup>19</sup></td>
</tr>
</tbody></table>
</li>
</ul>
<h3 id="6-如何理解清空表、删除表等操作需谨慎？"><a href="#6-如何理解清空表、删除表等操作需谨慎？" class="headerlink" title="6. 如何理解清空表、删除表等操作需谨慎？"></a>6. 如何理解清空表、删除表等操作需谨慎？</h3><p><strong>表删除</strong>操作将把表的定义和表中的数据一起删除，并且 MySQL在执行删除操作时，不会有任何的确认信息提示，因此执行行删除操作时应当慎重。在删除表前，最好对表中的数据进行备份，这样当操作失误时可以对数据进行恢复，以免造成无法挽回的后果。</p>
<p>同样的，在使用 <code>ALTER TABKE</code> 进行表的基本修改操作时，在执行操作过程之前，也应该确保对数据进行完整的备份，因为数据库的改变时无法撤销的，如果添加了一个不需要的字段，可以将其删除；相同的，如果删除了一个需要的列，该列下面的所有数据都将会丢失。</p>
<h3 id="7-MySQL-8-新特性——DDL-的原子化"><a href="#7-MySQL-8-新特性——DDL-的原子化" class="headerlink" title="7. MySQL 8 新特性——DDL 的原子化"></a>7. MySQL 8 新特性——DDL 的原子化</h3><p>在 MySQL 8.0 版本中，InnoDB 表的 DDL 支持事物完整性，即 DDL 操作要么成功要么回滚。DDL 操作回滚日志写入到 data dictionary 数据字典表 mysql.innodb_ddl_log (该表是隐藏的表，通过 show tables 无法看到) 中，用于回滚操作。通过设置参数，可将 DDL 操作日志打印输出到 MySQL 错误日志中。</p>
<h2 id="十、数据处理之增删改"><a href="#十、数据处理之增删改" class="headerlink" title="十、数据处理之增删改"></a>十、数据处理之增删改</h2><h3 id="1-插入数据"><a href="#1-插入数据" class="headerlink" title="1. 插入数据"></a>1. 插入数据</h3><h4 id="1-1-方式一：VALUES-的方式添加"><a href="#1-1-方式一：VALUES-的方式添加" class="headerlink" title="1.1 方式一：VALUES 的方式添加"></a>1.1 方式一：VALUES 的方式添加</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">VALUES</span> 中字段的顺序需要和表结构中字段的声明顺序一致</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表名</span><br><span class="line"><span class="keyword">VALUES</span>(value1, value2, value3, ...);</span><br><span class="line"># <span class="keyword">value</span> 与 <span class="keyword">column</span> 保持一致</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表名(column1, column2, column3, ...)</span><br><span class="line"><span class="keyword">VALUES</span>(value1, value2, value3, ...);</span><br><span class="line"># 一次性插入多条数据</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表名(column1, column2, column3, ...)</span><br><span class="line"><span class="keyword">VALUES</span></span><br><span class="line">(value1, value2, value3, ...),</span><br><span class="line">(value1, value2, value3, ...),</span><br><span class="line">(value1, value2, value3, ...);</span><br></pre></td></tr></table></figure>

<h4 id="1-2-方式二：将查询结果插入到表中"><a href="#1-2-方式二：将查询结果插入到表中" class="headerlink" title="1.2 方式二：将查询结果插入到表中"></a>1.2 方式二：将查询结果插入到表中</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> table1</span><br><span class="line">(column1, column2, column3, ...)</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">(column1, column2, column3, ...)</span><br><span class="line"><span class="keyword">FROM</span> table2</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br></pre></td></tr></table></figure>

<h3 id="2-删除数据"><a href="#2-删除数据" class="headerlink" title="2. 删除数据"></a>2. 删除数据</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">table</span></span><br><span class="line"><span class="keyword">SET</span> column1 <span class="operator">=</span> value1, column2 <span class="operator">=</span> value2, column3 <span class="operator">=</span> value3, ...</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-修改数据"><a href="#3-修改数据" class="headerlink" title="3. 修改数据"></a>3. 修改数据</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br></pre></td></tr></table></figure>

<h3 id="4-MySQL-8-新特性——计算列"><a href="#4-MySQL-8-新特性——计算列" class="headerlink" title="4. MySQL 8 新特性——计算列"></a>4. MySQL 8 新特性——计算列</h3><p>什么叫计算列呢？简单来说就是某一列的值是通过别的列计算得到的。例如，a 列值为 1、b 列值为 2，c 列不需要手动插入，定义 a + b 的结果为 c 的值，那么 c 就是计算列，是通过别的列计算得到的。</p>
<p>在 MySQL 8.0 中，CREATE TABLE 和 ALTER TABLE 中都支持增加计算列。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tb1(</span><br><span class="line">id <span class="type">INT</span>,</span><br><span class="line">a <span class="type">INT</span>,</span><br><span class="line">b <span class="type">INT</span>,</span><br><span class="line">c <span class="type">INT</span> GENERATED ALWAYS <span class="keyword">AS</span> (a <span class="operator">+</span> b) VIRTUAL);</span><br></pre></td></tr></table></figure>

<p>计算列不管是插入数据还是修改数据时，相应的列的值发生改变，计算列也会跟着改变，而且插入时，不用插入计算列。</p>
<h2 id="十一、MySQL-数据类型精讲"><a href="#十一、MySQL-数据类型精讲" class="headerlink" title="十一、MySQL 数据类型精讲"></a>十一、MySQL 数据类型精讲</h2><h3 id="1-MySQL-中的数据类型"><a href="#1-MySQL-中的数据类型" class="headerlink" title="1. MySQL 中的数据类型"></a>1. MySQL 中的数据类型</h3><table>
<thead>
<tr>
<th>类型</th>
<th>类型举例</th>
</tr>
</thead>
<tbody><tr>
<td>整数类型</td>
<td>TINYINT、SMALLINT、MEDIUMINT、INT (或 INTEGER)、BIGINT</td>
</tr>
<tr>
<td>浮点类型</td>
<td>FLOAT、DOUBLE</td>
</tr>
<tr>
<td>定点数类型</td>
<td>DECIMAL</td>
</tr>
<tr>
<td>位类型</td>
<td>BIT</td>
</tr>
<tr>
<td>日期时间类型</td>
<td>YEAR、TIME、DATE、DATETIME、TIMESTAMP</td>
</tr>
<tr>
<td>文本字符串类型</td>
<td>CHAR、VARCHAR、TINYTEXT、TEXT、MEDIUMTEXT、LONGTEXT</td>
</tr>
<tr>
<td>枚举类型</td>
<td>ENUM</td>
</tr>
<tr>
<td>集合类型</td>
<td>SET</td>
</tr>
<tr>
<td>二进制字符串类型</td>
<td>BINARY、VAEBINARY、TINYBLOB、BLOB、MEDIUMBLOB、LONGBLOB</td>
</tr>
<tr>
<td>JSON类型</td>
<td>JSON 对象、JSON 数组</td>
</tr>
<tr>
<td>空间数据类型</td>
<td>单值：GEOMETRY、POINT、LINESTRING、POLYGON；<br />集合：MULTIPOINT、MULTILINESTRING、MULTIPOLYGON、GEOMETRYCOLLECTION</td>
</tr>
</tbody></table>
<p>常见数据类型的属性：</p>
<table>
<thead>
<tr>
<th>MySQL关键字</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>NULL</td>
<td>数据列可包含 NULL 值</td>
</tr>
<tr>
<td>NOT NULL</td>
<td>数据列不可包含 NULL 值</td>
</tr>
<tr>
<td>DEFAULT</td>
<td>默认值</td>
</tr>
<tr>
<td>PRIMARY KEY</td>
<td>主键</td>
</tr>
<tr>
<td>AUTO_INCREMENT</td>
<td>自动递增，适用于整数类型</td>
</tr>
<tr>
<td>UNSIGNED</td>
<td>无符号</td>
</tr>
<tr>
<td>CHARACTER SET name</td>
<td>指定一个字符集</td>
</tr>
</tbody></table>
<h3 id="2-整数类型"><a href="#2-整数类型" class="headerlink" title="2. 整数类型"></a>2. 整数类型</h3><table>
<thead>
<tr>
<th align="left">整数类型</th>
<th align="center">字节</th>
<th align="center">有符号数取值范围</th>
<th align="left">无符号数取值范围</th>
</tr>
</thead>
<tbody><tr>
<td align="left">TINYINT</td>
<td align="center">1</td>
<td align="center">-128～127</td>
<td align="left">0～255</td>
</tr>
<tr>
<td align="left">SMALLINT</td>
<td align="center">2</td>
<td align="center">-32768～32767</td>
<td align="left">0～65535</td>
</tr>
<tr>
<td align="left">MEDIUMINT</td>
<td align="center">3</td>
<td align="center">-8388608～8388607</td>
<td align="left">0～16777215</td>
</tr>
<tr>
<td align="left">INT (或 INTEGER)</td>
<td align="center">4</td>
<td align="center">-2147483648～2147483647</td>
<td align="left">0～4294967295</td>
</tr>
<tr>
<td align="left">BIGINT</td>
<td align="center">8</td>
<td align="center">-9223372036854775808～9223372036854775807</td>
<td align="left">0～18446744073709551615</td>
</tr>
</tbody></table>
<p><strong>可选属性：</strong></p>
<p>整数类型的可选属性有三个：</p>
<ul>
<li><p>M</p>
<p>  M 表示显示宽度，M 的取值范围时 (0, 255)。例如，int(5)：当数据宽度小于 5 位时，在数字前面需要用字符填满宽度。该项功能需要配合 ZEROFILL 使用，表示用 0 填满宽度，否则指定显示宽度无效。</p>
<p>  显示宽度不会对插入的数据有任何影响，如果插入的数据宽度超过了显示宽度限制，还是按照类型的实际宽度进行保存，即 <code>显示宽度与类型可以存储的值范围无关</code>。<strong>从 MySQL 8.0.17 开始，整数数据类型不推荐使用显示宽度属性</strong>。</p>
<p>  整数数据类型可以在定义表结构时指定所需要的显示宽度，如果不指定，则系统为每一种类型指定默认的宽度值。</p>
</li>
<li><p>UNSINGED</p>
<p>  无符号类型 (非负)，所有的整数类型都有一个可选的属性 UNSIGNED (无符号属性)，无符号整数类型的最小取值为 0.所以，如果需要在 MySQL 数据库中保存非负整数值时，可以将整数类型设置为无符号类型。</p>
<p>  int 类型默认显示宽度为 int(11)，无符号 int 类型默认显示宽度为 int(10)。</p>
</li>
<li><p>ZEROFILL</p>
<p>  0 填充，(如果某列是 ZEROFILL，那么 MySQL 会自动为当前列添加 UNSIGNED 属性)，如果指定了 ZEROFILL 知识表示不够 M 位时，用 0 在左边填充，如果超过 M 位，只要不超过数据存储范围即可。</p>
<p>  原来，在 int(M) 中，M 的值跟 int(M) 所占多少存储空间并无任何关系。int(2)、int(4)、int(8) 在磁盘上都是占用 4 bytes 的存储空间。也就是说，<strong>int(M)，必须和 UNSIGNED ZEROFILL 一起使用才有意义</strong>。如果整数值超过 M 位，就按照实际位数存储。知识无须再用字符 0 进行填充。</p>
</li>
</ul>
<p><strong>使用场景：</strong></p>
<p>TINYINT：一般用于枚举数据，比如系统设定取值范围很小且固定的场景。</p>
<p>SMALLINT：可以用于较小范围的统计数据，比如统计工厂的固定资产库存数量等。</p>
<p>MEDIUMINT：用于较大整数的计算，比如车站每日的客流量等。</p>
<p>INT、INTEGER：取值范围足够大，一般情况下不用考虑超限问题，用得最多。比如商品编号。</p>
<p>BIGINT：只有当处理特别巨大的整数时才会用到。比如双十一的交易量、大型门户网站点击量、证券公司衍生产品持仓等。</p>
<p><strong>如何选择：</strong></p>
<p>在评估用哪种整数类型的时候，需要考虑存储空间和可靠性的平衡问题：一方面，用占用字节数少的整数类型可以节省存储空间；另一方面，要是为了节省存储空间，使用的整数类型取值范围太小，一旦遇到超出取值范围的情况，就可能引起系统错误，影响可靠性。</p>
<p>在实际工作中，<strong>系统故障产生的成本远远超过增加几个字段存储空间所产生的成本</strong>。所以，建议首先确保数据不会超过取值范围，在这个前提之下，再去考虑如何节省存储空间。 </p>
<h3 id="3-浮点类型"><a href="#3-浮点类型" class="headerlink" title="3. 浮点类型"></a>3. 浮点类型</h3><h4 id="3-1-类型介绍"><a href="#3-1-类型介绍" class="headerlink" title="3.1 类型介绍"></a>3.1 类型介绍</h4><p>浮点数和定点数类型的特点是可以处理小数，你可以把整数看成小数的一个 特例。因此，浮点数和定点数的使用场景，比整数大多了。MySQL 支持的浮点数类型，分别是 FLOAT、DOUBLE、REAL。</p>
<ul>
<li><p>FLOAT 表示单精度浮点数；</p>
</li>
<li><p>DOUBLE 表示双精度浮点数；</p>
<table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">有符号数取值范围</th>
<th align="center">无符号数取值范围</th>
<th align="center">占用字节数</th>
</tr>
</thead>
<tbody><tr>
<td align="center">FLOAT</td>
<td align="center">(-3.402823466E+38, -1.175494351E), 0, (1.175494351E-38, 3.402823466351E+38)</td>
<td align="center">0, (1.175494351E-38, 3.402823466351E+38)</td>
<td align="center">4</td>
</tr>
<tr>
<td align="center">DOUBLE</td>
<td align="center">(-1.7976931348623157E+308, -2.225073858072014E-308), 0, (2.2250738585072014E-308, 1.7976931348623157E+308)</td>
<td align="center">0, (2.225073858072014E-308, 1.7976931348623157E+308)</td>
<td align="center">8</td>
</tr>
</tbody></table>
</li>
<li><p>REAL 默认是 DOUBLE。如果把 SQL 模式设定为启用 <code>REAL_AS_FLOAT</code>，那么，MySQL 就认为 REAL 是 FLOAT。如果要启用 <code>REAL_AS_FLOAT</code>，就可以通过一下 SQL 语句实现：</p>
<p>  <code>SET sql_mode = &quot;REAL_AS_FLOAT&quot;;</code></p>
</li>
</ul>
<p><strong>问题1</strong>：FLOAT 和 DOUBLE 这两种数据类型的区别是什么？</p>
<p>FLOAT 占用字节数少，取值范围更小；DOUBLE 占用字节数多，取值范围也大。</p>
<p><strong>问题2</strong>：为什么浮点数类型的无符号取值范围，只相当于有符号数取值范围的一半，也就是只相当于有符号数取值范围大于等于零的部分呢？</p>
<p>MySQL 存储浮点数的格式为：<code>符号(S)</code>、<code>尾数(M)</code>、和<code>阶码(E)</code>。因此，无论有没有符号，MySQL 的浮点数都会存储表示符号的部分。因此，所谓的无符号取值范围，其实就是有符号数取值范围大于等于零的部分。</p>
<h4 id="3-2-数据精度说明"><a href="#3-2-数据精度说明" class="headerlink" title="3.2 数据精度说明"></a>3.2 数据精度说明</h4><p>对于浮点类型，在 MySQL 中单精度值使用 4 个字节，双精度值使用 8 个字节。</p>
<ul>
<li><p>MySQL 允许使用非标准语法 (其他数据库未必支持，因此如果涉及到数据迁移，则最好不要这么用)：</p>
<p>  FLOAT(M, D) 或 DOUBLE(M, D)。这里，M 称为精度，D 称为标度。(M, D) 中 M &#x3D; 整数位 + 小数位，D &#x3D; 小数位。D ≤ M ≤ 255, 0 ≤ D ≤ 30</p>
</li>
<li><p>FLOAT 和 DOUBLE 类型在不指定 (M, D) 时，默认会按照实际的精度 (由实际的硬件和操作系统决定) 来显示。</p>
</li>
<li><p>说明：浮点类型，也可以加 UNSIGNED，但是不会改变数据范围，例如：FLOAT(3, 2) UNSIGNED 仍然只能表示 0 ～ 9099 的范围。</p>
</li>
<li><p>不管是否显式设置了精度 (M, D)，这里 MySQL 的处理方案如下：</p>
<ul>
<li>如果存储时，整数部分超出了范围，MySQL 就会报错，不允许存这样的值</li>
<li>如果存储时，小数点部分若超出范围，就分以下情况：<ul>
<li>若四舍五入后，整数部分没有超出范围，则只警告，但能成功操作并四舍五入删除多余的小数位后保存。例如在 FLOAT(5, 2) 列内插入 999.009，近似结果是 999.01。</li>
<li>若四舍五入后，整数部分超出范围，则 MySQL 报错，并拒绝处理。如 FLOAT(5, 2) 列内插入 999.995 和 -99.995 都会报错。</li>
</ul>
</li>
</ul>
</li>
<li><p>从 MySQL 8.0.17 开始，FLOAT(M, D) 和 DOUBLE(M, D) 用法在官方文档中已经明确不推荐使用，将来可能被移除。另外，关于浮点型 FLOAT 和 DOUBLE 的 UNSIGNED 也不推荐使用了，将来也可能被移除。</p>
</li>
</ul>
<h4 id="3-3-精度误差说明"><a href="#3-3-精度误差说明" class="headerlink" title="3.3 精度误差说明"></a>3.3 精度误差说明</h4><p>浮点数类型有个缺陷，就是不精准。比如：设计一个表，有 price 这个字段，插入值分别为 0.47, 0.44, 0.19，期待的运行结果是：0.47 + 0.44 + 0.19 &#x3D; 1.1。但是使用 sum() 查询结果为 1.0999999999999999。</p>
<p>虽然误差很小，但是确实存在，为什么会存在这样的误差？问题还是出现在 MySQL 对浮点类型数据的存储方式上。</p>
<p>MySQL 用 4 个字节存储 FLOAT 类型数据，用 8 个字节来存储 DOUBLE 类型数据。无论哪个，都是采用二进制的方式来进行存储的。比如 9.625，用二进制来表示，就是 1001.101，或者表达成 1.001101× 2<sup>3</sup>。如果尾数不是 0 或 5 (比如 9.624)，就无法使用一个二进制数来精确表达。进而，就只好在取值允许的范围内进行四舍五入。</p>
<p>在编程中，如果用到浮点数，要特别注意误差问题：<strong>因为浮点数是不准确的，所以要避免使用 &#x3D; 来判断两个数是否相等</strong>。同时，在一些对精确度要求较高的项目中，千万不要使用浮点数，不然会导致结果错误，甚至是造成不可挽回的损失。那么，MySQL 有没有精确的数据类型呢？当然有，这就是定点数类型：<strong>DECIMAL</strong>。</p>
<h3 id="4-定点数类型"><a href="#4-定点数类型" class="headerlink" title="4. 定点数类型"></a>4. 定点数类型</h3><h4 id="4-1-类型介绍"><a href="#4-1-类型介绍" class="headerlink" title="4.1 类型介绍"></a>4.1 类型介绍</h4><ul>
<li><p>MySQL 中的定点数类型只有 DECIMAL 一种类型。</p>
<table>
<thead>
<tr>
<th align="center">数据类型</th>
<th align="center">字节数</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">DECIMAL(M, D), DEC, NUMERIC</td>
<td align="center">M + 2 字节</td>
<td align="center">有效范围由 M 和 D 决定</td>
</tr>
</tbody></table>
<p>  使用 DECIMAL(M, D) 的方式表示高精度小数。其中，M 被称为精度，D 被称为标度。D ≤ M ≤ 65,0 ≤ D ≤30。D &lt; M。例如，定义 DECIMAL(5, 2) 的类型，表示该取值范围是 -999.99～999.99。</p>
</li>
<li><p>DECIMAL(M, D) 的最大取值范围与 DOUBLE 类型一样，但是有效的数据范围是由 M 和 D 决定的。DECIMAL 的存储空间并不是固定的，由精度值 M 决定，总共占用存储空间为 M + 2 个字节。也就是说，在一些对精度要求不高的场景下，比起占用同样字节长度的定点数，浮点数表达的数值范围可以更大一些。</p>
</li>
<li><p>定点数在 MySQL 内部是以字符串的形式进行存储，这就决定了它一定是精准的。</p>
</li>
<li><p>当 DECIMAL 类型不指定精度和标度时，其默认为 DECIMAL(10, 0)。当数据的精度超出了定点数类型的精度范围时，则 MySQL 同样会进行四舍五入处理。</p>
</li>
<li><p>浮点数 vs 定点数</p>
<ul>
<li>浮点数相对于定点数的优点是在长度一定的情况下，浮点类型取值范围大，但是不精准，适用于需要取值范围大，又可以容忍微笑误差的科学计算场景 (比如计算化学、分子建模、流体动力学等)</li>
<li>定点数类型取值范围相对小，但是精准，没有误差，适合于对精度要求极高的场景 (比如涉及金额计算的场景)</li>
</ul>
</li>
</ul>
<h4 id="4-2-开发中经验"><a href="#4-2-开发中经验" class="headerlink" title="4.2 开发中经验"></a>4.2 开发中经验</h4><blockquote>
<p>“由于 DECIMAL 数据类型的精准性，在我们的项目中，除了极少数 (比如商品编号) 用到整数类型外，其他的数值都用的是 DECIMAL，原因就是这个项目所处的零售行业，要求精准，一分钱也不能差。“——来自某项目经理</p>
</blockquote>
<h3 id="5-位类型：BIT"><a href="#5-位类型：BIT" class="headerlink" title="5. 位类型：BIT"></a>5. 位类型：BIT</h3><p>BIT 类型中存储的是二进制值，类似 010101。</p>
<table>
<thead>
<tr>
<th align="center">二进制字符串类型</th>
<th align="center">长度</th>
<th align="center">长度范围</th>
<th align="center">占用空间</th>
</tr>
</thead>
<tbody><tr>
<td align="center">BIT(M)</td>
<td align="center">M</td>
<td align="center">1 ≤ M ≤ 64</td>
<td align="center">约为 (M + 7) &#x2F; 8 个字节</td>
</tr>
</tbody></table>
<p>BIT 类型，如果没有指定 (M)，默认是 1 位。这个 1 位，表示只能存 1 位二进制值。这里 (M) 是表示二进制的位数，位数最小值为 1，最大值为 64。</p>
<p>注意：在向 BIT 类型的字段中插入数据时，一定要确保插入的数据在 BIT 类型支持的范围内。</p>
<h3 id="6-日期和时间类型"><a href="#6-日期和时间类型" class="headerlink" title="6. 日期和时间类型"></a>6. 日期和时间类型</h3><p>日期与时间是重要的信息，在我们的系统中，几乎所有的数据表都用得到。原因是客户需要知道数据的时间标签，从而进行数据查询、统计和处理。</p>
<p>MySQL 有多种表示日期和时间的数据类型，不同的版本可能有所差异，MySQL 8.0 版本支持的日期和时间类型主要有：YEAR 类型、TIME 类型、DATE 类型、DATETIME 类型和 TIMESTAMP 类型。</p>
<ul>
<li>YEAR 类型通常用来表示年</li>
<li>DATE 类型通常用来表示年、月、日</li>
<li>TIME 类型通常用来表示时、分、秒</li>
<li>DATETIME 类型通常用来表示年、月、日、时、分、秒</li>
<li>TIMESTAMP 类型通常用来表示带时区的年、月、日、时、分、秒</li>
</ul>
<table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">名称</th>
<th align="center">字节</th>
<th align="center">日期格式</th>
<th align="center">最小值</th>
<th align="center">最大值</th>
</tr>
</thead>
<tbody><tr>
<td align="center">YEAR</td>
<td align="center">年</td>
<td align="center">1</td>
<td align="center">YYYY 或 YY</td>
<td align="center">1901</td>
<td align="center">2155</td>
</tr>
<tr>
<td align="center">TIME</td>
<td align="center">时间</td>
<td align="center">3</td>
<td align="center">HH:MM:SS</td>
<td align="center">-838:59:59</td>
<td align="center">838:59:59</td>
</tr>
<tr>
<td align="center">DATE</td>
<td align="center">日期</td>
<td align="center">3</td>
<td align="center">YYYY-MM-DD</td>
<td align="center">1000-01-01</td>
<td align="center">9999-12-03</td>
</tr>
<tr>
<td align="center">DATETIME</td>
<td align="center">日期时间</td>
<td align="center">8</td>
<td align="center">YYYY-MM-DD HH:MM:SS</td>
<td align="center">1000-01-01 00:00:00</td>
<td align="center">9999-12-31 23:59:59</td>
</tr>
<tr>
<td align="center">TIMESTAMP</td>
<td align="center">日期时间</td>
<td align="center">4</td>
<td align="center">YYYY-MM-DD HH:MM:SS</td>
<td align="center">1979-01-01 00:00:00 UTC</td>
<td align="center">2038-1-19 03:14:07 UTC</td>
</tr>
</tbody></table>
<p>可以看到，不同数据类型表示的时间内容不同、取值范围不同，而且占用的字节数也不一样，要根据实际需要灵活选取。</p>
<p>为什么时间类型 TIME 的取值范围不是 -23:59:59～23:59:59 呢？</p>
<p>因为 MySQL 设计的 TIME 类型，不光表示一天之类的时间，而且可以用来表示一个时间间隔，这个时间间隔可以超过 24 小时。</p>
<h4 id="6-1-YEAR-类型"><a href="#6-1-YEAR-类型" class="headerlink" title="6.1 YEAR 类型"></a>6.1 YEAR 类型</h4><p>YEAR 类型用来表示年份，在所有的日期时间类型中所占用的存储空间最小，只需要 1 个字节的存储空间。</p>
<p>在 MySQL 中，YEAR 有以下几种存储格式：</p>
<ul>
<li>以 4 位字符串或数字格式表示 YEAR 类型，其格式为 YYYY，最小值为 1901，最大值为 2155。</li>
<li>以 2 位字符串格式表示 YEAR 类型，最小值为 00，最大值为 99。<ul>
<li>当取值为 01 到 69 时，表示 2001 到 2069；</li>
<li>当取值为 70 到 99 时，表示 1970 到 1999；</li>
<li>当取值整数的 0 或 00 添加的话，那么是 0000 年；</li>
<li>当取值是日期&#x2F;字符串的 ‘0’ 添加的话，是 2000 年。</li>
</ul>
</li>
</ul>
<p>从 MySQL 5.5.27 开始，2 位格式的YEAR 已经不推荐使用。YEAR 默认格式就是 “YYYY”，没必要写成 YEAE(4)，从 MySQL 8.0.19 开始，不推荐使用指定显示宽度的 YEAR(4) 数据类型。</p>
<h4 id="6-2-DATE-类型"><a href="#6-2-DATE-类型" class="headerlink" title="6.2 DATE 类型"></a>6.2 DATE 类型</h4><p>DATE 类型表示日期，没有时间部分，格式为 <code>YYYY-MM-DD</code>，其中 YYYY 表示年份，MM 表示月份，DD 表示日期。</p>
<p>需要 3 个字节的存储空间。在向 DATE 类型的字段插入数据时，同样需要满足一定的格式条件。</p>
<ul>
<li>以 <code>YYYY-MM-DD</code> 格式或者 <code>YYYYMMDD</code> 格式表示的字符串日期，其最小取值为 1000-01-01，最大取值为 9999-12-03。<code>YYYYMMDD</code> 格式会被转化为 <code>YYYY-MM-DD</code> 格式。</li>
<li>以 <code>YY-MM-DD</code> 格式或者 <code>YYMMDD</code> 格式表示的字符串日期，此格式中，年份为两位数值或字符串满足 YEAR 类型的格式条件为：当年份取值为 00 到 69 时，会被转化为 2000 到 2069；当年份取值为 70 到 99 时，会被转化为 1970 到 1999。</li>
<li>使用 <code>CURRENT_DATE()</code> 或者 <code>NOW()</code> 函数，会插入当前系统的日期。</li>
</ul>
<h4 id="6-3-TIME-类型"><a href="#6-3-TIME-类型" class="headerlink" title="6.3 TIME 类型"></a>6.3 TIME 类型</h4><p>TIME 类型用来表示时间，不包含日期部分。在 MySQL 中，需要 3 个字节的存储空间来存储 TIME 类型的数据，可以使用 <code>HH:MM:SS</code> 格式来表示 TIME 类型，其中 HH 表示小时，MM 表示分钟，SS 表示秒。</p>
<p>在 MySQL 中，向 TIME 类型的字段插入数据时，也可以使用几种不同的格式。</p>
<ul>
<li><p>可以使用带有冒号的字符串</p>
<p>  比如 <code>&#39;D HH:MM:SS&#39;</code>、<code>&#39;HH:MM:SS&#39;</code>、<code>&#39;HH:MM&#39;</code>、<code>&#39;D HH:MM&#39;</code>、<code>&#39;D HH&#39;</code> 或 <code>&#39;SS&#39;</code> 格式，都能被正确得插入 TIME 类型的字段中。其中 D 表示天，其最小值为 0，最大值为 34。如果使用带有 D 格式的字符串插入 TIME 类型的字段时，D 会被转化为小时，计算格式为 <code>D * 24 + HH</code>。当使用带有冒号并且不带 D 的字符串表示时间时，表示当天的时间，比如 12:10 表示 12:10:00，而不是 00:12:10。</p>
</li>
<li><p>可以使用不带有冒号的字符串或者数字，格式为 <code>&#39;HHMMSS&#39;</code> 或 <code>HHMMSS</code>。</p>
<p>  如果插入一个不合法的字符串或者数字，MySQL 在存储数据时，会将其自动转化为 00:00:00 进行存储。比如 1210，MySQL 会将最右边的两位解析成秒，表示 00:12:10，而不是 12:10:00。</p>
</li>
<li><p>使用 <code>CURRENT_TIME()</code> 或者 <code>NOW()</code>，会插入当前系统的时间。</p>
</li>
</ul>
<h4 id="6-4-DATETIME-类型"><a href="#6-4-DATETIME-类型" class="headerlink" title="6.4 DATETIME 类型"></a>6.4 DATETIME 类型</h4><p>DATETIME 类型在所有的日期时间类型中占用的存储空间最大，总共需要 8 个字节的存储空间。在格式上为 DATE 类型和 TIME 类型的组合，可以表示为 <code>YYYY-MM-DD HH:MM:SS</code>，其中 YYYY 表示年份，MM 表示月份，DD 表示日期，HH 表示小时，MM 表示分钟，SS 表示秒。</p>
<p>在向 DATETIME 类型的字段插入数据时，同样需要满足一定的格式条件。</p>
<ul>
<li>以 <code>YYYY-MM_DD HH:MM:SS</code> 格式或者 <code>YYMMDDHHMMSS</code> 格式的字符串插入 DATETIME 类型的字段时，最小值为 1000-01-01 00:00:00，最大值为 9999-12-03 23:59:59。<ul>
<li>以 <code>YYMMDDHHMMSS</code> 格式的数字插入 DATETIME 类型的字段时，会被转化为 <code>YYYY-MM_DD HH:MM:SS</code> 格式。</li>
</ul>
</li>
<li>以 <code>YYYY-MM_DD HH:MM:SS</code> 格式 或者 <code>YYMMDDHHMMSS</code> 格式的字符串插入 DATETIME 类型的字段时，两位数的年份规则符合 YEAR 类型的规则，00 到 69 表示 2000 到 2069；70 到 99 表示 1970 到 1999。</li>
<li>使用函数 <code>CURRENT_TIMESTAMP()</code> 和 <code>NOW()</code>，可以向 DATETIME 类型的字段插入系统的当前日期和时间。</li>
</ul>
<h4 id="6-5-TIMESTAMP-类型"><a href="#6-5-TIMESTAMP-类型" class="headerlink" title="6.5 TIMESTAMP 类型"></a>6.5 TIMESTAMP 类型</h4><p>TIMESTAMP 类型也可以表示日期时间，其显示格式与 DATETIME 类型相同，都是 <code>YYYY-MM_DD HH:MM:SS</code>，需要 4 个字节的存储空间。但是 TIMESTAMP 存储的时间范围比 DATETIME 要小很多，只能存储 “1970-01-01 00:00:01 UTC” 到 “2033-01-19 03:14:07 UTC” 之间的时间。其中，UTC 表示时间统一时间，也叫作世界标准时间。</p>
<ul>
<li><strong>存储数据的时候需要对当前时间所在的时区进行转换，查询数据的时候再将时间转换回当前的时区。因此，使用 TIMESTAMP 存储的同一个时间值，在不同的时区查询时会显示不同的时间</strong>。</li>
</ul>
<p>向 TIMESTAMP 类型的字段插入数据时，当插入的数据格式满足 YY-MM-DD HH:MM:SS 和 YYMMDDHHMMSS 时，两位数值的年份同样符合 YEAR 类型的规则条件，只不过表示的时间范围要小很多。</p>
<p>如果想 TIMESTAMP 类型的字段插入的时间超出了 TIMESTAMP 类型的范围，则 MySQL 会抛出错误信息。</p>
<p><strong>TIMESTAMP 和 DATETIME 的区别</strong>：</p>
<ul>
<li>TIMESTAMP 存储空间比较小，表示的日期时间范围也比较小</li>
<li>底层存储方式不同，TIMESTAMP 底层存储的是毫秒值，距离 1970-01-01 00:00:00 毫秒的毫秒值</li>
<li>两个日期比较大小或日期计算时，TIMESTAMP 更方便、更快</li>
<li>TIMESTAMP 和时区有关。TIMESTAMP 会根据用户的时区不同，显示不同的结果。而 DATETIME 则只能反映出插入时当地的时区，其他时区的人查看数据必然会有误差的。</li>
</ul>
<h4 id="6-6-开发中经验"><a href="#6-6-开发中经验" class="headerlink" title="6.6 开发中经验"></a>6.6 开发中经验</h4><p>用的最多的日期时间类型，就是 DATETIME。虽然 MySQL 也支持 YEAR (年)、TIME (时间)、DATE (日期) 以及 TIMESTAMP 类型，但是在实际项目中，尽量用 DATETIME 类型。因为这个数据类型包括了完整的日期和时间信息，取值范围也最大，使用起来比较方便。毕竟，如果日期时间信息分散在好几个字段，很不容易记，而且查询的时候，SQL 语句也会更加复杂。</p>
<p>此外，一般存注册时间、商品发布时间等，不建议使用 DATETIME 存储，而是使用<strong>时间戳</strong>，因为 DATETIME 虽然直观，但不便于计算。</p>
<h3 id="7-文本字符串类型"><a href="#7-文本字符串类型" class="headerlink" title="7. 文本字符串类型"></a>7. 文本字符串类型</h3><p>在实际的项目中，我们还经常遇到一种数据，就是字符串数据。</p>
<p>MySQL 中国，文本字符串总体上分为 CHAR、VARCHAR、TINYTEXT、TEXT、MEDIUMTEXT、LONGTEXT、ENUM、SET 等类型。</p>
<table>
<thead>
<tr>
<th align="center">文本字符串类型</th>
<th align="center">值的长度</th>
<th align="center">长度范围</th>
<th align="center">占用的存储空间</th>
</tr>
</thead>
<tbody><tr>
<td align="center">CHAR(M)</td>
<td align="center">M</td>
<td align="center">0 ≤ M ≤ 255</td>
<td align="center">M个字节</td>
</tr>
<tr>
<td align="center">VARCHAR(M)</td>
<td align="center">M</td>
<td align="center">0 ≤ M ≤ 65535</td>
<td align="center">M + 1 个字节</td>
</tr>
<tr>
<td align="center">TINYTEXT</td>
<td align="center">L</td>
<td align="center">0 ≤ L ≤ 255</td>
<td align="center">L + 2 个字节</td>
</tr>
<tr>
<td align="center">TEXT</td>
<td align="center">L</td>
<td align="center">0 ≤ L ≤ 65535</td>
<td align="center">L + 2 个字节</td>
</tr>
<tr>
<td align="center">MEDIUMTEXT</td>
<td align="center">L</td>
<td align="center">0 ≤ L ≤ 16777215</td>
<td align="center">L + 3 个字节</td>
</tr>
<tr>
<td align="center">LONGTEXT</td>
<td align="center">L</td>
<td align="center">0 ≤ L ≤ 4294967295</td>
<td align="center">L + 4 个字节</td>
</tr>
<tr>
<td align="center">ENUM</td>
<td align="center">L</td>
<td align="center">1 ≤ L ≤ 65535</td>
<td align="center">1 或 2 个字节</td>
</tr>
<tr>
<td align="center">SET</td>
<td align="center">L</td>
<td align="center">0 ≤ L ≤ 64</td>
<td align="center">1，2，3，4 或 8 个字节</td>
</tr>
</tbody></table>
<h4 id="7-1-CHAR-与-VARCHAR-类型"><a href="#7-1-CHAR-与-VARCHAR-类型" class="headerlink" title="7.1 CHAR 与 VARCHAR 类型"></a>7.1 CHAR 与 VARCHAR 类型</h4><p>CHAR 和 VARCHAR 类型都可以存储比较短的字符串。</p>
<table>
<thead>
<tr>
<th align="center">字符串 (文本) 类型</th>
<th align="center">特点</th>
<th align="center">长度</th>
<th align="center">长度范围</th>
<th align="center">占用的存储空间</th>
</tr>
</thead>
<tbody><tr>
<td align="center">CHAR(M)</td>
<td align="center">固定长度</td>
<td align="center">M</td>
<td align="center">0 ≤ M ≤ 255</td>
<td align="center">M 个字节</td>
</tr>
<tr>
<td align="center">VARCHAR</td>
<td align="center">可变长度</td>
<td align="center">M</td>
<td align="center">0 ≤ M ≤ 65535</td>
<td align="center">(实际长度 + 1) 个字节</td>
</tr>
</tbody></table>
<p><strong>CHAR 类型</strong>：</p>
<ul>
<li>CHAR(M) 类型一般需要预先定义字符串长度。如果不指定 (M)，则表示长度默认是 1 个字符。</li>
<li>如果保存时，数据的实际长度比 CHAR 类型声明的长度小，则会在右侧填充空格以达到指定的长度。当 MySQL 检索 CHAR 类型的数据时，CHAR 类型的字段会去除尾部的空格。</li>
<li>定义 CHAR 类型字段时，声明的字段长度即为 CHAR 类型字段所占的存储空间的字节数。</li>
</ul>
<p><strong>VARCHAR 类型</strong>：</p>
<ul>
<li><p>VARCHAR(M) 定义时，必须指定长度 M，否则报错。</p>
</li>
<li><p>MySQL 4.0 版本以下，varchar(20): 指的是 20 字节，如果存放 UTF8 汉字时，只能存 6 个 (每个汉字 3 字节)；</p>
<p>  MySQL 5.0 版本以上，varchar(20): 指的是 20 字符。</p>
</li>
<li><p>检索 VARCHAR 类型的字段数据时，会保留数据尾部的空格。VARCHAR 类型的字段所占用的存储空间为字符串实际长度加 1 个字节。</p>
</li>
</ul>
<p><strong>哪些情况使用 CHAR 或 VARCHAR 更好</strong>？</p>
<table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">特点</th>
<th align="center">空间上</th>
<th align="center">时间上</th>
<th align="center">适用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="center">CHAR(M)</td>
<td align="center">固定长度</td>
<td align="center">浪费存储空间</td>
<td align="center">效率高</td>
<td align="center">存储不大，速度要求高</td>
</tr>
<tr>
<td align="center">VARCHAR(M)</td>
<td align="center">可变长度</td>
<td align="center">节省存储空间</td>
<td align="center">效率低</td>
<td align="center">非 CHAR 的情况</td>
</tr>
</tbody></table>
<ul>
<li><p>情况1：存储很短的信息。</p>
<p>  比如门牌号码 101，201……这样很短的信息应该用 char，因为 varchar 还要占个 byte 用于存储信息长度，本来打算节约存储的，结果得不偿失。</p>
</li>
<li><p>情况2：固定长度的。</p>
<p>  比如使用 uuid 作为主键，那用 char 应该更合适。因为他固定长度，varchar 动态改变长度的特性就消失了，而且还要占个长度信息。</p>
</li>
<li><p>情况3：十分频繁改变 column。</p>
<p>  因为 varchar 每次存储都要有额外的计算，得到长度等工作，如果一个非常频繁改变的，那就要有很多的精力用于计算，而这些对于 char 来说是不需要的。</p>
</li>
<li><p>情况4：具体存储引擎的情况：</p>
<ul>
<li><code>MyISAM</code> 数据存储引擎和数据列：MyISAM 数据表，最好使用固定长度 (CHAR) 的数据列代替可变长度 (VARCHAR) 的数据列。这样使得整个表静态化，从而使数据检索更快，用空间换时间。</li>
<li><code>MEMORY</code> 存储引擎和数据列：MEMORY 数据表目前都适用固定长度的数据行存储，因此无论使用 CHAR 或 VARCHAR 列都没有关系，两者都是作为 CHAR 类型处理的。</li>
<li><code>InnoDB</code> 存储引擎，建议使用 VARCHAR 类型。因为对于 InnoDB 数据表，内部的行存储格式并没有区分固定长度和可变长度列 (所有数据行都使用指向数据列值的头指针)，而且<strong>主要影响性的因素是数据行使用的存储总量</strong>，由于 char 平均占用的空间多余 varchar，所以除了简短并且固定长度的，其他考虑 varchar。这样节省空间，对磁盘 I&#x2F;O 和数据存储总量比较好。</li>
</ul>
</li>
</ul>
<h4 id="7-2-TEXT-类型"><a href="#7-2-TEXT-类型" class="headerlink" title="7.2 TEXT 类型"></a>7.2 TEXT 类型</h4><p>在 MySQL 中，TEXT 用来保存文本类型的字符串，总共包含 4 种类型，分别为 TINYTEXT、TEXT、MEDIUMTEXT 和 LONGTEXT 类型。</p>
<p>在向 TEXT 类型的字段保存和查询数据时，系统自动按照实际长度存储，不需要预先定义长度。这一点和 VARCHAR 类型相同。</p>
<p>每种 TEXT 类型保存的数据长度和所占用的存储空间不同，如下：</p>
<table>
<thead>
<tr>
<th align="center">文本字符串类型</th>
<th align="center">特点</th>
<th align="center">长度</th>
<th align="center">长度范围</th>
<th align="center">占用的存储空间</th>
</tr>
</thead>
<tbody><tr>
<td align="center">TINYTEXT</td>
<td align="center">小文本、可变长度</td>
<td align="center">L</td>
<td align="center">0</td>
<td align="center">L + 2 个字节</td>
</tr>
<tr>
<td align="center">TEXT</td>
<td align="center">文本、可变长度</td>
<td align="center">L</td>
<td align="center">0 ≤ L ≤ 255</td>
<td align="center">L + 2 个字节</td>
</tr>
<tr>
<td align="center">MEDIUMTEXT</td>
<td align="center">中等文本、可变长度</td>
<td align="center">L</td>
<td align="center">0 ≤ L ≤ 65535</td>
<td align="center">L + 3 个字节</td>
</tr>
<tr>
<td align="center">LONGTEXT</td>
<td align="center">大文本、可变长度</td>
<td align="center">L</td>
<td align="center">0 ≤ L ≤ 4294967295 (相当于 4 GB)</td>
<td align="center">L + 4 个字节</td>
</tr>
</tbody></table>
<p><strong>由于实际存储的长度不确定，MySQL 不允许 TEXT 类型的字段做主键</strong>。遇到这种情况，只能采用 CHAR(M) 或 VARCHAR(M)。</p>
<p><strong>开发中经验</strong>：</p>
<p>TEXT 文本类型，可以存比较大的文本段，搜索速度稍慢，因此如果不是特别大的内容，建议使用 CHAR、VARCHAR 来替代。还有 TEXT 类型不用加默认值，加了也没用。而且 text 和 blob 类型的数据删除后容易导致“空洞”，使得文件碎片比较多，所以频繁使用的表不建议包含 TEXT 字段，建议单独分出去，单独用一个表。</p>
<h3 id="8-ENUM-类型"><a href="#8-ENUM-类型" class="headerlink" title="8. ENUM 类型"></a>8. ENUM 类型</h3><p>ENUM 类型也叫作枚举类型，ENUM 类型的取值范围需要定义字段时进行指定。设置字段值时，ENUM 类型只允许从成员中选取单个值，不能一次选取多个值。</p>
<p>其所需要的存储空间由定义 ENUM 类型时指定的成员个数决定。</p>
<table>
<thead>
<tr>
<th align="center">文本字符串类型</th>
<th align="center">长度</th>
<th align="center">长度范围</th>
<th align="center">占用的存储空间</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ENUM</td>
<td align="center">L</td>
<td align="center">1 ≤ L ≤ 65535</td>
<td align="center">1 或 2 个字节</td>
</tr>
</tbody></table>
<ul>
<li>当 ENUM 类型包含 1～255 个成员时，需要 1 个字节的存储空间。</li>
<li>当 ENUM 类型包含 256～65535 个成员时，需要 2 个字节的存储空间。</li>
<li>ENUM 类型的成员个数的上限为 65535 个。</li>
</ul>
<p>举例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test_enum(</span><br><span class="line">season ENUM(<span class="string">&#x27;春&#x27;</span>,<span class="string">&#x27;夏&#x27;</span>,<span class="string">&#x27;秋&#x27;</span>,<span class="string">&#x27;冬&#x27;</span>,<span class="string">&#x27;unknow&#x27;</span>)</span><br><span class="line">)；</span><br></pre></td></tr></table></figure>

<h3 id="9-SET-类型"><a href="#9-SET-类型" class="headerlink" title="9. SET 类型"></a>9. SET 类型</h3><p>SET 表示一个字符串对象，可以包含 0 个或多个成员，但成员个数的上限为 64。设置字段值时，可以取取值范围内的 0 个或多个值。</p>
<p>当 SET 类型包含的成员个数不同时，其所占用的存储空间也是不同的，具体如下：</p>
<table>
<thead>
<tr>
<th>成员个数范围 (L 表示实际成员个数)</th>
<th>占用的存储空间</th>
</tr>
</thead>
<tbody><tr>
<td>1 ≤ L ≤ 8</td>
<td>1 个字节</td>
</tr>
<tr>
<td>9 ≤ L ≤ 16</td>
<td>2 个字节</td>
</tr>
<tr>
<td>17 ≤ L ≤ 24</td>
<td>3 个字节</td>
</tr>
<tr>
<td>25 ≤ L ≤ 32</td>
<td>4 个字节</td>
</tr>
<tr>
<td>33 ≤ L ≤ 64</td>
<td>8 个字节</td>
</tr>
</tbody></table>
<p>SET 类型在存储数据时成员个数越多，其占用的存储空间越大。注意：SET 类型在选取成员时，可以一次选择多个成员，这一点与 ENUM 类型不同。</p>
<p>举例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test_set(</span><br><span class="line">s <span class="keyword">SET</span> (<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;B&#x27;</span>,<span class="string">&#x27;C&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="10-二进制字符串类型"><a href="#10-二进制字符串类型" class="headerlink" title="10. 二进制字符串类型"></a>10. 二进制字符串类型</h3><p>MySQL 中的二进制字符串类型主要存储一些二进制数据，比如可以存储图片、音频和视频等二进制数据。</p>
<p>MySQL 中支持的二进制字符串类型主要包括 BINARY、VARBINARY、TINYBLOB、BLOB、MEDIUMBLOB 和 LONGBLOB 类型。</p>
<p><strong>BINARY 与 VARBINBAY 类型</strong></p>
<p>BINARY 和 VARBINARY 类似于 CHAR 和 VARCHAR，只是它们存储的是二进制字符串。</p>
<p>BINARY(M) 为固定长度的二进制字符串，M 表示最多能存储的字节数，取值范围是 0～255 个字符。如果位置定 (M)，表示只能存储 1 个字节。例如 BINATY(8)，表示最多能存储 8 个字节，如果字段值不足 (M) 个字节，将在右边填充’\0’ 以补齐指定长度。</p>
<p>VARBINARY(M) 为可变长度的二进制字符串，M 表示最多能存储的字节数，总字节数不能超过行的字节长度限制 65535，另外还要考虑额外字节开销，VARBINARY 类型的数据除了存储数据本身外，还需要 1 或 2 个字节来存储数据的字节数。VARBINARY 类型必须指定 (M)，否则报错。</p>
<table>
<thead>
<tr>
<th align="center">二进制字符串类型</th>
<th align="center">特点</th>
<th align="center">值的长度</th>
<th align="center">占用空间</th>
</tr>
</thead>
<tbody><tr>
<td align="center">BINARY(M)</td>
<td align="center">固定长度</td>
<td align="center">M (0 ≤ M ≤ 255)</td>
<td align="center">M 个字节</td>
</tr>
<tr>
<td align="center">VARBINARY(M)</td>
<td align="center">可变长度</td>
<td align="center">M (0 ≤ M ≤ 65535)</td>
<td align="center">M + 1 个字节</td>
</tr>
</tbody></table>
<p><strong>BLOB 类型</strong></p>
<p>BLOB 是一个二进制大对象，可以容纳可变数量的数据。</p>
<p>MySQL中的 BLOB 类型包括 TINYBLOB、BLOB、MEDIUMBLOB 和 LONGBLOB 4 种类型，它们可容纳值的最大长度不同。可以存储一个二进制的大对象，比如图片、音频和视频等。</p>
<p>需要注意的是，在实际工作中，往往不会在 MySQL 数据库中使用 BLOB 类型存储大对象数据，通常会将图片、音频和视频文件存储到服务器磁盘上，并将图片、音频和视频的访问路径存储到 MySQL 中。</p>
<table>
<thead>
<tr>
<th align="center">二进制字符串类型</th>
<th align="center">值的长度</th>
<th align="center">长度范围</th>
<th align="center">占用空间</th>
</tr>
</thead>
<tbody><tr>
<td align="center">TINYBLOB</td>
<td align="center">L</td>
<td align="center">0 ≤ L ≤ 255</td>
<td align="center">L + 1 个字节</td>
</tr>
<tr>
<td align="center">BLOB</td>
<td align="center">L</td>
<td align="center">0 ≤ L ≤ 65535 (相当于 64 KB)</td>
<td align="center">L + 2 个字节</td>
</tr>
<tr>
<td align="center">MEDIUMBLOB</td>
<td align="center">L</td>
<td align="center">0 ≤ L ≤ 16777215 (相当于 16 MB)</td>
<td align="center">L + 3 个字节</td>
</tr>
<tr>
<td align="center">LONGBLOB</td>
<td align="center">L</td>
<td align="center">0 ≤ L ≤ 4294967295 (相当于 4 GB)</td>
<td align="center">L + 4 个字节</td>
</tr>
</tbody></table>
<p><strong>TEXT 和 BLOB 的使用注意事项</strong>：</p>
<p>在使用 text 和 blob 字段类型时要注意以下几点，以便更好的发挥数据库的性能。</p>
<ul>
<li>BLOB 和 TEXT 值也会引起自己的一些问题，特别是执行了大量的删除或更新操作的时候。删除这种值会在数据表中留下很大的“<strong>空洞</strong>”，以后填入这些“空洞”的记录可能长度不同。为了提高性能，建议定期使用 <code>OPTIMIZE TABLE</code> 功能对这类表进行碎片整理。</li>
<li>如果需要对大文本字段进行模糊查询，MySQL 提供了<strong>前缀索引</strong>。但是仍然要在不必要的时候避免检索大型的 BLOB 或 TEXT 值。例如 SELECT * 查询就不是很好的想法，除非你能确定作为约束条件的 WHERE 子句只会找到所需要的数据行。否则，你可能毫无目的地在网络上传输大量的值。</li>
<li>把 BLOB 或 TEXT 列<strong>分离到单独的表</strong>中。在某些环境下，如果把这些数据列移动到第二章数据表中，可以让你把原数据表中的数据列转换为固定长度的数据行格式，那么它就是有意义的。这会<strong>减少主表中的碎片</strong>，使你得到固定长度数据行的性能优势。它还使你在主数据表上运行 SELECT * 查询的时候不会通过网络传输大量的 BLOB 或 TEXT 值。</li>
</ul>
<h3 id="11-JSON-类型"><a href="#11-JSON-类型" class="headerlink" title="11. JSON 类型"></a>11. JSON 类型</h3><p>JSON (JavaScript Object Notation) 是一种轻量级的<strong>数据交换格式</strong>。简介和清晰的层次结构使得 JSON 称为理想的数据交换语言。它易于人阅读和编写，同时也易于机器解析和生成，并有效地提升网络传输效率。<strong>JSON 可以将 JavaScript 对象中表示的一组数据转换为字符串，然后就可以在网络或者程序之间轻松地传递这个字符串，并在需要的时候将它还原为各编程语言所支持的数据格式</strong>。</p>
<p>在 MySQL 5.7 中，就已经支持 JSON 数据类型。在 MySQL 8.x 版本中，JSON 类型提供了可以进行自动验证的 JSON 文档和优化的存储结构，使得在 MySQL 中存储和读取 JSON 类型的数据更加方便的高效。</p>
<p>举例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 创建包含一个 JSON 类型的字段js 的表</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test_json(</span><br><span class="line">js json</span><br><span class="line">);</span><br><span class="line"># 向表中插入 JSON 数据</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test_json (js)</span><br><span class="line"><span class="keyword">VALUEs</span>(<span class="string">&#x27;&#123;&quot;name&quot;:&quot;tom&quot;, &quot;age&quot;:18, &quot;address&quot;:&#123;&quot;province&quot;:&quot;chongqing&quot;, &quot;city&quot;:&quot;fengdu&quot;&#125;&#125;&#x27;</span>);</span><br><span class="line"># 检索 JSON 类型的字段中数据的某个具体值时，可以使用 &quot;-&gt;&quot; 和 &quot;-&gt;&gt;&quot; 符号。</span><br><span class="line"><span class="keyword">SELECT</span> js <span class="operator">-</span><span class="operator">&gt;</span> <span class="string">&#x27;$.name&#x27;</span> <span class="keyword">AS</span> name, js <span class="operator">-</span><span class="operator">&gt;</span> <span class="string">&#x27;$.age&#x27;</span> <span class="keyword">AS</span> age, js <span class="operator">-</span><span class="operator">&gt;</span> <span class="string">&#x27;$.address.province&#x27;</span> <span class="keyword">AS</span> province, js <span class="operator">-</span><span class="operator">&gt;</span> <span class="string">&#x27;$.address.city&#x27;</span> <span class="keyword">AS</span> city <span class="keyword">FROM</span> test_json;</span><br></pre></td></tr></table></figure>

<h3 id="12-空间类型"><a href="#12-空间类型" class="headerlink" title="12. 空间类型"></a>12. 空间类型</h3><p>MySQL 空间类型扩展支持地理特征的生成、存储和分析。这里的地理特征表示世界上具有位置的任何东西，可以是一个实体，例如一座山；可以是空间，例如一座办公楼；也可以是一个可定义的位置，例如一个十字路口等。MySQL 中使用 <code>Geometry (几何)</code> 来表示所有地理特征。Geometry 指一个点或点的集合，代表世界上任何具有未知的事物。</p>
<p>MySQL 的空间数据类型 (Spatial Data Type) 对应于 OpenGIS 类，包括单值类型：GEOMETRY、POINT、LINESTRING、POLYGON 以及集合类型：MULTIPOINT、MULTILINESTRING、NULTIPOLYGON、GEOMETRYCOLLECTION。</p>
<ul>
<li>Geometry 是所有空间集合类型的基类，其他类型如 POINT、LINESTRING、POLYGON 都是 Geometry 的子类。<ul>
<li>Point，顾名思义就是点，又一个坐标值。例如 POINT(121.213342 31.234532)，POINT(30 10)，坐标值支持 DECIMAL 类型，经度 (longitude) 在前，纬度 (latitude) 在后，用空格分隔。</li>
<li>LineString，线，由一系列点连接而成。如果线从头至尾没有交叉，那就是简单的 (simple)；如果起点和终点重叠，那就是封闭的 （closed)。例如LINESTRING(30 10, 10 30, 40 40)，点与点之间用逗号分隔，一个点中的经纬度用空格分隔，与 POINT 格式一致。</li>
<li>Polygon，多边形。可以是一个实心平面形，即没有内部边界，也可以有空洞，类似纽扣。最简单的就是只有一个外边界的情况，例如 POLYGON((0 0,10 0, 10 10, 0 10)。</li>
</ul>
</li>
</ul>
<h3 id="13-小结及选择建议"><a href="#13-小结及选择建议" class="headerlink" title="13. 小结及选择建议"></a>13. 小结及选择建议</h3><p>在定义数据类型时，如果确定是整数，就用 INT；如果是小数，一定用定点数类型 DECIMAL(M, D)；如果是日期与时间，就用 DATETIME。</p>
<p>这样做的好处是，首先确保你的系统不会因为数据类型定义出错。不过，凡事都是有两面的，可靠性好，并不意味着高效。比如，TEXT 虽然使用方便，但是效率不如 CHAR(M) 和 VARCHAR(M)。</p>
<p>关于字符串的选择，建议参考如下阿里巴巴的 《Java 开发手册》规范：</p>
<p><strong>阿里巴巴《Java 开发手册》之 MySQL 数据库</strong>：</p>
<ul>
<li>任何字段如果为非负数，必须是 unsigned。</li>
<li>【强制】小数类型为 decimal，禁止使用 float 和 double。<ul>
<li>说明： float 和 double 在存储的时候，存在精度损失的问题，很可能在值的比较时，得到不正确的结果。如果存储的数据范围超过 decimal 的范围，建议将数据拆成整数和小数分开存储。</li>
</ul>
</li>
<li>【强制】如果存储的字符串长度几乎相等，使用 char 定长字符串类型。</li>
<li>【强制】 varchar 是可变长字符串，不预先分配存储空间，长度不要超过 5000，如果存储长度大于此值，定义字段类型为 text，独立出来一张表，用主键来对应，避免影响其它字段索引效率。</li>
</ul>
<h2 id="十二、约束"><a href="#十二、约束" class="headerlink" title="十二、约束"></a>十二、约束</h2><h3 id="1-约束-constraint-概述"><a href="#1-约束-constraint-概述" class="headerlink" title="1. 约束 (constraint) 概述"></a>1. 约束 (constraint) 概述</h3><h4 id="1-1-为什么需要约束"><a href="#1-1-为什么需要约束" class="headerlink" title="1.1 为什么需要约束"></a>1.1 为什么需要约束</h4><p>数据完整性 (Data Integrity) 是指数据的精确性 (Accuracy) 和可靠性 (Reliability)。它是防止数据库中存在不符合语义规定的数据和防止因错误信息的输入输出造成无效操作或错误信息而提出的。</p>
<p>为了保证数据的完整性，SQL 规范以约束的方式对表数据进行额外的条件限制。从以下四个方面考虑：</p>
<ul>
<li>实体完整性 (Entity Integrity)：例如，同一个表中，不能存在两条完全相同无法区分的记录。</li>
<li>域完整性 (Domain Integrity)：例如：年龄范围 0～120，性别范围”男&#x2F;女”。</li>
<li>引用完整性 (Referential Integrity)：例如：员工所在部门，在部门表中要能找到这个部门</li>
<li>用户自定义完整性 (User-defined Integrity)：例如：用户名唯一、密码不能为空，本部门经理的工资不能高于本部门职工的平均工资的 5 倍。</li>
</ul>
<h4 id="1-2-什么是约束"><a href="#1-2-什么是约束" class="headerlink" title="1.2 什么是约束"></a>1.2 什么是约束</h4><p>约束是表级的强制规定。可以在创建表时规定约束 (通过 CREATE TABLE 语句)，或者在表创建之后通过 ALTER TABLE 语句规定约束。</p>
<h4 id="1-3-约束的分类"><a href="#1-3-约束的分类" class="headerlink" title="1.3 约束的分类"></a>1.3 约束的分类</h4><ul>
<li>根据约束数据列的限制，约束可分为：<ul>
<li>单列约束：每个约束只约束一列</li>
<li>多列约束：每个约束可约束多列数据</li>
</ul>
</li>
<li>根据约束的作用范围，约束可分为：<ul>
<li>列级约束：只能作用在一个列上，跟在列的定义后面</li>
<li>表级约束：可以作用在多个列上，不与列一起，而是单独定义</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th>位置</th>
<th>支持的约束类型</th>
<th>是否可以起约束名</th>
</tr>
</thead>
<tbody><tr>
<td>列级约束</td>
<td>列的后面</td>
<td>语法都支持，但外键没有效果</td>
<td>不可以</td>
</tr>
<tr>
<td>表级约束</td>
<td>所有列的下面</td>
<td>默认和非空不支持，其他支持</td>
<td>可以 (主键没有效果)</td>
</tr>
</tbody></table>
<ul>
<li>根据约束起的作用，约束可分为：<ul>
<li>NOT NULL 非空约束，规定某个字段不能为空</li>
<li>UNIQUE 唯一约束，规定某个字段在整个表中是唯一的</li>
<li>PRIMARY KEY 主键 (非空且唯一) 约束</li>
<li>FOREIGN KEY 外键约束</li>
<li>CHECK 检查约束</li>
<li>DEFAULT 默认值约束</li>
</ul>
</li>
</ul>
<blockquote>
<p>注意：MySQL 不支持 check 约束，但是可以使用 check 约束，而没有任何效果</p>
</blockquote>
<ul>
<li><p>查看某个表已有的约束</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># information_schema 数据库名 (系统库)</span><br><span class="line"># table_constraints 标名称 (专门存储各个表的约束)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.table_constraints</span><br><span class="line"><span class="keyword">WHERE</span> table_name <span class="operator">=</span> <span class="string">&#x27;标名称&#x27;</span>;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-非空约束"><a href="#2-非空约束" class="headerlink" title="2.非空约束"></a>2.非空约束</h3><h4 id="2-1-作用"><a href="#2-1-作用" class="headerlink" title="2.1 作用"></a>2.1 作用</h4><p>限定某个字段&#x2F;某列的值不允许为空</p>
<h4 id="2-2-关键字"><a href="#2-2-关键字" class="headerlink" title="2.2 关键字"></a>2.2 关键字</h4><p>NOT NULL</p>
<h4 id="2-3-特点"><a href="#2-3-特点" class="headerlink" title="2.3 特点"></a>2.3 特点</h4><ul>
<li>默认，所有的类型的值都可以是 NULL，包括 INT、FLOAT 等数据类型</li>
<li>非空约束只能出现在表对象的列上，只能某个列单独限定非空，不能组合非空</li>
<li>一个表可以有很多列都分别限定了非空</li>
<li>空字符串”不等于 NULL”，0 也不等于 NULL</li>
</ul>
<h4 id="2-4-添加非空约束"><a href="#2-4-添加非空约束" class="headerlink" title="2.4 添加非空约束"></a>2.4 添加非空约束</h4><ul>
<li><p>建表时</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span>  表名称(</span><br><span class="line">	column1 数据类型,</span><br><span class="line">  column2 数据类型 <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  column3 数据类型 <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>建表后</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名称</span><br><span class="line">MODIFY <span class="keyword">column</span> 数据类型 <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-5-删除非空约束"><a href="#2-5-删除非空约束" class="headerlink" title="2.5 删除非空约束"></a>2.5 删除非空约束</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名称 MODIFY <span class="keyword">column</span> 数据类型 <span class="keyword">NULL</span>;</span><br><span class="line">或</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名称 MODIFY <span class="keyword">column</span> 数据类型;</span><br></pre></td></tr></table></figure>

<h3 id="3-唯一性约束"><a href="#3-唯一性约束" class="headerlink" title="3. 唯一性约束"></a>3. 唯一性约束</h3><h4 id="3-1-作用"><a href="#3-1-作用" class="headerlink" title="3.1 作用"></a>3.1 作用</h4><p>用来限制某个字段&#x2F;某列的值不能重复。</p>
<h4 id="3-2-关键字"><a href="#3-2-关键字" class="headerlink" title="3.2 关键字"></a>3.2 关键字</h4><p>UNIQUE</p>
<h4 id="3-3-特点"><a href="#3-3-特点" class="headerlink" title="3.3 特点"></a>3.3 特点</h4><ul>
<li>同一个表可以有多个唯一约束。</li>
<li>唯一约束可以是某一列的值唯一，也可以多个列组合的值唯一。</li>
<li>唯一性约束允许列值为空。</li>
<li>在创建唯一约束的时候，如果不给唯一约束命名，就默认和列名相同。</li>
<li>MySQL 会给唯一约束的列上默认创建一个唯一索引。</li>
</ul>
<h4 id="3-4-添加唯一约束"><a href="#3-4-添加唯一约束" class="headerlink" title="3.4 添加唯一约束"></a>3.4 添加唯一约束</h4><ul>
<li><p>建表时</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 列级约束</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表名称(</span><br><span class="line">	column1 数据类型,</span><br><span class="line">  column2 数据类型 <span class="keyword">UNIQUE</span>,</span><br><span class="line">  column3 数据类型 <span class="keyword">UNIQUE</span> KEY,</span><br><span class="line">);</span><br><span class="line"># 表级约束</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表名称(</span><br><span class="line">	column1 数据类型,</span><br><span class="line">  column2 数据类型 <span class="keyword">UNIQUE</span>,</span><br><span class="line">	<span class="keyword">CONSTRAINT</span> 约束名 <span class="keyword">UNIQUE</span> 字段名</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>建表后</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 字段列表中如果是一个字段，表示该列的值唯一，如果是两个或更多个字段，那么复合唯一，即多个字段的组合是唯一的</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名称 <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> KEY(字段列表);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名称 MODIFY 字段名 数据类型 <span class="keyword">UNIQUE</span>;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="3-5-关于复合唯一约束"><a href="#3-5-关于复合唯一约束" class="headerlink" title="3.5 关于复合唯一约束"></a>3.5 关于复合唯一约束</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表名称(</span><br><span class="line">	column1 数据类型,</span><br><span class="line">  column2 数据类型,</span><br><span class="line">  column3 数据类型,</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY(字段列表)# 字段列表中写的是多个字段名，用逗号分隔，表示多个字段的组合是唯一的。</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="3-6-删除唯一约束"><a href="#3-6-删除唯一约束" class="headerlink" title="3.6 删除唯一约束"></a>3.6 删除唯一约束</h4><ul>
<li>添加唯一性约束的列上也会自动创建唯一索引。</li>
<li>删除唯一约束只能通过删除唯一索引的方式删除。</li>
<li>删除时需要制定唯一索引名，唯一索引名就和唯一约束名一样。</li>
<li>如果创建唯一约束时未指定名称，如果是单列，就默认和列名相同；如果是组合列，那么默认和 () 中排在第一个的列名相同。也可以自定义唯一性约束名。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.table_constraints <span class="keyword">WHERE</span> table_name <span class="operator">=</span> <span class="string">&#x27;表名&#x27;</span>; # 查看都有哪些约束</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名</span><br><span class="line"><span class="keyword">DROP</span> INDEX 唯一索引名;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：可以通过 <code>show index from 表名称;</code> 查看表的索引</p>
</blockquote>
<h3 id="4-主键约束"><a href="#4-主键约束" class="headerlink" title="4. 主键约束"></a>4. 主键约束</h3><h4 id="4-1-作用"><a href="#4-1-作用" class="headerlink" title="4.1 作用"></a>4.1 作用</h4><p>用来唯一标识表中的一行记录。</p>
<h4 id="4-2-关键字"><a href="#4-2-关键字" class="headerlink" title="4.2 关键字"></a>4.2 关键字</h4><p>PRIMARY KEY</p>
<h4 id="4-3-特点"><a href="#4-3-特点" class="headerlink" title="4.3 特点"></a>4.3 特点</h4><ul>
<li>主键约束相当于唯一约束 + 非空约束的组合，主键约束列不允许重复，也不允许出现空值。</li>
<li>一个表最多只能有一个主键约束，建立主键约束可以在列级别创建，也可以在表级别上创建。</li>
<li>主键约束对应着表中的一列或者多列 (复合主键)。</li>
<li>如果是多列组合的符合主键约束，那么这些列都不允许为空值，并且组合的值不允许重复。</li>
<li>MySQL 的主键名总是 PRIMARY，就算自己命名了主键约束名也没用。</li>
<li>当创建主键约束时，系统默认会在所在的列或列组合上建立对应的主键索引 (能够根据主键查询的，就根据主键查询，效率跟高)。如果删除主键约束了，主键约束对应的索引就自动删除了。</li>
<li>需要注意的一点是，不要修改主键字段的值。因为主键是数据记录的唯一标识，如果修改了主键的值，就有可能会破坏数据的完整性。</li>
</ul>
<h4 id="4-4-添加主键约束"><a href="#4-4-添加主键约束" class="headerlink" title="4.4 添加主键约束"></a>4.4 添加主键约束</h4><ul>
<li>建表时：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 列级约束</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表名称(</span><br><span class="line">	column1 数据类型 <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">  column2 数据类型 <span class="keyword">UNIQUE</span>,</span><br><span class="line">  column3 数据类型 <span class="keyword">UNIQUE</span> KEY,</span><br><span class="line">);</span><br><span class="line"># 表级约束 复合主键</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表名称(</span><br><span class="line">	column1 数据类型,</span><br><span class="line">  column2 数据类型 <span class="keyword">UNIQUE</span>,</span><br><span class="line">  column3 数据类型 <span class="keyword">UNIQUE</span> KEY,</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> 约束名 <span class="keyword">PRIMARY</span> KEY(column1, column2)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li>建表后：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">PRIMARY</span> KEY (字段名);</span><br></pre></td></tr></table></figure>

<h4 id="4-5-删除主键约束"><a href="#4-5-删除主键约束" class="headerlink" title="4.5 删除主键约束"></a>4.5 删除主键约束</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PRIMARY</span> KEY;</span><br></pre></td></tr></table></figure>

<h3 id="5-自增列"><a href="#5-自增列" class="headerlink" title="5. 自增列"></a>5. 自增列</h3><h4 id="5-1-作用"><a href="#5-1-作用" class="headerlink" title="5.1 作用"></a>5.1 作用</h4><p>某个字段的值自增</p>
<h4 id="5-2-关键字"><a href="#5-2-关键字" class="headerlink" title="5.2 关键字"></a>5.2 关键字</h4><p>AUTO_INCREMENT</p>
<h4 id="5-3-特点和要求"><a href="#5-3-特点和要求" class="headerlink" title="5.3 特点和要求"></a>5.3 特点和要求</h4><ul>
<li>一个表最多只能有一个自增长列</li>
<li>当需要产生唯一标识符或顺序值时，可设置自增长</li>
<li>自增长列约束的列必须是键列 (主键列，唯一键列)</li>
<li>自增约束的列的数据类型必须是整数类型</li>
<li>如果自增列指定了 0 和 NULL，会在当前最大值的基础上自增；如果自增列手动置顶了具体值，直接赋值为具体值。</li>
</ul>
<h4 id="5-4-指定自增约束"><a href="#5-4-指定自增约束" class="headerlink" title="5.4 指定自增约束"></a>5.4 指定自增约束</h4><ul>
<li>建表时：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 标名称(</span><br><span class="line">	column1 数据类型 <span class="keyword">PRIMARY</span> KEY ATUO_INCREMENT,</span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 标名称(</span><br><span class="line">	column1 数据类型 <span class="keyword">UNIQUE</span> KEY ATUO_INCREMENT,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li>建表后：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 </span><br><span class="line">MODIFY <span class="keyword">column</span> 数据类型 ATUO_INCREMENT;</span><br></pre></td></tr></table></figure>

<h4 id="5-5-删除自增约束"><a href="#5-5-删除自增约束" class="headerlink" title="5.5 删除自增约束"></a>5.5 删除自增约束</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 </span><br><span class="line">MODIFY <span class="keyword">column</span> 数据类型; # 去掉 ATUO_INCREMENT</span><br></pre></td></tr></table></figure>

<h4 id="5-6-MySQL-8-0-新特性——自增变量的持久化"><a href="#5-6-MySQL-8-0-新特性——自增变量的持久化" class="headerlink" title="5.6 MySQL 8.0 新特性——自增变量的持久化"></a>5.6 MySQL 8.0 新特性——自增变量的持久化</h4><p>在 MySQL 8.0 之前，自增主键 ATUO_INCREMENT 的值如果大于 max(primary key) + 1，在 MySQL 重启后，会重置 ATUO_INCREMENT &#x3D; max(primary key) + 1，这种现象在某些情况下会导致业务主键冲突或者其他难以发现的问题。在 MySQL 5.7 系统中，对于自增主键的分配规则，是由 InnoDB 数据字典内部一个计数器来决定的，而该计数器只在内存中维护，并不会持久化道磁盘中。当数据库重启时，该计数器会被初始化。在 MySQL 8.0 系统中将自增主键的计数器持久化道重做日志中。每次计数器发生改变，都会将其写入重做日志中。如果数据库重启，InnoDB 会根据重做日志中的信息来初始化计数器的内存值。</p>
<h3 id="6-外键约束"><a href="#6-外键约束" class="headerlink" title="6. 外键约束"></a>6. 外键约束</h3><h4 id="6-1-作用"><a href="#6-1-作用" class="headerlink" title="6.1 作用"></a>6.1 作用</h4><p>限定某个表的某个字段的引用完整性。</p>
<p>比如：员工表的员工所在部门的选择，必须在部门表能找到对应的部分。</p>
<h4 id="6-2-关键字"><a href="#6-2-关键字" class="headerlink" title="6.2 关键字"></a>6.2 关键字</h4><p>FOREIGN KEY</p>
<h4 id="6-3-主表和从表-x2F-父表和子表"><a href="#6-3-主表和从表-x2F-父表和子表" class="headerlink" title="6.3 主表和从表&#x2F;父表和子表"></a>6.3 主表和从表&#x2F;父表和子表</h4><p>主表 (父表)：被引用的表，被参考的表。</p>
<p>从表 (子表)：引用别人的表，参考别人的表。</p>
<h4 id="6-4-特点"><a href="#6-4-特点" class="headerlink" title="6.4 特点"></a>6.4 特点</h4><ul>
<li><p>从表的外键列，必须引用&#x2F;参考主表的键 (主键或唯一约束的列)</p>
<p>  为什么？因为被依赖&#x2F;被参考的值必须是唯一的。</p>
</li>
<li><p>在创建外键约束时，如果不给外键约束命名，默认名不是列名，而是自动产生一个外键名，也可以指定外键约束名。</p>
</li>
<li><p>创建 (CRETE) 表时就指定外键约束的话，先创建主表，再创建从表。</p>
</li>
<li><p>删表时，先删从表 (或先删外键约束)，在删除主表。</p>
</li>
<li><p>当主表的记录被从表参照时，主要的记录将不允许删除，如果要删除数据，需要先删除从表中依赖该记录的数据，然后才可以删除主表的数据。</p>
</li>
<li><p>在 “从表”中指定外键约束，并且一个表可以建立多个外键约束。</p>
</li>
<li><p>从表的外键列与主表被参照的列名可以不相同，但是数据类型必须一样，逻辑意义一致。如果类型不一样，创建子表时，就会出现“ERROR 1005 (HY000): Can’t crete table’database.tablename’(errno:150”。</p>
</li>
<li><p>当创建外键约束时，系统默认会在所在的列上建立对应的普通索引。但是索引名是列名，不是外键的约束名。(根据外键查询效率很高)</p>
</li>
<li><p>删除外键约束后，必须手动删除对应的索引。</p>
</li>
</ul>
<h4 id="6-5-添加外键约束"><a href="#6-5-添加外键约束" class="headerlink" title="6.5 添加外键约束"></a>6.5 添加外键约束</h4><ul>
<li><p>建表时</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 主表名称(</span><br><span class="line">	column1 数据类型 <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">  column2 数据类型</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 从表名称(</span><br><span class="line">	column1 数据类型 <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">  column2 数据类型 ，</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> 外键约束名称 <span class="keyword">FOREIGN</span> KEY (从表字段) <span class="keyword">REFERENCES</span> 主表名(主表字段)</span><br><span class="line">);</span><br><span class="line"># 从表的某个字段的数据类型必须与主表字段的数据类型一致，逻辑意义也一样</span><br><span class="line"># 从表的某个字段的字段名可以与主表字段名一样，也可以不一样</span><br><span class="line"><span class="comment">-- FOREIGN KEY：在表级别指定子表中的列</span></span><br><span class="line"><span class="comment">-- REFERENCES：表示在父表中的列</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>建表后</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 从表名 <span class="keyword">ADD</span> [<span class="keyword">CONSTRAINT</span> 约束名] <span class="keyword">FOREIGN</span> KEY (从表字段) <span class="keyword">REFERENCES</span> 主表名(主表字段) [<span class="keyword">ON</span> <span class="keyword">UPDATE</span> xx][<span class="keyword">ON</span> <span class="keyword">DELETE</span> xx];</span><br></pre></td></tr></table></figure></li>
</ul>
<p>总结：约束关系是针对双方的</p>
<ul>
<li>添加了外键约束后，主表的修改和删除数据受约束</li>
<li>添加了外键约束后，从表的添加和修改数据受约束</li>
<li>在从表上建立外键，要求主表必须存在</li>
<li>删除主表时，要求从表先删除，或将从表中外键引用该主表的关系先删除</li>
</ul>
<h4 id="6-6-约束等级"><a href="#6-6-约束等级" class="headerlink" title="6.6 约束等级"></a>6.6 约束等级</h4><ul>
<li>Cascade 方式：在父表上 update&#x2F;delete 记录时，同步 update&#x2F;delete 掉子表的匹配记录</li>
<li>Set null 方式：在父表上 update&#x2F;delete 记录时，将子表上匹配记录的列设为 null，但是要注意子表的外键列不能为 not null</li>
<li>No action 方式：如果子表中有匹配的记录，则不允许对父表对应候选键进行 update&#x2F;delete 操作</li>
<li>Restrict 方式：同 no action，都是立即检查外键约束</li>
<li>Set default 方式：父表有变更时，子表将外键列设制成一个默认的值，但 InnoDb 不能识别。</li>
</ul>
<p>如果没有置顶等级，就相当于 Restrict 方式。</p>
<p><strong>对于外键约束，最好是采用：<code>ON UPDATE CASCADE ON DELETE RESTRICT</code> 的方式</strong>。</p>
<h4 id="6-7-删除外键约束"><a href="#6-7-删除外键约束" class="headerlink" title="6.7 删除外键约束"></a>6.7 删除外键约束</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 第一步先查看约束名和删除外键约束</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.table_constraints <span class="keyword">WHERE</span> table_name <span class="operator">=</span> <span class="string">&#x27;表名称&#x27;</span>; #查看某个表的约束名</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 从表名 <span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> KEY 外键约束名;</span><br><span class="line"></span><br><span class="line">#第二步查看索引名和删除索引。注意只能手动删除</span><br><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> 表名称;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 从表名 <span class="keyword">DROP</span> INDEX 索引名;</span><br></pre></td></tr></table></figure>

<h4 id="6-8-开发场景"><a href="#6-8-开发场景" class="headerlink" title="6.8 开发场景"></a>6.8 开发场景</h4><p><strong>问题一：如果两个表之间有关系 (一对一、一对多)，它们之间是否一定要建外键约束</strong>？</p>
<p>答：不是的</p>
<p><strong>问题二：建和不建外键约束有什么区别</strong>？</p>
<p>答：建外键约束，你的操作 (创建表、删除表、添加、修改、删除) 会受到限制，从语法层面受到限制。例如：在员工表中不可能添加一个员工信息，他的部门的值在部门表中找不到。</p>
<p>不建外键约束，你的操作 (创建表、删除表、添加、修改、删除) 不受限制，要保证数据的引用完整性，只能依靠程序员的自觉，或者是在 Java 程序中进行限定。例如：在员工表中，可以添加一个员工信息，它的部门指定为一个完全不存在的部门。</p>
<p><strong>问题三：那么建和不建外键约束和查询有没有关系</strong>？</p>
<p>答：没有</p>
<blockquote>
<p>在 MySQL 里，外键约束是有成本的，需要消耗系统资源。对于大并发的 SQL 操作，有可能会不适合。比如大型网站的中央数据库，可能会因为外键约束的系统开销而变得非常慢。所以，MySQL 允许你不使用系统自带的外键约束，在应用层面完成检查数据一致性的逻辑。也就是说，即使你不用外键约束，也要想办法通过应用层面的附加逻辑，来实现外键约束的功能，确保数据的一致性。</p>
</blockquote>
<h4 id="6-9-阿里开发规范"><a href="#6-9-阿里开发规范" class="headerlink" title="6.9 阿里开发规范"></a>6.9 阿里开发规范</h4><p>【强制】不得使用外键与级联，一切外键概念必须在应用层解决。</p>
<p>说明：(概念解释) 学生表中的 student_id 是主键，那么成绩表中的 student_id 则为外键。如果更新学生表中的 student_id，同时出发成绩表中的 student_id 更新，即为级联更新。外键与级联更新适用于单机低并发，不适合分布式、高并发集群；级联更新是强阻塞，存在数据库更新风暴的风险；外键影响数据库的插入速度。</p>
<h3 id="7-CHECK-约束"><a href="#7-CHECK-约束" class="headerlink" title="7. CHECK 约束"></a>7. CHECK 约束</h3><h4 id="7-1-作用"><a href="#7-1-作用" class="headerlink" title="7.1 作用"></a>7.1 作用</h4><p>检查某个字段的值是否符合 xx 要求，一般指的是值的范围。</p>
<h4 id="7-2-关键字"><a href="#7-2-关键字" class="headerlink" title="7.2 关键字"></a>7.2 关键字</h4><p>CHECK</p>
<h4 id="7-3-说明：MySQL-5-7-不支持"><a href="#7-3-说明：MySQL-5-7-不支持" class="headerlink" title="7.3 说明：MySQL 5.7 不支持"></a>7.3 说明：MySQL 5.7 不支持</h4><p>MySQL 5.7 可以使用 check 约束，但 check 约束对数据验证没有任何作用。添加数据时，没有任何错误或警告。但是 MySQL 8.0 中可以使用 check 约束了。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表名(</span><br><span class="line">	id <span class="type">INT</span> AUTO_INCREMENT,</span><br><span class="line">  name <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">  age <span class="type">INT</span> <span class="keyword">CHECK</span>(age <span class="operator">&gt;</span> <span class="number">20</span>),</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="8-DEFAULT-约束"><a href="#8-DEFAULT-约束" class="headerlink" title="8. DEFAULT 约束"></a>8. DEFAULT 约束</h3><h4 id="8-1-作用"><a href="#8-1-作用" class="headerlink" title="8.1 作用"></a>8.1 作用</h4><p>给某个字段&#x2F;某列指定默认值，一旦设置默认值，在插入数据时，如果此字段没有显示赋值，则赋值为默认值。</p>
<h4 id="8-2-关键字"><a href="#8-2-关键字" class="headerlink" title="8.2 关键字"></a>8.2 关键字</h4><p>DEFAULT</p>
<h4 id="8-3-如果给字段加默认值"><a href="#8-3-如果给字段加默认值" class="headerlink" title="8.3 如果给字段加默认值"></a>8.3 如果给字段加默认值</h4><ul>
<li>建表时：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表名称(</span><br><span class="line">	column1 数据类型 <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">  column1 数据类型 <span class="keyword">UNIQUE</span> KEY <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  column1 数据类型 <span class="keyword">UNIQUE</span> KEY,</span><br><span class="line">  column1 数据类型 <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> 默认值</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li>建表后：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名称 MODIFY <span class="keyword">column</span> 数据类型 <span class="keyword">DEFAULT</span> 默认值;</span><br><span class="line"># 如果这个字段原来有非空约束，你还保留非空约束，那么在加载默认值约束是，海的保留非空约束，否则非空约束就被删除了。</span><br><span class="line"># 同理，再给某个字段加非空约束也一样，如果这个字段原来有默认值的约束，你想保留，也要在 modify 语句中保留默认值约束，否则就删除了</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名称 MODIFY 字段名 数据类型 <span class="keyword">DEFAULT</span> 默认值 <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<h4 id="8-4-删除默认值约束"><a href="#8-4-删除默认值约束" class="headerlink" title="8.4 删除默认值约束"></a>8.4 删除默认值约束</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名称 MODIFY <span class="keyword">column</span> 数据类型;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名称 MODIFY <span class="keyword">column</span> 数据类型 <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<h3 id="9-面试题"><a href="#9-面试题" class="headerlink" title="9. 面试题"></a>9. 面试题</h3><ul>
<li><p>为什么建表时，加 NOT NULL DEFAULT 或 DEFAULT 0 ？</p>
<p>  答：不想让表中出现 NULL 值。</p>
</li>
<li><p>为什么不想要 NULL 值？</p>
<p>  答：1. 不好比较。NULL 是一种特殊值，比较时只能用专门的 IS NULL 和 IS NOT NULL 来比较。碰到运算符，通常返回 NULL。</p>
<p>  ​		2. 效率不高。影响提高索引效果。因此，我们往往在建表时 NOT NULL DEFAULT 或 DEFAULT 0。</p>
</li>
<li><p>带 AUTO_INCREMENT 约束的字段值是从 1 开始的吗？</p>
<p>  在 MySQL 中，默认 AUTO_INCREMENT 的初始值是 1，每新增一条记录，字段值自动加 1.设置自增属性的时候，还可以指定第一条插入记录的自增字段的值，这样插入的记录的自增字段值从初识值开始递增，如在表中插入第一条记录，同时指定 id 值为 5，则以后插入的记录的 id 就会从 6 开始往上增加。添加主键约束时，往往需要设置字段自动增加属性。</p>
</li>
<li><p>并不是每个表都可以任意选择存储引擎？</p>
<p>  外键约束不能跨引擎使用。</p>
<p>  MySQL 支持多种存储引擎，每一个表都可以指定一个不同的存储引擎，需要注意的是：外键约束是用来保证数据的参照完整性的，如果表之间需要关联外键，却指定了不同的存储引擎，那么这些表之间是不能创建外键约束的。所以说，存储引擎的选择也不完全是随意的。</p>
</li>
</ul>
<h2 id="十三、视图"><a href="#十三、视图" class="headerlink" title="十三、视图"></a>十三、视图</h2><h3 id="1-常见的数据库对象"><a href="#1-常见的数据库对象" class="headerlink" title="1. 常见的数据库对象"></a>1. 常见的数据库对象</h3><table>
<thead>
<tr>
<th>对象</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>表 TABLE</td>
<td>表示存储数据的逻辑单元，以行和列的形式存在，列就是字段，行就是记录</td>
</tr>
<tr>
<td>数据字典</td>
<td>就是系统表，存放数据库相关信息的表。系统表的数据通常有数据库系统维护，程序员通常不应该修改，只可查看</td>
</tr>
<tr>
<td>约束 CONSTRAINT</td>
<td>执行数据校验的规则，用于保证数据完整性的规则</td>
</tr>
<tr>
<td>视图 VIEW</td>
<td>一个或者多个数据表里的数据的逻辑显示，视图并不存储数据</td>
</tr>
<tr>
<td>索引 INDEX</td>
<td>用于提高查询性能，相当于数的目录</td>
</tr>
<tr>
<td>存储过程 PROCEDURE</td>
<td>用于完成一次完成的业务处理，没有返回值，但可通过传出参数将多个值传给调用环境</td>
</tr>
<tr>
<td>存储函数 FUNCTION</td>
<td>用于完成一次特定的计算，具有一个返回值</td>
</tr>
<tr>
<td>触发器</td>
<td>相当于一个事件监听器，当数据库发生特定事件后，触发器被触发，完成相应的处理</td>
</tr>
</tbody></table>
<h3 id="2-视图概述"><a href="#2-视图概述" class="headerlink" title="2. 视图概述"></a>2. 视图概述</h3><h4 id="2-1-为什么使用视图？"><a href="#2-1-为什么使用视图？" class="headerlink" title="2.1 为什么使用视图？"></a>2.1 为什么使用视图？</h4><p>视图一方面可以帮我们使用表的一部分而不是所有的表，另一方面也可以针对不同的用户制定不同的查询视图。比如，针对一个公司的销售人员，我们只想给他看部分数据，而某些特殊的数据，比如采购的价格，则不会提供给他。再比如，人员薪酬是个敏感的字段，那么只给某个级别以上的人员开放，其他人的查询视图中则不提供这个字段。</p>
<h4 id="2-2-视图的理解"><a href="#2-2-视图的理解" class="headerlink" title="2.2 视图的理解"></a>2.2 视图的理解</h4><ul>
<li>视图是一种虚拟表，本身是不具有数据的，占用很少的内存空间，它是 SQL 中的一个重要概念。</li>
<li>视图建立在已有表的基础上，视图赖以建立的这些表称为基表。</li>
<li>视图的创建和删除只影响视图本身，不影响对应的基表。但是当对视图中的数据进行增加、删除和修改操作时，数据表中的数据会相应地发生改变，反之亦然。</li>
<li>向视图提供数据内容的语句为 SELECT 语句，可以将视图理解为存储起来的 SELECT 语句。<ul>
<li>在数据库中，视图不会保存数据，数据真正保存在数据表中。当对视图中的数据进行增加、删除和修改操作时，数据表中的数据会相应地发生变化，反之依然。</li>
</ul>
</li>
<li>视图，是向用户提供基表数据的另一种表现形式。通常情况下，小型项目的数据库可以不使用视图，但是在大型项目中，以及数据表比较复杂的情况下，视图的价值就凸显出来了，他可以帮助我们把经常查询的结果集放到虚拟表中，提升使用效率。理解和使用起来都非常方便。</li>
</ul>
<h3 id="3-创建视图"><a href="#3-创建视图" class="headerlink" title="3. 创建视图"></a>3. 创建视图</h3><ul>
<li><p>在 CREATE VIEW 语句中嵌入子查询</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> [<span class="keyword">OR</span> REPLACE]</span><br><span class="line">[ALGORITHM <span class="operator">=</span> &#123;UNDEFINED <span class="operator">|</span> <span class="keyword">MERGE</span> <span class="operator">|</span> TEMPTABLE&#125;]</span><br><span class="line"><span class="keyword">VIEW</span> 视图名称 [(字段列表)]</span><br><span class="line"><span class="keyword">AS</span> 查询语句</span><br><span class="line">[<span class="keyword">WITH</span> [<span class="keyword">CASCADED</span><span class="operator">|</span><span class="keyword">LOCAL</span>] <span class="keyword">CHECK</span> OPTION]</span><br></pre></td></tr></table></figure>
</li>
<li><p>精简版</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> 视图名称</span><br><span class="line"><span class="keyword">AS</span> 查询语句</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="3-1-创建单表视图"><a href="#3-1-创建单表视图" class="headerlink" title="3.1 创建单表视图"></a>3.1 创建单表视图</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> 视图名称</span><br><span class="line"><span class="keyword">AS</span> </span><br><span class="line"><span class="keyword">SELECT</span> column1 col1, column2 col2, column3 col3</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">table</span></span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> 视图名称 (col1, col2, col3)</span><br><span class="line"><span class="keyword">AS</span> </span><br><span class="line"><span class="keyword">SELECT</span> column1, column2, column3</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">table</span></span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br><span class="line"></span><br><span class="line"># 查看视图</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> 视图名称;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-创建多表视图"><a href="#3-2-创建多表视图" class="headerlink" title="3.2 创建多表视图"></a>3.2 创建多表视图</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> 视图名称</span><br><span class="line"><span class="keyword">AS</span> </span><br><span class="line"><span class="keyword">SELECT</span> t1.column1 col1, t2.column2 col2, t2.column3 col3</span><br><span class="line"><span class="keyword">FROM</span> table1 t1 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> table2 t2</span><br><span class="line"><span class="keyword">ON</span> <span class="keyword">condition</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> 视图名称 (col1, col2, col3)</span><br><span class="line"><span class="keyword">AS</span> </span><br><span class="line"><span class="keyword">SELECT</span> t1.column1, t2.column2, t2.column3</span><br><span class="line"><span class="keyword">FROM</span> table1 t1 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> table2 t2</span><br><span class="line"><span class="keyword">ON</span> <span class="keyword">condition</span>;</span><br><span class="line"></span><br><span class="line"># 查看视图</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> 视图名称;</span><br></pre></td></tr></table></figure>

<p><strong>利用视图对数据进行格式化</strong></p>
<p>我们经常需要输出某个格式的内容，比如想输出员工姓名和对应的部门名，对应格式为 emp_name(department_name)，就可以使用视图来完成数据格式化的操作：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp_depart</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(last_name, <span class="string">&#x27;(&#x27;</span>,department,<span class="string">&#x27;)&#x27;</span>) <span class="keyword">AS</span> emp_dept</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">WHERE</span> e.department_id <span class="operator">=</span> d.department_id;</span><br></pre></td></tr></table></figure>

<h4 id="3-3-基于视图创建视图"><a href="#3-3-基于视图创建视图" class="headerlink" title="3.3 基于视图创建视图"></a>3.3 基于视图创建视图</h4><p>当我们创建好一张视图之后，还可以在它的基础上继续创建视图。</p>
<h3 id="4-查看视图"><a href="#4-查看视图" class="headerlink" title="4. 查看视图"></a>4. 查看视图</h3><p>语法1: 查看数据库的表对象、视图对象</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> TABLES;</span><br></pre></td></tr></table></figure>

<p>语法2: 查看视图的结构</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DESC</span> <span class="operator">/</span> <span class="keyword">DESCRIBE</span> 视图名称;</span><br></pre></td></tr></table></figure>

<p>语法3: 查看视图的属性信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 查看视图信息(显示数据表的存储引擎、版本、数据行数和数据大小等)</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TABLE</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;视图名称&#x27;</span>\G</span><br></pre></td></tr></table></figure>

<p>执行结果显示，注释 Comment 为 VIEW，说明该表为视图，其他的信息为 NULL，说明这是一个虚标。</p>
<p>语法4: 查看视图的详细定义信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">VIEW</span> 视图名称;</span><br></pre></td></tr></table></figure>

<h3 id="5-修改视图的数据"><a href="#5-修改视图的数据" class="headerlink" title="5. 修改视图的数据"></a>5. 修改视图的数据</h3><h4 id="5-1-一般情况"><a href="#5-1-一般情况" class="headerlink" title="5.1 一般情况"></a>5.1 一般情况</h4><p>MySQL 支持使用 INSERT、UPDATE 和 DELETE 语句对视图中的数据进行插入、更新和删除操作。当视图中的数据发生变化时，数据表中的数据也会发生变化，反之亦然。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> 视图名称 <span class="keyword">SET</span> <span class="keyword">column</span> <span class="operator">=</span> <span class="keyword">value</span> <span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> 视图名称 <span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br></pre></td></tr></table></figure>

<h4 id="5-2-不可更新的视图"><a href="#5-2-不可更新的视图" class="headerlink" title="5.2 不可更新的视图"></a>5.2 不可更新的视图</h4><p>要使视图可更新，视图中的行和底层基本表中的行之间必须存在一对一的关系。另外当视图定义出现如下情况时，视图不支持更新操作：</p>
<ul>
<li>在定义视图的时候指定了 <code>ALGORITHM = TEMPTABLE</code>，视图将不支持 INSERT 和 DELETE 操作；</li>
<li>视图中不包含基表中所有被定义为非空又未指定默认值的列，视图将不支持 INSERT 操作；</li>
<li>在定义视图的 SELECT 语句中使用了 JOIN 联合查询，视图将不支持 INSERT 和 DELETE 操作；</li>
<li>在定义视图的 SELECT 语句后的字段列表中使用了数学表达式或子查询，视图将不支持 INSERT，也不支持 UPDATE 使用了数学表达式、子查询的字段值；</li>
<li>在定义视图的 SELECT 语句后的字段列表中使用 DISTINCT、聚合函数、GROUP BY、HAVING、UNION 等，视图将不支持 INSERT、UPDATE、DELETE；</li>
<li>在定义视图的 SELECT 语句中包含了子查询，而子查询中引用了 FROM 后面的表，视图将不支持 INSERT、UPDATE、DELETE；</li>
<li>视图定义给予一个不可更新视图；</li>
<li>常量视图。</li>
</ul>
<blockquote>
<p>虽然可以更新视图数据，但总的来说，视图作为虚拟表，主要用于方便查询，不建议更逊视图的数据。对视图数据的更改，都是通过对实际数据表里数据的操作来完成的。</p>
</blockquote>
<h3 id="6-修改、删除视图"><a href="#6-修改、删除视图" class="headerlink" title="6. 修改、删除视图"></a>6. 修改、删除视图</h3><h4 id="6-1-修改视图"><a href="#6-1-修改视图" class="headerlink" title="6.1 修改视图"></a>6.1 修改视图</h4><ul>
<li><p>方式一：使用 <code>CREATE OR REPLACE VIEW</code> 子句修改视图</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">VIEW</span> 视图名</span><br><span class="line">(col1, col2, col3)</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> column1, column2, column3</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">table</span></span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>说明：CREATE VIEW 子句中各列的别名应和子查询中各列相对应。</p>
</blockquote>
</li>
<li><p>方式二：ALTER VIEW</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">VIEW</span> 视图名称</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line">查询语句;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="6-2-删除视图"><a href="#6-2-删除视图" class="headerlink" title="6.2 删除视图"></a>6.2 删除视图</h4><ul>
<li><p>删除视图只是删除视图的定义，并不会删除基表的数据。</p>
</li>
<li><p>删除视图的语法：</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> IF <span class="keyword">EXISTS</span> 视图名称;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> IF <span class="keyword">EXISTS</span> 视图名称<span class="number">1</span>, 视图名称<span class="number">2</span>, 视图名称<span class="number">3</span>, ....;</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>说明：基于视图 a、b 创建了新的视图 c，如果将视图 a 或视图 b 删除，会导致视图 c 的查询失败。这样的视图 c 需要手动删除或修改，否则影响使用。</p>
</blockquote>
<h3 id="7-总结"><a href="#7-总结" class="headerlink" title="7. 总结"></a>7. 总结</h3><h4 id="7-1-视图优点"><a href="#7-1-视图优点" class="headerlink" title="7.1 视图优点"></a>7.1 视图优点</h4><ul>
<li><p>操作简单</p>
<p>  将经常使用的查询操作定义为视图，可以使开发人员不需要关心视图对应的数据表的结构、表于表之间的关联关系，也不需要关心数据表之间的业务逻辑和查询条件，而只需要简单地操作视图即可，极大简化了开发人员对数据库的操作。</p>
</li>
<li><p>减少数据冗余</p>
<p>  视图跟实际数据表不一样，它存储的是查询语句。所以，在使用的时候，我们要通过定义视图的查询语句来获取结果集。而视图本身不存储数据，不占用数据存储的资源，减少了数据冗余。</p>
</li>
<li><p>数据安全</p>
<p>  MySQL 将用户对数据的访问限制在某些数据的结果集上，而这些数据的结果集可以使用视图来实现。用户不必直接查询或操作数据表。这也可以理解为视图具有隔离性。视图相当于在用户和实际的数据表之间加了一层虚拟表。</p>
<p>  同时，MySQL 可以根据权限将用户对数据的访问限制在某些视图上，用户不需要查询数据库，可以直接通过视图获取数据表中的信息。这在一定程度上保障了数据表中数据的安全性。</p>
</li>
<li><p>适应灵活多变的需求</p>
<p>  当业务系统的需求发生变化后，如果需要改动数据表的结构，则工作量相对大，可以使用视图来减少改动的工作量。这种方式在实际工作中使用得比较多。</p>
</li>
<li><p>能够分解复杂的查询逻辑</p>
<p>  数据库中如果存在复杂的查询逻辑，则可以将问题进行分解，创建多个视图获取数据，再将创建的多个视图结合起来，完成复杂的查询逻辑。</p>
</li>
</ul>
<h4 id="7-2-视图不足"><a href="#7-2-视图不足" class="headerlink" title="7.2 视图不足"></a>7.2 视图不足</h4><p>如果我们在实际数据表的基础上创建视图，那么，如果实际数据表的结构变更了，我们就需要及时对相关的视图进行相应的维护。特别是嵌套的视图 (就是在视图的基础上创建视图)，维护会变得比较复杂，可读性不好，容易变成系统的潜在隐患。因为创建视图的 SQL 查询可能会对字段重命名，也可能包含复杂的逻辑，这些都会增加维护的成本。</p>
<p>实际项目中，如果视图过多，会导致数据库维护成本的问题。</p>
<p>所以，在创建视图的时候，你要结合实际项目需求，综合考虑视图的优点和不足，这样才能正确使用视图，使系统整体达到最优。</p>
<h2 id="十四、存储过程与存储函数"><a href="#十四、存储过程与存储函数" class="headerlink" title="十四、存储过程与存储函数"></a>十四、存储过程与存储函数</h2><p>MySQL 从 5.0 版本开始支持存储过程和函数。存储过程和函数能够将复杂的 SQL 逻辑封装在一起，应用程序无需关注存储过程和函数内部复杂的 SQL 逻辑，而只需要简单地调用存储过程和函数即可。</p>
<h3 id="1-存储过程概述"><a href="#1-存储过程概述" class="headerlink" title="1. 存储过程概述"></a>1. 存储过程概述</h3><h4 id="1-1-理解"><a href="#1-1-理解" class="headerlink" title="1.1 理解"></a>1.1 理解</h4><p><strong>含义</strong>：存储过程是英文 <code>Stored Procedure</code>。它的思想很简单，就是一组经过预先编译的 SQL 语句的封装。</p>
<p>执行过程：存储过程预先存储在 MySQL 服务器上，需要执行的时候，客户端只需要向服务器端发出调用存储过程的命令，服务器端就可以把预先存储好的这一系列 SQL 语句全部执行。</p>
<p><strong>好处：</strong></p>
<ul>
<li>简化操作，提高了 SQL 语句的重用性，减少了开发程序员的压力</li>
<li>减少操作过程中的事物，提高效率</li>
<li>减少网络传输量 (客户端不需要把所有的 SQL 语句通过网络发给服务器)</li>
<li>减少了 SQL 语句暴露在网上的风险，也提高了数据查询的安全性</li>
</ul>
<p><strong>和视图、函数的对比：</strong></p>
<p>它和视图有着同样的优点，清晰、安全，还可以减少网络传输量。不过它和视图不同，视图是虚拟表，通常不对底层数据表直接操作，而存储过程是程序化的 SQL，可以直接操作底层数据表，相比于面向集合的操作方式，能够实现一些更复杂的数据处理。</p>
<p>一旦存储过程被创建出来，使用它就像使用函数一样简单，直接通过调用存储过程名即可。相较于函数，存储过程是没有返回值的。</p>
<h4 id="1-2-分类"><a href="#1-2-分类" class="headerlink" title="1.2 分类"></a>1.2 分类</h4><p>存储过程的参数类型可以是 IN、OUT 和 INOUT。根据这点分类如下：</p>
<ul>
<li>没有参数 (无参数无返回)</li>
<li>仅仅带 IN 类型 (有参数无返回)</li>
<li>仅仅带 OUT 类型 (无参数有返回)</li>
<li>既带 IN 又带 OUT (有参数有返回)</li>
<li>带 INOUT (有参数有返回)</li>
</ul>
<p>注意：IN、OUT、INOUT 都可以在一个存储过程中带多个。</p>
<h3 id="2-创建存储过程"><a href="#2-创建存储过程" class="headerlink" title="2. 创建存储过程"></a>2. 创建存储过程</h3><h4 id="2-1-语法分析"><a href="#2-1-语法分析" class="headerlink" title="2.1 语法分析"></a>2.1 语法分析</h4><p>语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> 存储过程名(<span class="keyword">IN</span><span class="operator">|</span><span class="keyword">OUT</span><span class="operator">|</span><span class="keyword">INOUT</span> 参数名 参数类型，...)</span><br><span class="line">[characteristics ...]</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	存储过程体</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<p>说明：</p>
<ul>
<li><p>参数前面的符号的意思</p>
<ul>
<li><p><code>IN</code>：当前参数为输入参数，也就是表示入参；</p>
<p>  存储过程只是读取这个参数的值。如果没有定义参数种类，默认就是 IN，表示输入参数。</p>
</li>
<li><p><code>OUT</code>：当前参数为输出参数，也就是表示出参；</p>
<p>  执行完成之后，调用这个存储过程的客户端或者应用程序就可以读取这个参数返回的值了。</p>
</li>
<li><p><code>INOUT</code>：当前参数既可以为输入参数，也可以为输出参数。</p>
</li>
</ul>
</li>
<li><p>形参类型可以是 MySQL 数据库中的任意类型。</p>
</li>
<li><p><code>characteristics</code> 表示创建存储过程时指定的对存储过程的约束条件，其取值信息如下：</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LANGUAGE</span> <span class="keyword">SQL</span></span><br><span class="line"><span class="operator">|</span> [<span class="keyword">NOT</span>] <span class="keyword">DETERMINISTIC</span></span><br><span class="line"><span class="operator">|</span> &#123;<span class="keyword">CONTAINS</span> <span class="keyword">SQL</span> <span class="operator">|</span> <span class="keyword">NO</span> <span class="keyword">SQL</span> <span class="operator">|</span> <span class="keyword">READS</span> <span class="keyword">SQL</span> DATA <span class="operator">|</span> <span class="keyword">MODIFIES</span> <span class="keyword">SQL</span> DATA&#125;</span><br><span class="line"><span class="operator">|</span> <span class="keyword">SQL</span> SECURITY &#123;DEFINER <span class="operator">|</span> INVOKER&#125;</span><br><span class="line"><span class="operator">|</span> COMMENT <span class="string">&#x27;string&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>LANGUAGE SQL</code>：说明存储过程执行体是由 SQL 语句组成的，当前系统支持的语言为 SQL。</li>
<li><code>[NOT] DETERMINISTIC</code>：指明存储过程执行的结果是否确定。DETERMINISTIC 表示结果是确定的。每次执行存储过程时，相同的输入会得到相同的输出。NOT DETERMINISTIC 表示结果是不确定的，相同的输入可能得到不同的输出。如果没有指定任意一个值，默认为 NOT DETERMINISTIC。</li>
<li><code>&#123;CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA&#125;</code>：指明子程序使用 SQL 语句的限制。<ul>
<li><code>CONTAINS SQL</code>  表示当前存储过程的子程序包含 SQL 语句，但是并不包含读写数据的 SQL 语句；</li>
<li><code>NO SQL</code> 表示当前存储过程的子程序中不包含任何 SQL 语句；</li>
<li><code>READS SQL DATA</code> 表示当前存储过程的子程序中包含读数据的 SQL 语句；</li>
<li><code>MODIFIES SQL DATA</code> 表示当前存储过程的子程序中包含写数据的 SQL 语句。</li>
<li>默认情况下，系统会指定为 CONTAINS SQL。</li>
</ul>
</li>
<li><code>SQL SECURITY &#123;DEFINER | INVOKER&#125;</code>：执行当前存储过程的权限，即指明哪些用户能够执行当前存储过程。<ul>
<li><code>DEFINER</code> 表示只有当前存储过程的创建者或者定义者才能执行当前存储过程；</li>
<li><code>INVOKER</code> 表示拥有当前存储过程的访问权限的用户能够执行当前存储过程。</li>
<li>如果没有设置相关的值，则 MySQL 默认指定值为 DEFINER。</li>
</ul>
</li>
<li><code>COMMENT &#39;string&#39;</code>：注释信息，可以用来描述存储过程。</li>
</ul>
</li>
<li><p>存储过程体中可以有多条 SQL 语句，如果仅仅一条 SQL 语句，则可以省略 BEGIN 和 END 编写存储过程并不是一件简单的事情，可能存储过程中需要复杂的 SQL 语句。</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> BEGIN...END：中间包含了多个语句，每个语句都以<span class="string">&#x27;;&#x27;</span>好为结束符。</span><br><span class="line"><span class="number">2.</span> <span class="keyword">DECLARE</span>：用来声明变量，使用的位置在于 <span class="keyword">BEGIN</span> ... <span class="keyword">END</span> 语句中间，而且需要在其他语句使用之前进行变量的生命。</span><br><span class="line"><span class="number">3.</span> <span class="keyword">SET</span>：赋值语句，用于对变量进行赋值。</span><br><span class="line"><span class="number">4.</span> <span class="keyword">SELECT</span> ... <span class="keyword">INTO</span>：把从数据表中查询的结果存放到变量中，也就是为变量赋值。</span><br></pre></td></tr></table></figure>
</li>
<li><p>需要设置新的结束标记</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER 新的结束标记</span><br></pre></td></tr></table></figure>

<p>  因为 MySQL 默认的语句结束符号为分号 “;”。为了避免与存储过程中 SQL 语句结束符相冲突，需要使用 DELIMITER 改变存储过程的结束符。</p>
<p>  比如：<code>DELIMITER //</code> 语句的作用是将 MySQL 的结束符设置为 <code>//</code>，并以 <code>END //</code> 结束存储过程。存储过程定义完毕之后再使用 <code>DELIMITER ;</code> 恢复默认结束符。DELIMITER 也可以指定其他符号作为结束符。</p>
<p>  当使用 DEMILITER 命令时，应该避免使用反斜杠 ‘\‘ 字符，因为反斜线是 MySQL 的转义字符。</p>
<p>  示例：</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> 存储过程名(<span class="keyword">IN</span><span class="operator">|</span><span class="keyword">OUT</span><span class="operator">|</span><span class="keyword">INOUT</span> 参数名 参数类型, ...)</span><br><span class="line">[characteristics]</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">sql</span>语句<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">sql</span>语句<span class="number">2</span>;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-存储过程调用"><a href="#3-存储过程调用" class="headerlink" title="3. 存储过程调用"></a>3. 存储过程调用</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CALL</span> 存储过程名(实参列表)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>调用 IN 模式的参数</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CALL</span> 存储过程名(<span class="string">&#x27;值&#x27;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>调用 OUT 模式的参数</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="variable">@name</span>;</span><br><span class="line"><span class="keyword">CALL</span> 存储过程名(<span class="variable">@name</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@name</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>调用 INOUT 模式的参数</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="variable">@name</span> <span class="operator">=</span> 值;</span><br><span class="line"><span class="keyword">CALL</span> 存储过程名(<span class="variable">@name</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@name</span>;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="4-存储函数的使用"><a href="#4-存储函数的使用" class="headerlink" title="4. 存储函数的使用"></a>4. 存储函数的使用</h3><h4 id="4-1-语法分析"><a href="#4-1-语法分析" class="headerlink" title="4.1 语法分析"></a>4.1 语法分析</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> 函数名(参数名 参数类型,...)</span><br><span class="line"><span class="keyword">RETURNS</span> 返回值类型</span><br><span class="line">[characteristics ...]</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	函数体 # 函数体中肯定有 <span class="keyword">return</span> 语句</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<p> 说明：</p>
<ul>
<li><p>参数列表：指定参数为 IN、OUT 或 INOUT 只对 PROCEDURE 是合法的，FUNCTION 中总是默认为 IN 参数。</p>
</li>
<li><p>RETURNS type 语句表示函数返回数据的类型。</p>
<p>  RETURNS 子句只能对 FUNCTION 做指定，对函数而言这是强制的。它用来指定函数的返回类型，而且函数体必须包含一个 <code>RETURN value</code> 语句。</p>
</li>
<li><p><code>characteristic</code> 创建函数时指定的对函数的约束。取值与创建存储过程时相同。</p>
</li>
<li><p>函数体也可以用 <code>BEGIN ... END</code> 来表示 SQL 代码的开始和结束。托过函数题已有一条语句，也可以省略 <code>BEGIN ... END。</code></p>
</li>
</ul>
<h4 id="4-2-调用存储函数"><a href="#4-2-调用存储函数" class="headerlink" title="4.2 调用存储函数"></a>4.2 调用存储函数</h4><p>在 MySQL 中，存储函数的使用方法与 MySQL 内部函数的使用方法是一样的。换言之，用户自己定义的存储函数与 MySQL 内部函数是一个性质的。区别在于，存储函数是用户自定义的，而内部函数是 MySQL 的开发者定义的。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 函数名(实参列表)</span><br></pre></td></tr></table></figure>

<h4 id="4-3-对比存储函数和存储过程"><a href="#4-3-对比存储函数和存储过程" class="headerlink" title="4.3 对比存储函数和存储过程"></a>4.3 对比存储函数和存储过程</h4><table>
<thead>
<tr>
<th></th>
<th>关键字</th>
<th>调用语法</th>
<th>返回值</th>
<th>应用场景</th>
</tr>
</thead>
<tbody><tr>
<td>存储过程</td>
<td>PROCEDURE</td>
<td>CALL 存储过程()</td>
<td>理解为有 0 个或多个</td>
<td>一般用于更新</td>
</tr>
<tr>
<td>存储函数</td>
<td>FUNCTION</td>
<td>SELECT 函数()</td>
<td>只能是一个</td>
<td>一般用于查询结果为一个值并返回时</td>
</tr>
</tbody></table>
<p>此外，<strong>存储函数可以放在查询语句中使用，存储过程不行</strong>。反之，存储过程的功能更加强大，包括能够执行对表的操作 (比如创建表，删除表等) 和事物操作，这些功能是存储函数不具备的。</p>
<h3 id="5-存储过程和函数的查看、修改、删除"><a href="#5-存储过程和函数的查看、修改、删除" class="headerlink" title="5. 存储过程和函数的查看、修改、删除"></a>5. 存储过程和函数的查看、修改、删除</h3><h4 id="5-1-查看"><a href="#5-1-查看" class="headerlink" title="5.1 查看"></a>5.1 查看</h4><ul>
<li><p>使用 SHOW CREATE 语句查看存储过程和函数的创建信息</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> &#123;<span class="keyword">PROCEDURE</span> <span class="operator">|</span> <span class="keyword">FUNCTION</span>&#125; 存储过程或函数名</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 SHOW STATUS 语句查看存储过程和函数的状态信息</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> &#123;<span class="keyword">PROCEDURE</span> <span class="operator">|</span> <span class="keyword">FUNCTION</span>&#125; STATUS [<span class="keyword">LIKE</span> <span class="string">&#x27;pattern&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>  这个语句返回子程序的特征，如数据库、名字、类型、创建者及创建和修改日期。</p>
<p>  <code>[LIKE &#39;pattern&#39;]</code>：匹配存储过程或函数的名称，可以省略。当省略不写时，会列出 MySQL 数据库中存在的所有存储过程或函数的信息。 </p>
</li>
<li><p>从 information_schema.Routines 表中查看存储过程和函数的信息</p>
<p>  MySQL 中存储过程和函数的信息存储在 information_schema 数据库下的 Routines 表中。可以通查查询该表的记录来查询存储过程和函数的信息。其基本语法形式如下：</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.Routines</span><br><span class="line"><span class="keyword">WHERE</span> ROUTINE_NAME <span class="operator">=</span> <span class="string">&#x27;存储过程或函数的名&#x27;</span> [<span class="keyword">AND</span> ROUTINE_TYPE <span class="operator">=</span> &#123;<span class="string">&#x27;PROCEDURE | FUNCTION&#x27;</span>&#125;]</span><br></pre></td></tr></table></figure>

<p>  说明：如果在 MySQL 数据库中存在存储过程和函数名称相同的情况，最好指定 ROUTINE_TYPE 查询条件来指明查询的是存储过程还是存储函数。</p>
</li>
</ul>
<h4 id="5-2-修改"><a href="#5-2-修改" class="headerlink" title="5.2 修改"></a>5.2 修改</h4><p>修改存储过程或函数，不影响存储过程或函数的功能，只是修改相关特性。使用 ALTER 语句实现。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> &#123;<span class="keyword">PROCEDURE</span> <span class="operator">|</span> <span class="keyword">FUNCTION</span>&#125; 存储过程或函数的名 [characteristic ...]</span><br></pre></td></tr></table></figure>

<p>其中，<code>characteristic</code> 指定存储过程或函数的特性，其取值信息与创建存储过程、函数时的取值信息略有不同。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="keyword">CONTAINS</span> <span class="keyword">SQL</span> <span class="operator">|</span> <span class="keyword">NO</span> <span class="keyword">SQL</span> <span class="operator">|</span> <span class="keyword">READS</span> <span class="keyword">SQL</span> DATA <span class="operator">|</span> <span class="keyword">MODIFIES</span> <span class="keyword">SQL</span> DATA&#125;</span><br><span class="line"><span class="operator">|</span> <span class="keyword">SQL</span> SECURITY &#123;DEFINER <span class="operator">|</span> INVOKER&#125;</span><br><span class="line"><span class="operator">|</span>COMMENT <span class="string">&#x27;string&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>CONTAINS SQL</code>，表示子程序包含 SQL 语句，但不包含读或写数据的语句。</li>
<li><code>NO SQL</code>，表示子程序中不包含 SQL 语句。</li>
<li><code>READS SQL DATA</code>，表示子程序中包含读数据的语句。</li>
<li><code>MODIFIES SQL DATA</code>，表示子程序中包含写数据的语句</li>
<li><code>SQL SECURITY &#123;DEFINER | INVOKER&#125;</code>，指明谁有权限来执行。<ul>
<li><code>DEFINER</code>，表示只有定义者自己才能够执行。</li>
<li><code>INVOKER</code>，表示调用者可以执行。</li>
</ul>
</li>
<li><code>COMMENT &#39;string&#39;</code>，表示注释信息。</li>
</ul>
<blockquote>
<p>修改存储过程使用 ALTER PROCEDURE 语句，修改存储函数使用 ALTER FUNCTION 语句。但是，这两个语句的结构是一样的，语句中的所有参数也是一样的。</p>
</blockquote>
<h4 id="5-3-删除"><a href="#5-3-删除" class="headerlink" title="5.3 删除"></a>5.3 删除</h4><p>删除存储过程和函数，可以使用 DROP 语句，其语法结构如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> &#123;<span class="keyword">PROCEDURE</span> <span class="operator">|</span> <span class="keyword">FUNCTION</span>&#125; [IF <span class="keyword">EXISTS</span>] 存储过程或函数的名</span><br></pre></td></tr></table></figure>

<p><code>IF EXITST</code>：如果程序或函数不存储，他可以防止发生错误，产生一个用 <code>SHOW WARNINGS</code> 查看的警告。	</p>
<h3 id="6-关于存储过程和函数使用的争议"><a href="#6-关于存储过程和函数使用的争议" class="headerlink" title="6. 关于存储过程和函数使用的争议"></a>6. 关于存储过程和函数使用的争议</h3><p>尽管存储过程有诸多优点，但是对于存储过程的使用，一致都存在很多争议，比如有些公司对于大型项目要求使用存储过程，而有些公司在手册中明确禁止使用存储过程。</p>
<h4 id="6-1-优点"><a href="#6-1-优点" class="headerlink" title="6.1 优点"></a>6.1 优点</h4><ul>
<li><strong>存储过程可以一次编译多次使用</strong>。存储过程只在创建时进行编译，之后的使用都不需要重新编译，这就提升了 SQL 的执行效率。</li>
<li><strong>可以减少开发工作量</strong>。将代码封装成模块，实际上是编程的核心思想之一，这样可以把复杂的问题拆解成不同的模块，然后模块之间可以重复使用，在减少开发工作量的同时，还能保证代码的结构清晰。</li>
<li><strong>存储过程的安全性强</strong>。在设定存储过程的时候可以设置对用户的使用权限，这样就和视图一样具有较强的安全性。</li>
<li><strong>可以减少网络传输量</strong>。因为代码封装存储过程中，每次使用只需要调用存储过程即可，这样就减少了网络传输量。</li>
<li><strong>良好的封装性</strong>。再进行相对复杂的数据库操作时，原本需要使用一条一条的 SQL 语句，可能要连接多次数据库才能完成的操作，现在变成了一次存储过程，只需要连接一次即可。</li>
</ul>
<h4 id="6-2-缺点"><a href="#6-2-缺点" class="headerlink" title="6.2 缺点"></a>6.2 缺点</h4><p>基于上面的优点，不少大公司都要求大型项目使用存储过程，比如微软、IBM 公司。但是国内的阿里并不推荐开发人员使用存储过程。</p>
<blockquote>
<p><strong>阿里开发规范</strong></p>
<p>【强制】禁止使用存储过程，存储过程难以调试和扩展，更没有移植性。</p>
</blockquote>
<ul>
<li><strong>可移植性差</strong>。存储过程不能夸数据库移植，比如在 MySQL、Oracle 和 SQL Server 里编写的存储过程，在换成其他数据库时都需要重新编写。</li>
<li><strong>调试困难</strong>。只有少数 DBMS 支持存储过程的调试。对于复杂的存储过程来说，开发和维护都不容易。虽然也有一些第三方工具可以对存储过程进行调试，但要收费。</li>
<li><strong>存储过程的版本管理很困难</strong>。比如数据表索引发生变化了，可能会导致存储过程失效。我们在开发软件的时候往往需要进行版本管理，但是存储过程本身没有版本控制，版本迭代更新的时候很麻烦。</li>
<li><strong>它不适合高并发的场景</strong>。高并发的场景需要减少数据库的压力，有时数据库会采用分库分表的方式，而且对可扩展性要求很高，在这种情况下，存储过程会变得难以维护，增加数据库的压力，显然就不适用了。</li>
</ul>
<h2 id="十五、变量、流程控制与游标"><a href="#十五、变量、流程控制与游标" class="headerlink" title="十五、变量、流程控制与游标"></a>十五、变量、流程控制与游标</h2><h3 id="1-变量"><a href="#1-变量" class="headerlink" title="1. 变量"></a>1. 变量</h3><p>在 MySQL 数据库的存储过程中和函数中，可以使用变量来存储查询或计算的中间结果数据，或者输出最终的结果数据。</p>
<p>在 MySQL 数据库中，变量分为<strong>系统变量</strong>以及<strong>用户自定义变量</strong>。</p>
<h4 id="1-1-系统变量"><a href="#1-1-系统变量" class="headerlink" title="1.1 系统变量"></a>1.1 系统变量</h4><p><strong>分类</strong>：</p>
<p>变量由系统定义，不是用户定义，数据服务器层面。启动 MySQL 服务，生成 MySQL 服务实例期间，MySQL 将为 MySQL 服务器内存中的系统变量赋值，这些系统变量定义了当前 MySQL 服务实例的属性、特征。这些系统变量的值要么是编译 MySQL 时参数的默认值，要么是配置文件 (例如 my.ini 等) 中的参数值。</p>
<p>系统变量分为全局系统变量 (需要添加 global 关键字) 以及会话系统变量 (需要添加 session 关键字)，有时也把全局系统变量简称为全局变量，有时也把会话系统变量称为 local 变量。如果不写，默认会话级别。静态变量 (在 MySQL 服务实例运行期间它们的值不能使用 set 动态修改) 属于特殊的全局系统变量。</p>
<p>每一个 MySQL 客户机成功连接 MySQL 服务器后，都会产生与之对应的会话。会话期间，MySQL 服务实例会在 MySQL 服务器内存中生成与该会话对应的会话系统变量，这些会话系统变量的初始值是全局系统变量值的复制。</p>
<p>如图：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://1.117.162.142:9000/blog/mysql%E4%BC%9A%E8%AF%9D.png" alt="mysql会话"></p>
<ul>
<li>全局系统变量针对于所有会话 (连接) 有效，但不能跨重启</li>
<li>会话系统变量仅针对于当前会话 (连接) 有效。会话期间，当前会话对某个会话系统变量值的修改，不会影响其他会话同一个会话系统变量的值。</li>
<li>会话 1 对某个全局系统变量值的修改会导致会话 2 中同一个全局系统变量值的修改。</li>
</ul>
<p>在 MySQL 中有些系统变量只能是全局的，例如 max_connections 用于限制服务器的最大连接数；有些系统变量作用域既可以是全局又可以是会话，例如 character_set_clent 用于设置客户端的字符集；有些系统变量的作用域只能是当前会话，例如 pseudo_thread_id 用于标记当前会话的 MySQL 连接 ID。</p>
<p><strong>查看系统变量</strong>：</p>
<ul>
<li><p>查看所有活部分系统变量</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 查看所有全局变量</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> VARIABLES;</span><br><span class="line"></span><br><span class="line"># 查看所有会话变量</span><br><span class="line"><span class="keyword">SHOW</span> SESSION VARIABLES;</span><br><span class="line">或</span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES;</span><br><span class="line"></span><br><span class="line"># 查看满足条件的部分系统变量</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%标识符%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 查看满足条件的部分会话变量</span><br><span class="line"><span class="keyword">SHOW</span> SESSION VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%标识符%&#x27;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看指定系统变量</p>
<p>  作为 MySQL 编码规范，MySQL 中的系统变量以两个 <code>@@</code> 开头，其中 <code>@@global</code> 仅用于标记全局系统变量，<code>@@session</code> 仅用于标记会话系统变量。<code>@@</code> 首先标记会话系统变量，如果会话系统变量不存在，则标记全局系统变量。</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 查看指定的系统变量的值</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@global</span>.变量名;</span><br><span class="line"></span><br><span class="line"># 查看指定的会话变量的值</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@session</span>.变量名;</span><br><span class="line">或</span><br><span class="line"><span class="keyword">SELECT</span> @@变量名;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改系统变量的值</p>
<p>  有些时候，数据库管理员需要修改系统变量的默认值，以便修改当前会话或者 MySQL 服务实例的属性、特征。具体方法：</p>
<ul>
<li>修改 MySQL 配置文件，继而修改 MySQL 系统变量的值 (该方法需要重启 MySQ L 服务)</li>
<li>在 MySQL 服务运行期间，使用 set 命令重新设置系统变量的值</li>
</ul>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 为某个系统变量赋值</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@global</span>.变量名 <span class="operator">=</span> 变量值;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> 变量名 <span class="operator">=</span> 变量值;</span><br><span class="line"></span><br><span class="line"># 为某个会话变量赋值</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@session</span>.变量名 <span class="operator">=</span> 变量值;</span><br><span class="line"><span class="keyword">SET</span> SESSION 变量名 <span class="operator">=</span> 变量值;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="1-2-用户变量"><a href="#1-2-用户变量" class="headerlink" title="1.2 用户变量"></a>1.2 用户变量</h4><p><strong>用户变量分类</strong></p>
<p>用户变量是用户自己定义的，作为 MySQL 编码规范，MySQL 中的用户变量以一个 <code>@</code> 开头。根据作用范围不同，又分为会话用户变量和局部变量。</p>
<ul>
<li>会话用户变量：作用域和会话变量一样，只对当前连接会话有效。</li>
<li>局部变量：只在 BEGIN 和 END 语句块中有效。局部变量只能在存储过程和函数中使用。</li>
</ul>
<p><strong>会话用户变量</strong></p>
<ul>
<li><p>定义</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 方式<span class="number">1</span>: “<span class="operator">=</span>” 或 “:<span class="operator">=</span>”</span><br><span class="line"><span class="keyword">SET</span> @用户变量 <span class="operator">=</span> 值;</span><br><span class="line"><span class="keyword">SET</span> @用户变量 :<span class="operator">=</span> 值;</span><br><span class="line"></span><br><span class="line"># 方式<span class="number">2</span>: “:<span class="operator">=</span>“ 或 <span class="keyword">INTO</span> 关键字</span><br><span class="line"><span class="keyword">SELECT</span> @用户变量 :<span class="operator">=</span> 表达式 [<span class="keyword">FROM</span> 等子句];</span><br><span class="line"><span class="keyword">SELECT</span> 表达式 <span class="keyword">INTO</span> @用户变量 [<span class="keyword">FROM</span> 等子句];</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看用户变量的值 (查看、比较、运算等)</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> @用户变量;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>局部变量</strong></p>
<p>定义：可以使用 DECLARE 语句定义一个局部变量</p>
<p>作用域：仅仅在定义它的 BEGIN … END 中有效</p>
<p>位置：只能放在 BEGIN … END 中，而且只能放在第一句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span> </span><br><span class="line">	# 生命局部变量</span><br><span class="line">	<span class="keyword">DECLARE</span> 变量名<span class="number">1</span> 变量数据类型 [<span class="keyword">DEFAULT</span> 变量默认值];</span><br><span class="line">	<span class="keyword">DECLARE</span> 变量名<span class="number">1</span>, 变量名<span class="number">2</span>, ... 变量数据类型 [<span class="keyword">DEFAULT</span> 变量默认值];</span><br><span class="line">  </span><br><span class="line">  # 为局部变量赋值</span><br><span class="line">  <span class="keyword">SET</span> 变量名<span class="number">1</span> <span class="operator">=</span> 值;</span><br><span class="line">  <span class="keyword">SELECT</span> 值 <span class="keyword">INTO</span> 变量名<span class="number">2</span> [<span class="keyword">FROM</span> 子句];</span><br><span class="line">  </span><br><span class="line">  # 查看局部变量的值</span><br><span class="line">  <span class="keyword">SELECT</span> 变量<span class="number">1</span>, 变量<span class="number">2</span>, 变量<span class="number">3</span>;</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>定义变量</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> 变量名 类型 [<span class="keyword">default</span> 值];	#	如果没有 <span class="keyword">DEFAULT</span> 子句，初始值为 <span class="keyword">NULL</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>变量赋值</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 方式一：一般用于赋简单的值</span><br><span class="line"><span class="keyword">SET</span> 变量名 <span class="operator">=</span> 值;</span><br><span class="line"><span class="keyword">SET</span> 变量名 :<span class="operator">=</span> 值;</span><br><span class="line"># 方式二：一般用于赋表中的字段值</span><br><span class="line"><span class="keyword">SELECT</span> 字段名或表达式 <span class="keyword">INTO</span> 变量名 <span class="keyword">FROM</span> 表;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用变量 (查看、比较、运算等)</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 局部变量名;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>对比会话用户变量与局部变量</strong></p>
<table>
<thead>
<tr>
<th></th>
<th>作用域</th>
<th>定义位置</th>
<th>语法</th>
</tr>
</thead>
<tbody><tr>
<td>会话用户变量</td>
<td>当前会话</td>
<td>会话的任何地方</td>
<td>加 @ 符号，不用指定类型</td>
</tr>
<tr>
<td>局部变量</td>
<td>定义它的 BEGIN … END 中</td>
<td>BEGIN … END 的第一句话</td>
<td>一般不用加 @，需要指定类型</td>
</tr>
</tbody></table>
<h3 id="2-定义条件与处理程序"><a href="#2-定义条件与处理程序" class="headerlink" title="2. 定义条件与处理程序"></a>2. 定义条件与处理程序</h3><p>定义条件是事先定义程序执行过程中可能遇到的问题，处理程序定义了在遇到问题时应当采取的处理方式，并且保证存储过程或函数在遇到警告或错误时能继续执行。这样可以增强存储程序处理问题的能力，避免程序异常停止运行。</p>
<p>说明：定义条件和处理程序在存储过程、存储函数中都是支持的。</p>
<p>案例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 创建名为 UpdateDataNoCondition 的存储过程</span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> UpdateDataNoCondition()</span><br><span class="line">	<span class="keyword">BEGIN</span> </span><br><span class="line">		<span class="keyword">SET</span> <span class="variable">@x</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> email <span class="operator">=</span> <span class="keyword">NULL</span> <span class="keyword">WHERE</span> last_name <span class="operator">=</span> <span class="string">&#x27;Able&#x27;</span>;</span><br><span class="line">		<span class="keyword">SET</span> <span class="variable">@x</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">		<span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> email <span class="operator">=</span> <span class="string">&#x27;aaabble&#x27;</span> <span class="keyword">WHERE</span> last_name <span class="operator">=</span> <span class="string">&#x27;Able&#x27;</span>;</span><br><span class="line">		<span class="keyword">SET</span> <span class="variable">@x</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">	<span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"># 调用</span><br><span class="line"><span class="keyword">CALL</span> UpdateDataNoCondition();</span><br><span class="line"># 报错</span><br><span class="line">ERROR <span class="number">1048</span> (<span class="number">23000</span>): <span class="keyword">Column</span> <span class="string">&#x27;email&#x27;</span> cannot be <span class="keyword">null</span></span><br><span class="line"># 查看变量 <span class="variable">@x</span> 的值</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@x</span>;</span><br></pre></td></tr></table></figure>

<p>此时 @x 的值为 1。结合创建存储过程的 SQL 语句代码可以得出：在存储过程中未定义条件和处理程序，且当存储过程中执行的 SQL 语句报错时，MySQL 数据库会抛出错误，并退出当前 SQL 逻辑，不再向下继续执行。</p>
<h4 id="2-1-定义条件"><a href="#2-1-定义条件" class="headerlink" title="2.1 定义条件"></a>2.1 定义条件</h4><p>定义条件就是给 MySQL 中的错误码命名，这有助于存储的程序代码更清晰。它将一个错误名字和指定的错误条件关联起来。这个名字可以随后被用在定义处理程序的 DECLARE HANDLER 语句中。</p>
<p>定义条件使用 DECLARE 语句，语法格式如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> 错误名称 <span class="keyword">CONDITION</span> <span class="keyword">FOR</span> 错误码(或错误条件)</span><br></pre></td></tr></table></figure>

<p>错误码的说明：</p>
<ul>
<li>MySQL_error_code 和 sqlstate_value 都可以表示 MySQL 的错误。<ul>
<li>MySQL_error_code 是数值类型错误代码。</li>
<li>sqlstate_value 是长度为 5 的字符串类型错误代码。</li>
</ul>
</li>
<li>例如，在 ERROR 1418 (HY000) 中，1418 是 MySQL_error_code，’HY000’ 是 sqlstate_value。</li>
</ul>
<p>示例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 定义 “Field_Not_Be_NULL” 错误名与 MySQL 中违反非空约束条件</span><br><span class="line"># 使用 MySQL_error_code</span><br><span class="line"><span class="keyword">DECLARE</span> Field_Not_Be_NULL <span class="keyword">CONDITION</span> <span class="keyword">FOR</span> <span class="number">1048</span>;</span><br><span class="line"># 使用 sqlstate_value</span><br><span class="line"><span class="keyword">DECLARE</span> Field_Not_Be_NULL <span class="keyword">CONDITION</span> <span class="keyword">FOR</span> <span class="keyword">SQLSTATE</span> <span class="string">&#x27;23000&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 定义 “ERROR <span class="number">1148</span>(<span class="number">42000</span>)“ 错误，名称为 command_not_allowed。</span><br><span class="line"># 使用 MySQL_error_code</span><br><span class="line"><span class="keyword">DECLARE</span> command_not_allowed <span class="keyword">CONDITION</span> <span class="keyword">FOR</span> <span class="number">1148</span>;</span><br><span class="line">#使用 sqlstate_value</span><br><span class="line"><span class="keyword">DECLARE</span> command_not_allwed <span class="keyword">CONDITION</span> <span class="keyword">FOR</span> <span class="keyword">SQLSTATE</span> <span class="string">&#x27;42000&#x27;</span>; </span><br></pre></td></tr></table></figure>

<h4 id="2-2-定义处理程序"><a href="#2-2-定义处理程序" class="headerlink" title="2.2 定义处理程序"></a>2.2 定义处理程序</h4><p>可以为 SQL 执行过程中发生的某种类型的错误定义特殊的处理程序。定义处理程序时，使用 DECLARE 语句的语法如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> 处理方式 HANDLER <span class="keyword">FOR</span> 错误类型 处理语句</span><br></pre></td></tr></table></figure>

<ul>
<li>处理方式：处理方式有 3 个取值：<code>CONTINUE</code>、<code>EXIT</code>、<code>UNDO</code>。<ul>
<li><code>CONTINUE</code>：表示遇到错误不处理，继续执行。</li>
<li><code>EXIT</code>：表示遇到错误马上退出。</li>
<li><code>UNDO</code>：表示遇到错误后撤回之前的操作。MySQL 中暂时不支持这样的操作。</li>
</ul>
</li>
<li>错误类型 (即条件) 可以有如下取值：<ul>
<li><code>SQLSTATE &#39;字符串错误码&#39;</code>：表示长度为 5 的 sqlstate_value 类型的错误代码；</li>
<li><code>MySQL_error_code</code>：匹配数值类型错误代码；</li>
<li><code>错误名称</code>：表示 DECLARE … CONDITION 定义的错误条件名称；</li>
<li><code>SQLWARNING</code>：匹配所有以 01 开头的 SQLSTATE 错误代码；</li>
<li><code>NOT FOUND</code>：匹配所有以 02 开头的 SQLSTATE 错误代码。</li>
<li><code>SQLEXCEPTION</code>：匹配所有没有被 SQLWARNING 或 NOT FOUND 捕获的 SQLSTATE 错误代码。</li>
</ul>
</li>
<li>处理语句：如果出现上述条件之一，则采用对应的处理方式，并执行指定的处理语句。语句可以是像 <code>SET 变量 = 值</code> 这样的简单语句，也可以是使用 <code>BEGIN ... END</code> 编写的复合语句。</li>
</ul>
<p>定义处理程序的集中方式，代码如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 方法一：捕获 sqlstate_value</span><br><span class="line"><span class="keyword">DECLARE</span> CONTINUE HANDLER <span class="keyword">FOR</span> <span class="keyword">SQLSTATE</span> <span class="string">&#x27;42S02&#x27;</span> <span class="keyword">SET</span> <span class="variable">@info</span> <span class="operator">=</span> <span class="string">&#x27;NO_SUCH_TABLE&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 方法二：捕获 mysql_error_value</span><br><span class="line"><span class="keyword">DECLARE</span> CONTINUE HANDLER <span class="keyword">FOR</span> <span class="number">1146</span> <span class="keyword">SET</span> <span class="variable">@info</span> <span class="operator">=</span> NO_SUCH_TABLE;</span><br><span class="line"></span><br><span class="line"># 方法三：先定义条件，再调用</span><br><span class="line"><span class="keyword">DECLARE</span> no_such_table <span class="keyword">CONDITION</span> <span class="keyword">FOR</span> <span class="number">1146</span>;</span><br><span class="line"><span class="keyword">DECLARE</span> CONTINUE HANDLER <span class="keyword">FOR</span> NO_SUCH_TABLE <span class="keyword">SET</span> <span class="variable">@info</span> <span class="operator">=</span> <span class="string">&#x27;NO_SUCH_TABLE&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 方法四：使用 <span class="keyword">SQLWARNING</span></span><br><span class="line"><span class="keyword">DECLARE</span> EXIT HANDLER <span class="keyword">FOR</span> <span class="keyword">SQLWARNING</span> <span class="keyword">SET</span> <span class="variable">@info</span> <span class="operator">=</span> <span class="string">&#x27;ERROR&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 方法五：使用 <span class="keyword">NOT</span> FOUND</span><br><span class="line"><span class="keyword">DECLARE</span> EXIT HANDLER <span class="keyword">FOR</span> <span class="keyword">NOT</span> FOUND <span class="keyword">SET</span> <span class="variable">@info</span> <span class="operator">=</span> <span class="string">&#x27;NO_SUCH_TABLE&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 方法六：使用 <span class="keyword">SQLEXCEPTION</span></span><br><span class="line"><span class="keyword">DECLARE</span> EXIT HANDLER <span class="keyword">FOR</span> <span class="keyword">SQLEXCEPTION</span> <span class="keyword">SET</span> <span class="variable">@info</span> <span class="operator">=</span> <span class="string">&#x27;ERROR&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-流程控制"><a href="#3-流程控制" class="headerlink" title="3. 流程控制"></a>3. 流程控制</h3><p>解决复杂问题不可能通过一个 SQL 语句完成，我们需要执行多个 SQL 操作。流程控制语句的作用就是控制存储过程中 SQL 语句的执行顺序，是我们完成复杂操作必不可少的一部分。只要是执行的程序，流程就分为三大类：</p>
<ul>
<li>顺序结构：程序从上往下依次执行</li>
<li>分支结构：程序按条件进行选择执行，从两条或多条路径中选择一条执行</li>
<li>循环结构：程序满足一定条件下，重复执行一组语句</li>
</ul>
<p>针对 MySQL 的流程控制语句主要有 3 类。注意：只能用于存储程序。</p>
<ul>
<li>条件判断语句：IF 语句和 CASE 语句</li>
<li>循环语句：LOOP、WHILE 和 REPEAT 语句</li>
<li>跳转语句：ITERATE 和 LEAVE 语句</li>
</ul>
<h4 id="3-1-分支结构之-IF"><a href="#3-1-分支结构之-IF" class="headerlink" title="3.1 分支结构之 IF"></a>3.1 分支结构之 IF</h4><ul>
<li><p>IF 语句的语法结构是：</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">IF 表达式<span class="number">1</span> <span class="keyword">THEN</span> 操作<span class="number">1</span></span><br><span class="line">[ELSEIF 表达式<span class="number">2</span> <span class="keyword">THEN</span> 操作<span class="number">2</span>] ......</span><br><span class="line">[<span class="keyword">ELSE</span> 操作N]</span><br><span class="line"><span class="keyword">END</span> IF</span><br></pre></td></tr></table></figure>

<p>  根据表达式的结果为 TRUE 或 FALSE 执行相应的语句。这里 “[]” 中的内容是可选的。</p>
</li>
<li><p>特点：不同的表达式对应不同的操作；使用在 <code>BEGIN ... END</code> 中。</p>
</li>
</ul>
<h4 id="3-2-分支结构之-CASE"><a href="#3-2-分支结构之-CASE" class="headerlink" title="3.2 分支结构之 CASE"></a>3.2 分支结构之 CASE</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">CASE</span> 语句的语法结构<span class="number">1</span>：类似于 switch</span><br><span class="line"><span class="keyword">CASE</span> 表达式</span><br><span class="line"><span class="keyword">WHEN</span> 值<span class="number">1</span> <span class="keyword">THEN</span> 结果<span class="number">1</span>或语句<span class="number">1</span>(如果是语句，需要加分号)</span><br><span class="line"><span class="keyword">WHEN</span> 值<span class="number">2</span> <span class="keyword">THEN</span> 结果<span class="number">2</span>或语句<span class="number">2</span>(如果是语句，需要加分号)</span><br><span class="line">...</span><br><span class="line"><span class="keyword">ELSE</span> 结果n或语句n(如果是语句，需要加分号)</span><br><span class="line"><span class="keyword">END</span> [<span class="keyword">case</span>](如果是放在 <span class="keyword">BEGIN</span> ... <span class="keyword">END</span> 中需要加上<span class="keyword">case</span>。如果放在 <span class="keyword">SELECT</span> 后面不需要加)</span><br><span class="line"></span><br><span class="line"># <span class="keyword">CASE</span> 语句的语法结构<span class="number">2</span>：类似于多重 if</span><br><span class="line"><span class="keyword">CASE</span></span><br><span class="line"><span class="keyword">WHEN</span> 值<span class="number">1</span> <span class="keyword">THEN</span> 结果<span class="number">1</span>或语句<span class="number">1</span>(如果是语句，需要加分号)</span><br><span class="line"><span class="keyword">WHEN</span> 值<span class="number">2</span> <span class="keyword">THEN</span> 结果<span class="number">2</span>或语句<span class="number">2</span>(如果是语句，需要加分号)</span><br><span class="line">...</span><br><span class="line"><span class="keyword">ELSE</span> 结果n或语句n(如果是语句，需要加分号)</span><br><span class="line"><span class="keyword">END</span> [<span class="keyword">case</span>](如果是放在 <span class="keyword">BEGIN</span> ... <span class="keyword">END</span> 中需要加上<span class="keyword">case</span>。如果放在 <span class="keyword">SELECT</span> 后面不需要加)</span><br></pre></td></tr></table></figure>

<h4 id="3-3-循环结构值-LOOP"><a href="#3-3-循环结构值-LOOP" class="headerlink" title="3.3 循环结构值 LOOP"></a>3.3 循环结构值 LOOP</h4><p>LOOP 循环语句用来重复执行某些语句。LOOP 内的语句移植重复执行知道循环被退出 (使用 LEAVE 子句)，跳出循环过程。</p>
<p>LOOP 语句的基本格式如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[loop_label:] LOOP</span><br><span class="line">	循环执行的语句</span><br><span class="line"><span class="keyword">END</span> LOOP [loop_label]</span><br></pre></td></tr></table></figure>

<p>其中，loop_label 表示 LOOP 语句的标注名称，该参数可以省略。</p>
<h4 id="3-4-循环结构之-WHILE"><a href="#3-4-循环结构之-WHILE" class="headerlink" title="3.4 循环结构之 WHILE"></a>3.4 循环结构之 WHILE</h4><p>WHILE 语句创建一个带条件判断的循环过程。WHILE 在执行语句执行时，先对指定的表达式进行判断，如果为真，就执行循环内的语句，否则退出循环。WHILE 语句的基本格式如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[while_label:] WHILE 循环条件 DO</span><br><span class="line">	循环体</span><br><span class="line">	<span class="keyword">END</span> WHILE [while_label]</span><br></pre></td></tr></table></figure>

<p>while_label 为 WHILE 语句的标注名称；如果循环条件结果为真，WHILE 语句内的语句或语句群被执行，直至循环条件为假，退出循环。</p>
<h4 id="3-5-循环结构之-REPEAT"><a href="#3-5-循环结构之-REPEAT" class="headerlink" title="3.5 循环结构之 REPEAT"></a>3.5 循环结构之 REPEAT</h4><p>REPEAT 语句创建一个带条件判断的循环过程。与 WHILE 循环不同的是，REPEAT 循环首先会执行一次循环，然后再 UNTIL 中进行表达式的判断，如果满足条件就退出，即 END REPEAT；如果条件不满足，则会就继续执行循环，直到满足退出条件为止。</p>
<p>REPEAT 语句的基本格式如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[repeat_label:] REPEAT</span><br><span class="line">	循环体的语句</span><br><span class="line">UNTIL 结束循环的条件表达式</span><br><span class="line"><span class="keyword">END</span> REPEAT [repeat_label]</span><br></pre></td></tr></table></figure>

<p>repeat_label 为 REPEAT 语句的标注名称，该参数可以省略；REPEAT 语句内的语句或语句群被重复，直至 expr_confition 为真。</p>
<p><strong>对比三种循环结构</strong>：</p>
<ul>
<li>这三种循环都可以省略名称，但如果循环中添加了循环控制语句 (LEAVE 或 ITERATE) 则必须添加名称</li>
<li>LOOP：一般用于实现简单的“死”循环</li>
<li>WHILE：先判断后执行</li>
<li>REPEAT：先执行后判断，无条件执行至少一次</li>
</ul>
<h4 id="3-6-跳转语句之-LEAVE-语句"><a href="#3-6-跳转语句之-LEAVE-语句" class="headerlink" title="3.6 跳转语句之 LEAVE 语句"></a>3.6 跳转语句之 LEAVE 语句</h4><p>LEAVE 语句：可以用在循环语句内，或者以 BEGIN 和 END 包裹起来的程序体内，表示跳出循环或者跳出程序体的操作。相当于 Java 中的 break。</p>
<p>基本格式如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LEAVE 标记名</span><br></pre></td></tr></table></figure>

<p>其中，label 参数表示循环的标志。LEAVE 和 BEGIN … END 或循环一起被使用。</p>
<h4 id="3-7-跳转语句之-ITERATE-语句"><a href="#3-7-跳转语句之-ITERATE-语句" class="headerlink" title="3.7 跳转语句之 ITERATE 语句"></a>3.7 跳转语句之 ITERATE 语句</h4><p>ITERATE 语句：只能用在循环语句 (LOOP、REPEAT 和 WHILE 语句)内，表示重新开始循环，将执行顺序转到语句段开头处。相当于 Java 中的 continue。</p>
<p>语句基本格式如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ITERATE label</span><br></pre></td></tr></table></figure>

<p>Label 参数表示循环的标志。ITERATE 语句必须跟在循环标志前面。</p>
<h3 id="4-游标"><a href="#4-游标" class="headerlink" title="4. 游标"></a>4. 游标</h3><h4 id="4-1-什么是游标-或光标"><a href="#4-1-什么是游标-或光标" class="headerlink" title="4.1 什么是游标 (或光标)"></a>4.1 什么是游标 (或光标)</h4><p>虽然我们可以通过筛选条件 WHERE 和 HAVING，或者是限定返回记录的关键字 LIMIT 返回一条记录，但是，却无法在结果集中像指针一样，向前定位一条记录、向后定位一条记录，或者是随意定位到某一条记录，并对记录的数据进行处理。</p>
<p>这个时候，就可以用到游标。游标，提供了一种灵活的操作方式，让我们能够对结果集中的每一条记录进行定位，并对指向的记录中的数据进行操作的数据结构。游标让 SQL 这种面向集合的语言有了相面过程开发的能力。</p>
<p>在 SQL 中，游标是一种临时的数据库对象，可以指向存储在数据库表中的数据行指针。这里游标充当了指针的作用，可以通过操作游标来对数据行进行操作。MySQL 中游标可以在存储过程和函数中使用。</p>
<h4 id="4-2-使用游标的步骤"><a href="#4-2-使用游标的步骤" class="headerlink" title="4.2 使用游标的步骤"></a>4.2 使用游标的步骤</h4><p>游标必须在声明处理程序之前被声明，并且变量和条件还必须在声明游标或处理程序之前被声明。</p>
<p>如果想要使用游标，一般需要经历四个步骤。不同的 DBMS 中，使用游标的语法可能略有不同。</p>
<ul>
<li><p>第一步，声明游标</p>
<p>  在 MySQL 中，使用 DECLARE 关键字来声明游标，其语法的基本形式如下：</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> cursor_name <span class="keyword">CURSOR</span> <span class="keyword">FOR</span> select_statement;</span><br></pre></td></tr></table></figure>

<p>  这个语法适用于 MySQL、SQL Server、DB2 和 MariaDB。如果是用 Oracle 或者 PostgreSQL，需要写成：</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> cursor_name <span class="keyword">CURSOR</span> <span class="keyword">IS</span> select_statement;</span><br></pre></td></tr></table></figure>

<p>  要使用 SELECT 语句来获取数据结果集，而此时还没有开始遍历数据，这里 select_statement 代替的是 SELECT 语句，返回一个用于创建游标的结果集。</p>
</li>
<li><p>第二步，打开游标</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">OPEN</span> cursor_name</span><br></pre></td></tr></table></figure>

<p>  当定义好游标之后，如果想要使用游标，必须先打开游标。打开游标的时候 SELECT 语句的查询结果集就会送到游标工作区，为后面游标的逐条读取结果集中的记录作准备。</p>
</li>
<li><p>第三步，使用游标 (从游标中取得数据)</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FETCH</span> cursor_name <span class="keyword">INTO</span> var_name [, var_name] ...</span><br></pre></td></tr></table></figure>

<p>  这句的作用是使用 cursor_name 这个游标来读取当前行，并且将数据保存到 var_name 这个变量中，游标指针指到下一行。如果游标读取的数据行有多个列名，则在 INTO 关键字后面赋值给多个变量名即可。</p>
<p>  注意：var_name 必须在声明游标之前就定义好。<strong>游标的查询结果集中的字段数，必须跟 INTO 后面的变量数一致</strong>，否则，在存储过程执行的时候，MySQL 会提示错误。</p>
</li>
<li><p>第四步，关闭游标</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CLOSE</span> cursor_name</span><br></pre></td></tr></table></figure>

<p>  有 OPEN 就会有 CLOSE，也就是打开和关闭游标。当我们使用完游标后需要关闭掉该游标。因为游标会占用系统资源，如果不及时关闭，<strong>游标会一直保持到存储过程结束</strong>，影响系统运行的效率。而关闭游标的操作，会释放游标占用的系统资源。</p>
<p>  关闭游标之后，我们就不能再检索查询结果中的数据行，如果需要检索只能再次打开游标。</p>
</li>
</ul>
<h4 id="4-3-小结"><a href="#4-3-小结" class="headerlink" title="4.3 小结"></a>4.3 小结</h4><p>游标是 MySQL 的一个重要的功能，为逐条读取结果集中的数据，提供了完美的解决方案。跟在应用层实现相同的功能相比，游标可以在存储程序中使用，效率高，程序要更加简洁。</p>
<p>但同时也会带来一些性能问题，比如在使用游标的过程中，会对数据行进行加锁，这样在业务并发量大的时候，不仅会影响业务之间的效率，还会消耗系统资源，造成内存不足，这是因为游标是在内存中进行的处理。</p>
<p>建议：养成用完之后就关闭的习惯，这样才能提高系统的整体效率。</p>
<h3 id="5-MySQL-8-0-的新特性——全局变量的持久化"><a href="#5-MySQL-8-0-的新特性——全局变量的持久化" class="headerlink" title="5. MySQL 8.0 的新特性——全局变量的持久化"></a>5. MySQL 8.0 的新特性——全局变量的持久化</h3><p>在 MySQL 数据库中，全局变量可以通过 <code>SET GLOBAL</code> 语句来设置。例如，设置服务器语句超时的限制，可以通过设置系统变量 max_execution_time 来实现：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> MAX_EXECUTION_TIME <span class="operator">=</span> <span class="number">2000</span>;</span><br></pre></td></tr></table></figure>

<p>使用 <code>SET GLOBAL</code> 语句设置的变量值只会临时生效。数据库重启后，服务器又会从 MySQL 配置文件中读取变量的默认值。</p>
<p>MySQL 8.0 版本增加了 <code>SET PERSIST</code> 命令。例如，设置服务器的最大连接数为 1000：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> PERSIST max_connections <span class="operator">=</span> <span class="number">1000</span>;</span><br></pre></td></tr></table></figure>

<p>MySQL 会讲该命令的配置保存到数据目录下的mysqld-auto.cnf 文件中，下次启动时会读取该文件，用其中的配置来覆盖默认的配置文件。</p>
<h2 id="十六、触发器"><a href="#十六、触发器" class="headerlink" title="十六、触发器"></a>十六、触发器</h2><p>在实际开发中，我们将常会遇到这样的情况：有 2 个或者多个相互关联的表，如商品信息和库存信息分别存放在 2 个不同的数据表中，我们在添加一条新商品记录的时候，为了保证数据的完整性，必须同时在库存表中添加一条库存记录。</p>
<p>这样一来，我们就必须把这两个关联的操作步骤写到程序里面，而且要用事物包裹起来，确保这两个操作成为一个院子操作，要么全部执行，要么全部不执行。要是遇到特殊的情况，可能还需要对数据进行手动维护，这样就很容易忘记其中的一步，导致数据缺失。</p>
<p>这个时候，咱们就可以使用触发器。你可以创建一个触发器，让商品信息数据的插入操作自动触发库存数据的插入操作。这样一来，即不同担心忘记添加库存数据二导致的数据缺失了。</p>
<h3 id="1-触发器的概述"><a href="#1-触发器的概述" class="headerlink" title="1. 触发器的概述"></a>1. 触发器的概述</h3><p>MySQL 从 5.0.2 版本开始支持触发器。MySQL 的触发器和存储过程一样，都是嵌入到 MySQL 服务器的一段程序。触发器是由时间来出发某个操作，这些事件包括 INSERT、UPDATE、DELETE 事件。所谓事件就是指用户的动作或者出发某项行为。如果定义了出发程序，当数据库执行这些语句时候，就相当于事件发生了，就会自动激发触发器执行相应的操作。</p>
<p>当对数据表中的数据执行插入、更新和删除操作，需要自动执行一些数据库逻辑时，可以使用触发器来实现。</p>
<h3 id="2-触发器的创建"><a href="#2-触发器的创建" class="headerlink" title="2. 触发器的创建"></a>2. 触发器的创建</h3><h4 id="2-1-创建触发器语法"><a href="#2-1-创建触发器语法" class="headerlink" title="2.1 创建触发器语法"></a>2.1 创建触发器语法</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> 触发器名称</span><br><span class="line">&#123;BEFORE <span class="operator">|</span> AFTER&#125; &#123;<span class="keyword">INSERT</span><span class="operator">|</span><span class="keyword">UPDATE</span><span class="operator">|</span><span class="keyword">DELETE</span>&#125; <span class="keyword">ON</span> 表名</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line">触发器执的语句快;  </span><br></pre></td></tr></table></figure>

<ul>
<li>表名：表示触发器监控的对象</li>
<li><code>BEFORE|AFTER</code>：表示触发的时间。BEFORE 表示在事件之前触发；AFTER 表示在事件之后触发。</li>
<li><code>INSERT|UPDATE|DELETE</code>：表示出发的事件。<ul>
<li>INSERT 表示插入记录时触发；</li>
<li>UPDATE 表示更新记录时触发；</li>
<li>DELETE 表示删除记录时触发。</li>
</ul>
</li>
<li><code>触发器执行的语句块</code>：可以是单条 SQL 语句，也可以是由 <code>BEGIN ... END</code> 结构组成的复合语句块。</li>
</ul>
<h3 id="3-查看、删除触发器"><a href="#3-查看、删除触发器" class="headerlink" title="3. 查看、删除触发器"></a>3. 查看、删除触发器</h3><h4 id="3-1-查看触发器"><a href="#3-1-查看触发器" class="headerlink" title="3.1 查看触发器"></a>3.1 查看触发器</h4><p>查看触发器是查看数据库中已经存在的触发器的定义、状态和语法信息等。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 方式一：查看当前数据库的所有触发器的定义</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TRIGGER</span> \G</span><br><span class="line"></span><br><span class="line"># 方式二：查看当前数据库中某个触发器的定义</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> 触发器名;</span><br><span class="line"></span><br><span class="line"># 方式三：从系统库 information_schema 的 TRIGGERS 表中查询 “salary_check_trigger” 触发器的信息。</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.TRIGGERS;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-删除触发器"><a href="#3-2-删除触发器" class="headerlink" title="3.2 删除触发器"></a>3.2 删除触发器</h4><p>触发器也是数据库对象，删除触发器也用 DROP 语句，语法格式如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> IF <span class="keyword">EXISTS</span> 触发器名称;</span><br></pre></td></tr></table></figure>

<h3 id="4-触发器的优缺点"><a href="#4-触发器的优缺点" class="headerlink" title="4. 触发器的优缺点"></a>4. 触发器的优缺点</h3><h4 id="4-1-优点"><a href="#4-1-优点" class="headerlink" title="4.1 优点"></a>4.1 优点</h4><ul>
<li>触发器可以确保数据的完整性。</li>
<li>触发器可以帮助我们记录操作日志。</li>
<li>触发器还可以用在操作数据钱，对数据进行合法性检查。</li>
</ul>
<h4 id="4-2-缺点"><a href="#4-2-缺点" class="headerlink" title="4.2 缺点"></a>4.2 缺点</h4><ul>
<li>触发器最大的一个问题就是可读性差。</li>
<li>相关数据的变更，可能会导致触发器出错。</li>
</ul>
<h4 id="4-3-注意点"><a href="#4-3-注意点" class="headerlink" title="4.3 注意点"></a>4.3 注意点</h4><p>注意：如果在子表中定义了外键约束，并且外键制定了 <code>ON UPDATE/DELETE CASCADE/SET NULL</code> 子句，此时修改父表被引用的键值或删除父表被引用的记录时，也会引起子表的修改和删除操作，此时基于子表的 UPDATE 和 DELETE 语句定义的触发器并不会被激活。</p>
<h2 id="十七、MySQL-8-其它新特性"><a href="#十七、MySQL-8-其它新特性" class="headerlink" title="十七、MySQL 8 其它新特性"></a>十七、MySQL 8 其它新特性</h2><h3 id="1-MySQL-8-新特性概述"><a href="#1-MySQL-8-新特性概述" class="headerlink" title="1. MySQL 8 新特性概述"></a>1. MySQL 8 新特性概述</h3><p><code>MySQL 从 5.7 版本直接跳跃发布了 8.0 版本</code>，可见这是一个令人兴奋的里程碑版本。MySQL 8 版本在功能上做了显著的改进与增强，开发者对 MySQL 的源代码进行了重构，最突出的一点是多 MySQL Optimizer 优化器进行了改进。不仅在速度上得到了改善，还为用户带来了更好的性能和更棒的体验。</p>
<h4 id="1-1-MySQ-L-8-0-新增特性"><a href="#1-1-MySQ-L-8-0-新增特性" class="headerlink" title="1.1 MySQ L 8.0 新增特性"></a>1.1 MySQ L 8.0 新增特性</h4><ul>
<li><p>更简便的 NoSQL 支持</p>
<p>  NoSQL 泛指非关系型数据库和数据存储。随着互联网平台的规模飞速发展，传统的关系型数据库已经越来越不能满足需求。从 5.6 版本开始，MySQL 就开始支持简单的 NoSQL 存储功能。MySQL 8 对这一功能做了优化，以更灵活的方式实现 NoSQL 功能，不再依赖模式 (schema)。</p>
</li>
<li><p>更好的索引</p>
<p>  在查询中，正确地使用索引可以提高查询的效率。MySQL 8 中新增了隐藏索引和降序索引。隐藏索引可以用来测试去掉索引对查询性能的影响。在查询中混合存在多列索引时，使用降序索引可以提高查询的性能。</p>
</li>
<li><p>更完善的 JSON 支持</p>
<p>  MySQL 从 5.7 开始支持原生 JSON 数据的存储，MySQL 8 对这一功能做了优化，增加了聚合函数 <code>JSON_ARRAYAGG()</code> 和 <code>JSON_OBJECTAGG()</code>，将参数聚合为 JSON 数组或对象，新增了行内操作符 -&gt;&gt;，是列路径运算符 -&gt; 的增强，对 JSON 排序做了提升，并优化了 JSON 的更新操作。</p>
</li>
<li><p>安全和账户管理</p>
<p>  MySQL 8 中新增了 <code>caching_sha2_password</code> 授权插件、角色、密码历史记录和 FIPS 模式支持，这些特性提高了数据库的安全性和性能，使数据库管理员能够灵活地进行账户管理工作。</p>
</li>
<li><p>InnoDB 的变化</p>
<p>  <code>InnoDB 是 MySQL 默认的存储引擎</code>，是事物型数据库的首选引擎，支持事物安全表 (ACID)，支持行锁定和外键。在 MySQL 8 版本中，InnoDB 在自增、索引、加密、死锁、共享锁等方面做了大量的改进和优化，并且支持原子数据定义语言 (DDL)，提高了数据安全性，对事物提供更好的支持。</p>
</li>
<li><p>数据字典</p>
<p>  在之前的 MySQL 版本中，字典数据都存储在原数据文件和非事物表中。从 MySQL 8 开始新增了事物数据字典，在这个字典里存储着数据库对象信息，这些数据字典存储在内部事务表中。</p>
</li>
<li><p>原子数据定义语句</p>
<p>  MySQL 8 开始支持原子数据定义语句 (Automic DDL)，即 原子 DDL。目前，只有 InnoDB 存储引擎支持原子 DDL。原子数据定义语句 (DDL) 将与 DDL 操作相关的数据字典更新、存储引擎操作、二进制日志写入结合到一个单独的原子事物中，这是的即使服务器崩溃，事物也会提交或回滚。</p>
<p>  使用支持原子操作的存储引擎所创建的表，在执行 <code>DROP TABLE</code>、<code>CREATE TABLE</code>、<code>ALTER TABLE</code>、<code>RENAME TABLE</code>、<code>TRUNCATE TABLE</code>、 <code>CREATE TABLESPACE</code>、<code>DROP TABLESPACE</code> 等操作时，都支持原子操作，即事物要么完全操作成功，要么失败后回滚，不再进行部分提交。</p>
<p>  对于 MySQL 5.7 复制到 MySQL 8 版本中的语句，可以添加 <code>IF EXITST</code> 或 <code>IF NOT EXITST</code> 语句来避免发生错误。</p>
</li>
<li><p>资源管理</p>
<p>  MySQL 8 开始支持创建和管理资源组，允许将服务器内运行的线程分配给特定的分组，以便线程根据组内可用资源执行。组属性能够控制组内资源，启用或限制组内资源消耗。数据库管理员能够根据不同的工作负载适当地更改这些属性。</p>
<p>  目前，CPU 时间是可控资源，由“虚拟 CPU” 这个概念来表示，此术语包含 CPU 的核心数，超线程，硬件线程等等。服务器在启动时确定可用的虚拟 CPU 数量。拥有对应权限的数据库管理员可以将这些 CPU 与资源组关联，并为资源组分配线程。</p>
<p>  资源组组件为 MySQL 中的资源组管理提供了 SQL 接口。资源组的属性用于定义资源组。MySQL 中存在两个默认组， 系统组和用户组，默认的组不能被删除，其属性也不能被更改。对于用户自定义的组，资源组创建时可初始化所有的属性，除去名字和类型，其他属性都可在创建之后进行更改。</p>
<p>  在一些平台下，或进行了某些 MySQL 的配置时，资源管理的功能将受到限制，甚至不可用。例如，如果安装了线程池插件，或者使用的是 macOS 系统，资源管理将处于不可用状态。在 FreeBSD 和 Solaris 系统中，资源线程优先级将失效。在 Linux 系统中，只有配置了 CAP_SYS_NICE 属性，资源管理优先级才能发挥作用。</p>
</li>
<li><p>字符集支持</p>
<p>  MySQL 8 中默认的字符集由 latin1 更改为 utf8mb4，并首次增加了日语所特定使用的集合，<code>utf8mb4_ja_0900_as_cs</code>。</p>
</li>
<li><p>优化器增强</p>
<p>  MySQL 优化器开始支持隐藏索引和降序索引。隐藏索引不会被优化器使用，验证索引的必要性时不需要删除索引，先将索引隐藏，如果优化器性能无影响就可以真正地删除索引。降序索引允许优化器对多个列进行排序，并且允许排序顺序不一致。</p>
</li>
<li><p>公用表表达式</p>
<p>  公用表表达式 (Common Table Expressions) 简称 CTE，MySQL 现在支持递归和非递归两种形式的 CTE。CTE 通过在 SELECT 语句或其他特定语句前使用 WITH 语句对临时结果集进行命名。</p>
<p>  基础语法如下：</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> cte_name (col_name1, col_name2 ...) <span class="keyword">AS</span> (Subquery)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> cte_name;</span><br></pre></td></tr></table></figure>

<p>  Subquery 代表子查询，子查询前使用 WITH 语句将结果集命名为 cte_name，在后续的查询中即可使用 cte_name 进行查询。</p>
</li>
<li><p>窗口函数</p>
<p>  MySQL 8 开始支持窗口函数。在之前的版本中已存在的大部分聚合函数在 MySQL 8 中也可以作为窗口函数来使用。</p>
<table>
<thead>
<tr>
<th>函数名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>CUME_DIST()</td>
<td>累计的分布值</td>
</tr>
<tr>
<td>DENSE_RANK()</td>
<td>对当前记录不间断排序</td>
</tr>
<tr>
<td>FIRST_VALUE()</td>
<td>返回窗口首行记录的对应字段值</td>
</tr>
<tr>
<td>LAG()</td>
<td>返回对应字段的前 N 行记录</td>
</tr>
<tr>
<td>LAST_VALUE()</td>
<td>返回窗口尾行记录的对应字段值</td>
</tr>
<tr>
<td>LEAD()</td>
<td>返回对应字段的后 N 行记录</td>
</tr>
<tr>
<td>NTH_VALUE()</td>
<td>返回第 N 条记录对应的字段值</td>
</tr>
<tr>
<td>NTILE()</td>
<td>将区划分为 N 组，并返回组的数量</td>
</tr>
<tr>
<td>PERCENT_RANK()</td>
<td>返回 0 到 1 之间的小数，表示某个字段值在数据分区中的排名</td>
</tr>
<tr>
<td>RANK()</td>
<td>返回分区内每条记录对应的排名</td>
</tr>
<tr>
<td>ROW_NUMBER()</td>
<td>返回每一条记录对应的序号，且不重复</td>
</tr>
</tbody></table>
</li>
<li><p>正则表达式支持</p>
<p>  MySQL 在 8.0.4 以后的版本中采用支持 Unicode 的国际化组件库实现正则表达式操作，这种方式不仅能提供完全的 Unicode 支持，而且是多字节安全编码。MySQL 增加了 <code>REGEXP_LIKE()</code>、<code>EGEXP_INSTR()</code>、<code>REGEXP_REPLACE()</code> 和 <code>REGEXP_SUBSTR()</code> 等函数来提升性能。另外，regexp_stack_limit 和 regexp_time_limit 系统变量能够通过匹配引擎来控制资源消耗。</p>
</li>
<li><p>内部临时表</p>
<p>  <strong>TempTable 存储引擎取代 MEMORY 存储引擎成为内部临时表的默认存储引擎</strong>。TempTable 存储引擎为 VARCHAR 和 VARBINARY  列提供高效存储。internal_tmp_mem_storage_engine 会话变量定义了内部临时表的存储引擎，可选的值有两个，TempTable 和  MEMORY，其中 TempTable 为默认的存储引擎。temptable_max_ram 系统配置项定义了 TempTable 存储引擎可使用的最大内存数量。</p>
</li>
<li><p>日志记录</p>
<p>  在MySQL 8 中错误日志子系统由一系列 MySQL 组件构成。这些组件的构成由系统变量 log_error_services 来配置，能够实现日志事件的过滤和写入。</p>
</li>
<li><p>备份锁</p>
<p>  新的备份锁允许在线备份期间执行数据操作语句，同时阻止可能造成快照不一致的操作。新备份锁由 LOCK INSTANCE FOR BACKUP 和 UNLOCK INSTANCE 语法提供支持，执行这些操作需要备份管理员特权。</p>
</li>
<li><p>增强的 MySQL 复制</p>
<p>  MySQL 8 复制支持对 JSON 文档进行部分更新的二进制日志记录，该记录使用紧凑的二进制格式，从而节省记录完整 JSON 文档的空间。当使用基于语句的日志记录时，这种紧凑的日志记录会自动完成，并且可以通过将新的 binlog_row_value_options 系统变量值设置为 PARTIAL_JSON 来启用。</p>
</li>
</ul>
<h4 id="1-2-MySQL-8-0-移除的旧特性"><a href="#1-2-MySQL-8-0-移除的旧特性" class="headerlink" title="1.2 MySQL 8.0 移除的旧特性"></a>1.2 MySQL 8.0 移除的旧特性</h4><p>在 MySQL 5.7 版本上开发的应用程序如果使用了 MySLQ 8.0 移除的特性，语句可能会失败，或者产生不同的执行结果。为了避免这些问题，对于使用了移除特性的应用，应当尽力修正避免使用这些特性，并尽可能使用替代方法。</p>
<ul>
<li><p>查询缓存</p>
<p>  查询缓存已被移除，删除的项有：</p>
<ul>
<li>语句：<code>FLUSH QUERY CACHE</code> 和 <code>RESET QUERY CACHE</code>。</li>
<li>系统变量：<code>query_cache_limit</code>、<code>query_cache_min_res_unit</code>、<code>query_cache_size</code>、<code>query_cache_type</code>、<code>query_cache_wlock_invalidate</code>。</li>
<li>状态变量：<code>Cache_free_blocks</code>、<code>Cache_free_memory</code>、<code>Cache_hits</code>、<code>Cache_inserts</code>、<code>Cache_lowmen_prunes</code>、<code>Cache_not_cached</code>、<code>Cache_queries_in_cache</code>、<code>Qcache_total_blocks</code>。</li>
<li>线程状态：<code>checking privileges on cached query</code>、<code>checking query cache for query</code>、<code>invalidating query cache entries</code>、<code>sending cached result to client</code>、<code>storing result in query cache</code>、<code>waiting for query cache lock</code>。</li>
</ul>
</li>
<li><p>加密相关</p>
<p>  删除的加密相关的内容有：ENCODE()、DECODE()、ENCRYPT()、DES_ENCRYPT() 和 DES_DECRYPT() 函数，配置项 des-key-file，系统变量 have_crypt，FLUSH 语句的 DES_KEY_FILE 选项，HAVE_CRYPT CMake 选项。</p>
<p>  对于移除的 ENCRYPT() 函数，考虑使用 SHA2() 替代，对于其他移除的函数，使用 AES_ENCRYPT() 和 AES_DECRYPT() 替代。</p>
</li>
<li><p>空间函数相关</p>
<p>  在 MySQL 5.7 版本中，多个空间函数已被标记为过时。这些过时的函数在 MySQL 8 中都已被移除，只保留了对应的 ST_ 和 MBR 函数。</p>
</li>
<li><p>\N 和 NULL</p>
<p>  在 SQL 语句中，解析器不再将 \N 视为 NULL，所以在 SQL 语句中应使用 NULL 代替 \N。这项变化不会影响使用 <code>LOAD DATA INFILE</code> 或者 <code>SELECT ... INTO OUTFILE</code> 操作文件的导入和导出。在这类操作中，NULL 仍等同于 \N。</p>
</li>
<li><p>mysql_install_db</p>
<p>  在 MySQL 分布中，已移除了 mysql_install_db 程序，数据字典初始化需要调用带着 –initialize 或者 –initialize-insecure 选项的 mysqld 来代替实现。另外，–bootstrap 和 INSTALL_SCRIPTDIR CMake 也已被删除。</p>
</li>
<li><p>通用分区处理程序</p>
<p>  通用分区处理程序已从 MySQL 服务中被移除。为了实现给定表分区，表所使用的存储引擎需要自有的分区处理程序。</p>
<p>  提供本地分区支持的 MySQL 存储引擎有两个，即 InnoDB 和 NDB，而在 MySQL 8 中 只支持 InnoDB。</p>
</li>
<li><p>系统和状态变量信息</p>
<p>  在 INFORMATION_SCHEMA 数据库中国呢，对系统和状态变量信息不再进行维护。GLOBAL_VARIABLES、SESSION_VARIABLES、GLOBAL_STATUS、SESSION_STATUS 表都已被删除。另外，系统变量 show_compatibility_56 也已被删除。被删除的状态变量有 Slave_heartbeat_period、slave_last_heartbeat、Slave_received_heartbeats、Slave_retried_transactions、Slave_running。以上被删除的内容都可使用性能模式中对应的内容进行替代。</p>
</li>
<li><p>mysql_plugin 工具</p>
<p>  mysql_plugin 工具用来配置 MySQL 服务器插件，现已被删除，可使用 –plugin-load 或 –plugin-load-add 选项在服务器启动时加载插件或者在运行时使用 INSTALL PLUGIN 语句加载插件来替代该工具。</p>
</li>
</ul>
<h3 id="2-窗口函数"><a href="#2-窗口函数" class="headerlink" title="2. 窗口函数"></a>2. 窗口函数</h3><h4 id="2-1-窗口函数分类"><a href="#2-1-窗口函数分类" class="headerlink" title="2.1 窗口函数分类"></a>2.1 窗口函数分类</h4><p>MySQL 从 8.0 版本开始支持窗口函数。窗口函数的作用类似于在查询中对数据进行分组，不同的是，分组操作会把分组的结果集合成一条记录，而窗口函数是将结果置于每一条数据记录中。</p>
<p>窗口函数可以分为静态窗口函数和动态窗口函数。</p>
<ul>
<li>静态窗口函数的窗口大小是固定的，不会因为记录的不同而不同；</li>
<li>动态窗口函数的窗口大小会随着记录的不同而变化。</li>
</ul>
<p>窗口函数总体上可以分为序号函数、分布函数、前后函数、首尾函数和其它函数。</p>
<table>
<thead>
<tr>
<th>函数分类</th>
<th>函数</th>
<th>函数说明</th>
</tr>
</thead>
<tbody><tr>
<td>序号函数</td>
<td>ROW_NUMBER()<br />RANK()<br />DENSE_RANK()</td>
<td>顺序排序<br />并列排序，会跳过重复的序号，比如序号为1、1、3<br />并列排序，不会跳过重复的序号，比如序号为1、1、2</td>
</tr>
<tr>
<td>分布函数</td>
<td>PERCENT_RANK()<br />CUME_DIST()</td>
<td>等级值百分比<br />累积分布值</td>
</tr>
<tr>
<td>前后函数</td>
<td>LAG(expr, n)<br />LEAD(expr, n)</td>
<td>返回当前行的前 n 行的 expr 值<br />返回当前行的后 n 行的 expr 值</td>
</tr>
<tr>
<td>首尾函数</td>
<td>FIRST_VALUE(expr)<br />LAST_VALUE(expr, n)</td>
<td>返回第一个 expr 值<br />返回最后一个 expr 值</td>
</tr>
<tr>
<td>其它函数</td>
<td>NTH_VALUE(expr, n)<br />NTILE(n)</td>
<td>返回第 n 个 expr 值<br />将分区中的有序数据分为 n 个桶，记录桶编号</td>
</tr>
</tbody></table>
<h4 id="2-2-语法结构"><a href="#2-2-语法结构" class="headerlink" title="2.2 语法结构"></a>2.2 语法结构</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">函数 <span class="keyword">OVER</span> ([<span class="keyword">PARTITION</span> <span class="keyword">BY</span> 字段名 <span class="keyword">ORDER</span> <span class="keyword">BY</span> 字段名 <span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>])</span><br><span class="line">或</span><br><span class="line">函数 <span class="keyword">OVER</span> 窗口名 _ <span class="keyword">WINDOW</span> 窗口名 <span class="keyword">AS</span> ([<span class="keyword">PARTITION</span> <span class="keyword">BY</span> 字段名 <span class="keyword">ORDER</span> <span class="keyword">BY</span> 字段名 <span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>])</span><br></pre></td></tr></table></figure>

<ul>
<li>OVER 关键字指定函数窗口的范围。<ul>
<li>如果省略后面括号中的内容，则窗口会包含满足 WHERE 条件的所有记录，窗口函数会基于所有满足 WHERE 条件的记录进行计算。</li>
<li>如果 OVER 关键字后面的括号不为空，则可以使用如下语法设置窗口。</li>
</ul>
</li>
<li>窗口名：为窗口设置一个别名，用来标识窗口。</li>
<li>PARTITION BY 子句：指定窗口函数按照哪些字段就行分组。分组后，窗口函数可以在每个分组中分别执行。</li>
<li>ORDER BY 子句：指定窗口函数按照哪些字段进行排序。执行排序操作使窗口函数按照排序后的数据记录的顺序进行编号。</li>
<li>FRAME 子句：为分区中的某个子集定义规则，可以用来作为滑动窗口使用。</li>
</ul>
<h4 id="2-3-分类讲解"><a href="#2-3-分类讲解" class="headerlink" title="2.3 分类讲解"></a>2.3 分类讲解</h4><p>例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># 创建表</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> goods(</span><br><span class="line">id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">category_id <span class="type">INT</span>,</span><br><span class="line">category <span class="type">VARCHAR</span>(<span class="number">15</span>),</span><br><span class="line">NAME <span class="type">VARCHAR</span>(<span class="number">30</span>),</span><br><span class="line">price <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>),</span><br><span class="line">stock <span class="type">INT</span>,</span><br><span class="line">upper_time DATETIME</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 添加数据</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> goods(category_id, category, NAME, price, stock, upper_time)</span><br><span class="line"><span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;女装/女士精品&#x27;</span>, <span class="string">&#x27;T恤&#x27;</span>, <span class="number">39.90</span>, <span class="number">1000</span>, <span class="string">&#x27;2020-11-10 00:00:00&#x27;</span>),</span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;女装/女士精品&#x27;</span>, <span class="string">&#x27;连衣裙&#x27;</span>, <span class="number">79.90</span>, <span class="number">2500</span>, <span class="string">&#x27;2020-11-10 00:00:00&#x27;</span>),</span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;女装/女士精品&#x27;</span>, <span class="string">&#x27;卫衣&#x27;</span>, <span class="number">89.90</span>, <span class="number">1500</span>, <span class="string">&#x27;2020-11-10 00:00:00&#x27;</span>),</span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;女装/女士精品&#x27;</span>, <span class="string">&#x27;牛仔裤&#x27;</span>, <span class="number">89.90</span>, <span class="number">3500</span>, <span class="string">&#x27;2020-11-10 00:00:00&#x27;</span>),</span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;女装/女士精品&#x27;</span>, <span class="string">&#x27;百褶裙&#x27;</span>, <span class="number">29.90</span>, <span class="number">500</span>, <span class="string">&#x27;2020-11-10 00:00:00&#x27;</span>),</span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;女装/女士精品&#x27;</span>, <span class="string">&#x27;呢绒外套&#x27;</span>, <span class="number">399.90</span>, <span class="number">1200</span>, <span class="string">&#x27;2020-11-10 00:00:00&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;户外运动&#x27;</span>, <span class="string">&#x27;自行车&#x27;</span>, <span class="number">399.90</span>, <span class="number">1000</span>, <span class="string">&#x27;2020-11-10 00:00:00&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;户外运动&#x27;</span>, <span class="string">&#x27;山地自行车&#x27;</span>, <span class="number">1399.90</span>, <span class="number">2500</span>, <span class="string">&#x27;2020-11-10 00:00:00&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;户外运动&#x27;</span>, <span class="string">&#x27;登山杖&#x27;</span>, <span class="number">59.90</span>, <span class="number">1500</span>, <span class="string">&#x27;2020-11-10 00:00:00&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;户外运动&#x27;</span>, <span class="string">&#x27;骑行装备&#x27;</span>, <span class="number">399.90</span>, <span class="number">3500</span>, <span class="string">&#x27;2020-11-10 00:00:00&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;户外运动&#x27;</span>, <span class="string">&#x27;运动外套&#x27;</span>, <span class="number">799.90</span>, <span class="number">500</span>, <span class="string">&#x27;2020-11-10 00:00:00&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;户外运动&#x27;</span>, <span class="string">&#x27;滑板&#x27;</span>, <span class="number">499.90</span>, <span class="number">1200</span>, <span class="string">&#x27;2020-11-10 00:00:00&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>针对 goods 表中的数据来验证每个窗口函数的功能。</p>
<ul>
<li><p>序号函数 - <code>ROW_NUMBER()</code> 函数</p>
<p>  对数据中的序号进行顺序显示。</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"># 查询 goods 数据表中每个商品分类下价格降序排列的各个商品信息。</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span> ( <span class="keyword">PARTITION</span> <span class="keyword">BY</span> category_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> price <span class="keyword">DESC</span> ) <span class="keyword">AS</span> row_num,</span><br><span class="line">	id, category_id, category, NAME, price, stock </span><br><span class="line"><span class="keyword">FROM</span> goods;</span><br><span class="line"># 结果</span><br><span class="line"><span class="operator">+</span><span class="comment">---------+----+-------------+---------------------+-----------------+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> row_num <span class="operator">|</span> id <span class="operator">|</span> category_id <span class="operator">|</span> category            <span class="operator">|</span> NAME            <span class="operator">|</span> price   <span class="operator">|</span> stock <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+----+-------------+---------------------+-----------------+---------+-------+</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>  <span class="number">6</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 呢绒外套        <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span>  <span class="number">1200</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">2</span> <span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 卫衣            <span class="operator">|</span>   <span class="number">89.90</span> <span class="operator">|</span>  <span class="number">1500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">3</span> <span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 牛仔裤          <span class="operator">|</span>   <span class="number">89.90</span> <span class="operator">|</span>  <span class="number">3500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">4</span> <span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 连衣裙          <span class="operator">|</span>   <span class="number">79.90</span> <span class="operator">|</span>  <span class="number">2500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">5</span> <span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> T恤             <span class="operator">|</span>   <span class="number">39.90</span> <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">6</span> <span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 百褶裙          <span class="operator">|</span>   <span class="number">29.90</span> <span class="operator">|</span>   <span class="number">500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>  <span class="number">8</span> <span class="operator">|</span>           <span class="number">2</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 山地自行车      <span class="operator">|</span> <span class="number">1399.90</span> <span class="operator">|</span>  <span class="number">2500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">2</span> <span class="operator">|</span> <span class="number">11</span> <span class="operator">|</span>           <span class="number">2</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 运动外套        <span class="operator">|</span>  <span class="number">799.90</span> <span class="operator">|</span>   <span class="number">500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">3</span> <span class="operator">|</span> <span class="number">12</span> <span class="operator">|</span>           <span class="number">2</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 滑板            <span class="operator">|</span>  <span class="number">499.90</span> <span class="operator">|</span>  <span class="number">1200</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">4</span> <span class="operator">|</span>  <span class="number">7</span> <span class="operator">|</span>           <span class="number">2</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 自行车          <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">5</span> <span class="operator">|</span> <span class="number">10</span> <span class="operator">|</span>           <span class="number">2</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 骑行装备        <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span>  <span class="number">3500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">6</span> <span class="operator">|</span>  <span class="number">9</span> <span class="operator">|</span>           <span class="number">2</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 登山杖          <span class="operator">|</span>   <span class="number">59.90</span> <span class="operator">|</span>  <span class="number">1500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+----+-------------+---------------------+-----------------+---------+-------+</span></span><br><span class="line"><span class="number">12</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"># 查询 goods 数据表中每个商品分类下价格最高的 <span class="number">3</span> 种商品信息。</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">( <span class="keyword">SELECT</span> <span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span> ( <span class="keyword">PARTITION</span> <span class="keyword">BY</span> category_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> price <span class="keyword">DESC</span> ) <span class="keyword">AS</span> row_num, id, category_id, category, NAME, price, stock <span class="keyword">FROM</span> goods ) t </span><br><span class="line"><span class="keyword">WHERE</span> row_num <span class="operator">&lt;=</span> <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"># 结果</span><br><span class="line"><span class="operator">+</span><span class="comment">---------+----+-------------+---------------------+-----------------+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> row_num <span class="operator">|</span> id <span class="operator">|</span> category_id <span class="operator">|</span> category            <span class="operator">|</span> NAME            <span class="operator">|</span> price   <span class="operator">|</span> stock <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+----+-------------+---------------------+-----------------+---------+-------+</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>  <span class="number">6</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 呢绒外套        <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span>  <span class="number">1200</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">2</span> <span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 卫衣            <span class="operator">|</span>   <span class="number">89.90</span> <span class="operator">|</span>  <span class="number">1500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">3</span> <span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 牛仔裤          <span class="operator">|</span>   <span class="number">89.90</span> <span class="operator">|</span>  <span class="number">3500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>  <span class="number">8</span> <span class="operator">|</span>           <span class="number">2</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 山地自行车      <span class="operator">|</span> <span class="number">1399.90</span> <span class="operator">|</span>  <span class="number">2500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">2</span> <span class="operator">|</span> <span class="number">11</span> <span class="operator">|</span>           <span class="number">2</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 运动外套        <span class="operator">|</span>  <span class="number">799.90</span> <span class="operator">|</span>   <span class="number">500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">3</span> <span class="operator">|</span> <span class="number">12</span> <span class="operator">|</span>           <span class="number">2</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 滑板            <span class="operator">|</span>  <span class="number">499.90</span> <span class="operator">|</span>  <span class="number">1200</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+----+-------------+---------------------+-----------------+---------+-------+</span></span><br><span class="line"><span class="number">6</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>序号函数 - <code>RANK()</code> 函数</p>
<p>  对序号进行并列排序，并且会跳过重复的序号，比如序号为 1、1、3。</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 获取goods 数据表中各类别的价格从高到低排序的各商品信息。</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="built_in">RANK</span>() <span class="keyword">OVER</span> ( <span class="keyword">PARTITION</span> <span class="keyword">BY</span> category_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> price <span class="keyword">DESC</span> ) <span class="keyword">AS</span> row_num,</span><br><span class="line">	id, category_id, category, NAME, price, stock </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	goods;</span><br><span class="line"># 结果：</span><br><span class="line"><span class="operator">+</span><span class="comment">---------+----+-------------+---------------------+-----------------+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> row_num <span class="operator">|</span> id <span class="operator">|</span> category_id <span class="operator">|</span> category            <span class="operator">|</span> NAME            <span class="operator">|</span> price   <span class="operator">|</span> stock <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+----+-------------+---------------------+-----------------+---------+-------+</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>  <span class="number">6</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 呢绒外套        <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span>  <span class="number">1200</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">2</span> <span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 卫衣            <span class="operator">|</span>   <span class="number">89.90</span> <span class="operator">|</span>  <span class="number">1500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">2</span> <span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 牛仔裤          <span class="operator">|</span>   <span class="number">89.90</span> <span class="operator">|</span>  <span class="number">3500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">4</span> <span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 连衣裙          <span class="operator">|</span>   <span class="number">79.90</span> <span class="operator">|</span>  <span class="number">2500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">5</span> <span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> T恤             <span class="operator">|</span>   <span class="number">39.90</span> <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">6</span> <span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 百褶裙          <span class="operator">|</span>   <span class="number">29.90</span> <span class="operator">|</span>   <span class="number">500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>  <span class="number">8</span> <span class="operator">|</span>           <span class="number">2</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 山地自行车      <span class="operator">|</span> <span class="number">1399.90</span> <span class="operator">|</span>  <span class="number">2500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">2</span> <span class="operator">|</span> <span class="number">11</span> <span class="operator">|</span>           <span class="number">2</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 运动外套        <span class="operator">|</span>  <span class="number">799.90</span> <span class="operator">|</span>   <span class="number">500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">3</span> <span class="operator">|</span> <span class="number">12</span> <span class="operator">|</span>           <span class="number">2</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 滑板            <span class="operator">|</span>  <span class="number">499.90</span> <span class="operator">|</span>  <span class="number">1200</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">4</span> <span class="operator">|</span>  <span class="number">7</span> <span class="operator">|</span>           <span class="number">2</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 自行车          <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">4</span> <span class="operator">|</span> <span class="number">10</span> <span class="operator">|</span>           <span class="number">2</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 骑行装备        <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span>  <span class="number">3500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">6</span> <span class="operator">|</span>  <span class="number">9</span> <span class="operator">|</span>           <span class="number">2</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 登山杖          <span class="operator">|</span>   <span class="number">59.90</span> <span class="operator">|</span>  <span class="number">1500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+----+-------------+---------------------+-----------------+---------+-------+</span></span><br><span class="line"><span class="number">12</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>序号函数 - <code>DENSE_RANK()</code> 函数</p>
<p>  对序号进行并列排序，并且不会跳过重复的序号，比如序号为 1、1、2。</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 获取 goods 数据表中各类别的价格从高到低排序的各商品信息。</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="built_in">DENSE_RANK</span>() <span class="keyword">OVER</span> ( <span class="keyword">PARTITION</span> <span class="keyword">BY</span> category_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> price <span class="keyword">DESC</span> ) <span class="keyword">AS</span> row_num,</span><br><span class="line">	id, category_id, category, NAME, price, stock </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	goods;</span><br><span class="line">	</span><br><span class="line"># 结果：</span><br><span class="line"><span class="operator">+</span><span class="comment">---------+----+-------------+---------------------+-----------------+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> row_num <span class="operator">|</span> id <span class="operator">|</span> category_id <span class="operator">|</span> category            <span class="operator">|</span> NAME            <span class="operator">|</span> price   <span class="operator">|</span> stock <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+----+-------------+---------------------+-----------------+---------+-------+</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>  <span class="number">6</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 呢绒外套        <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span>  <span class="number">1200</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">2</span> <span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 卫衣            <span class="operator">|</span>   <span class="number">89.90</span> <span class="operator">|</span>  <span class="number">1500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">2</span> <span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 牛仔裤          <span class="operator">|</span>   <span class="number">89.90</span> <span class="operator">|</span>  <span class="number">3500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">3</span> <span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 连衣裙          <span class="operator">|</span>   <span class="number">79.90</span> <span class="operator">|</span>  <span class="number">2500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">4</span> <span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> T恤             <span class="operator">|</span>   <span class="number">39.90</span> <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">5</span> <span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 百褶裙          <span class="operator">|</span>   <span class="number">29.90</span> <span class="operator">|</span>   <span class="number">500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span>  <span class="number">8</span> <span class="operator">|</span>           <span class="number">2</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 山地自行车      <span class="operator">|</span> <span class="number">1399.90</span> <span class="operator">|</span>  <span class="number">2500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">2</span> <span class="operator">|</span> <span class="number">11</span> <span class="operator">|</span>           <span class="number">2</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 运动外套        <span class="operator">|</span>  <span class="number">799.90</span> <span class="operator">|</span>   <span class="number">500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">3</span> <span class="operator">|</span> <span class="number">12</span> <span class="operator">|</span>           <span class="number">2</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 滑板            <span class="operator">|</span>  <span class="number">499.90</span> <span class="operator">|</span>  <span class="number">1200</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">4</span> <span class="operator">|</span>  <span class="number">7</span> <span class="operator">|</span>           <span class="number">2</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 自行车          <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">4</span> <span class="operator">|</span> <span class="number">10</span> <span class="operator">|</span>           <span class="number">2</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 骑行装备        <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span>  <span class="number">3500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">5</span> <span class="operator">|</span>  <span class="number">9</span> <span class="operator">|</span>           <span class="number">2</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 登山杖          <span class="operator">|</span>   <span class="number">59.90</span> <span class="operator">|</span>  <span class="number">1500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+----+-------------+---------------------+-----------------+---------+-------+</span></span><br><span class="line"><span class="number">12</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>分布函数 - <code>PERCENT_RANK()</code> 函数</p>
<p>  是等级值百分比函数。按照 <code>(rank - 1) / (rows - 1)</code> 进行计算。其中，rank 的值为使用 RANK() 函数产生的序号，rows 的值为当前窗口的总记录数。</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"># 计算 goods 数据表中名称为“女士<span class="operator">/</span>女士精品”的类别下的商品的 PERCENT_RANK 值。</span><br><span class="line"></span><br><span class="line"># 写法一：</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="built_in">RANK</span>() <span class="keyword">OVER</span> ( <span class="keyword">PARTITION</span> <span class="keyword">BY</span> category_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> price <span class="keyword">DESC</span> ) <span class="keyword">AS</span> r,</span><br><span class="line">	<span class="built_in">PERCENT_RANK</span>() <span class="keyword">OVER</span> ( <span class="keyword">PARTITION</span> <span class="keyword">BY</span> category_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> price <span class="keyword">DESC</span> ) <span class="keyword">AS</span> pr,</span><br><span class="line">	id, category_id, category, NAME, price, stock </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	goods </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	category_id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"># 写法二：</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="built_in">RANK</span>() <span class="keyword">OVER</span> w <span class="keyword">AS</span> r,</span><br><span class="line">	<span class="built_in">PERCENT_RANK</span>() <span class="keyword">OVER</span> w <span class="keyword">AS</span> pr,</span><br><span class="line">	id, category_id, category, NAME, price, stock </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	goods </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	category_id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">WINDOW</span> w <span class="keyword">AS</span> ( <span class="keyword">PARTITION</span> <span class="keyword">BY</span> category_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> price <span class="keyword">DESC</span> );</span><br><span class="line"></span><br><span class="line"># 结果</span><br><span class="line"><span class="operator">+</span><span class="comment">---+-----+----+-------------+---------------------+--------------+--------+-------+</span></span><br><span class="line"><span class="operator">|</span> r <span class="operator">|</span> pr  <span class="operator">|</span> id <span class="operator">|</span> category_id <span class="operator">|</span> category            <span class="operator">|</span> NAME         <span class="operator">|</span> price  <span class="operator">|</span> stock <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---+-----+----+-------------+---------------------+--------------+--------+-------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span> <span class="operator">|</span>   <span class="number">0</span> <span class="operator">|</span>  <span class="number">6</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 呢绒外套     <span class="operator">|</span> <span class="number">399.90</span> <span class="operator">|</span>  <span class="number">1200</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span> <span class="operator">|</span> <span class="number">0.2</span> <span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 卫衣         <span class="operator">|</span>  <span class="number">89.90</span> <span class="operator">|</span>  <span class="number">1500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span> <span class="operator">|</span> <span class="number">0.2</span> <span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 牛仔裤       <span class="operator">|</span>  <span class="number">89.90</span> <span class="operator">|</span>  <span class="number">3500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">4</span> <span class="operator">|</span> <span class="number">0.6</span> <span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 连衣裙       <span class="operator">|</span>  <span class="number">79.90</span> <span class="operator">|</span>  <span class="number">2500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">5</span> <span class="operator">|</span> <span class="number">0.8</span> <span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> T恤          <span class="operator">|</span>  <span class="number">39.90</span> <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">6</span> <span class="operator">|</span>   <span class="number">1</span> <span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 百褶裙       <span class="operator">|</span>  <span class="number">29.90</span> <span class="operator">|</span>   <span class="number">500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---+-----+----+-------------+---------------------+--------------+--------+-------+</span></span><br><span class="line"><span class="number">6</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>分布函数 - <code>CUME_DIST()</code> 函数</p>
<p>  查询小于或等于某个值的比例</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 查询 goods 数据表中小于或等于当前价格的比例。</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="built_in">CUME_DIST</span>() <span class="keyword">OVER</span> ( <span class="keyword">PARTITION</span> <span class="keyword">BY</span> category_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> price <span class="keyword">ASC</span> ) <span class="keyword">AS</span> cd,</span><br><span class="line">	id, category, NAME, price</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	goods;</span><br><span class="line"></span><br><span class="line">#结果：</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+----+---------------------+-----------------+---------+</span></span><br><span class="line"><span class="operator">|</span> cd                  <span class="operator">|</span> id <span class="operator">|</span> category            <span class="operator">|</span> NAME            <span class="operator">|</span> price   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+----+---------------------+-----------------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">0.16666666666666666</span> <span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 百褶裙          <span class="operator">|</span>   <span class="number">29.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">0.3333333333333333</span> <span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> T恤             <span class="operator">|</span>   <span class="number">39.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>                 <span class="number">0.5</span> <span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 连衣裙          <span class="operator">|</span>   <span class="number">79.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">0.8333333333333334</span> <span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 卫衣            <span class="operator">|</span>   <span class="number">89.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">0.8333333333333334</span> <span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 牛仔裤          <span class="operator">|</span>   <span class="number">89.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>                   <span class="number">1</span> <span class="operator">|</span>  <span class="number">6</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 呢绒外套        <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">0.16666666666666666</span> <span class="operator">|</span>  <span class="number">9</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 登山杖          <span class="operator">|</span>   <span class="number">59.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>                 <span class="number">0.5</span> <span class="operator">|</span>  <span class="number">7</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 自行车          <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>                 <span class="number">0.5</span> <span class="operator">|</span> <span class="number">10</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 骑行装备        <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">0.6666666666666666</span> <span class="operator">|</span> <span class="number">12</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 滑板            <span class="operator">|</span>  <span class="number">499.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">0.8333333333333334</span> <span class="operator">|</span> <span class="number">11</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 运动外套        <span class="operator">|</span>  <span class="number">799.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>                   <span class="number">1</span> <span class="operator">|</span>  <span class="number">8</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 山地自行车      <span class="operator">|</span> <span class="number">1399.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+----+---------------------+-----------------+---------+</span></span><br><span class="line"><span class="number">12</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>前后函数 - <code>LAG(expr, n)</code> 函数</p>
<p>  返回当前行的前 n 行的 expr 的值。</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># 查询 goods 表中前一个商品价格与当前商品价格的差值。</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	id, category, NAME, price, pre_price, price <span class="operator">-</span> pre_price <span class="keyword">AS</span> diff_price </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	(</span><br><span class="line">	<span class="keyword">SELECT</span></span><br><span class="line">		id, category, NAME, price, <span class="built_in">LAG</span>( price, <span class="number">1</span> ) <span class="keyword">OVER</span> w <span class="keyword">AS</span> pre_price </span><br><span class="line">	<span class="keyword">FROM</span></span><br><span class="line">	goods <span class="keyword">WINDOW</span> w <span class="keyword">AS</span> ( <span class="keyword">PARTITION</span> <span class="keyword">BY</span> category_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> price ) </span><br><span class="line">	) t;</span><br><span class="line"></span><br><span class="line"># 结果：</span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------------------+-----------------+---------+-----------+------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> category            <span class="operator">|</span> NAME            <span class="operator">|</span> price   <span class="operator">|</span> pre_price <span class="operator">|</span> diff_price <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------------------+-----------------+---------+-----------+------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 百褶裙          <span class="operator">|</span>   <span class="number">29.90</span> <span class="operator">|</span>      <span class="keyword">NULL</span> <span class="operator">|</span>       <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> T恤             <span class="operator">|</span>   <span class="number">39.90</span> <span class="operator">|</span>     <span class="number">29.90</span> <span class="operator">|</span>      <span class="number">10.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 连衣裙          <span class="operator">|</span>   <span class="number">79.90</span> <span class="operator">|</span>     <span class="number">39.90</span> <span class="operator">|</span>      <span class="number">40.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 卫衣            <span class="operator">|</span>   <span class="number">89.90</span> <span class="operator">|</span>     <span class="number">79.90</span> <span class="operator">|</span>      <span class="number">10.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 牛仔裤          <span class="operator">|</span>   <span class="number">89.90</span> <span class="operator">|</span>     <span class="number">89.90</span> <span class="operator">|</span>       <span class="number">0.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">6</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 呢绒外套        <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span>     <span class="number">89.90</span> <span class="operator">|</span>     <span class="number">310.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">9</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 登山杖          <span class="operator">|</span>   <span class="number">59.90</span> <span class="operator">|</span>      <span class="keyword">NULL</span> <span class="operator">|</span>       <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">7</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 自行车          <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span>     <span class="number">59.90</span> <span class="operator">|</span>     <span class="number">340.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">10</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 骑行装备        <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span>    <span class="number">399.90</span> <span class="operator">|</span>       <span class="number">0.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">12</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 滑板            <span class="operator">|</span>  <span class="number">499.90</span> <span class="operator">|</span>    <span class="number">399.90</span> <span class="operator">|</span>     <span class="number">100.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">11</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 运动外套        <span class="operator">|</span>  <span class="number">799.90</span> <span class="operator">|</span>    <span class="number">499.90</span> <span class="operator">|</span>     <span class="number">300.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">8</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 山地自行车      <span class="operator">|</span> <span class="number">1399.90</span> <span class="operator">|</span>    <span class="number">799.90</span> <span class="operator">|</span>     <span class="number">600.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------------------+-----------------+---------+-----------+------------+</span></span><br><span class="line"><span class="number">12</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>前后函数 - <code>LEAD(expr, n)</code> 函数</p>
<p>  返回当前行的后 n 行的 expr 的值。</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># 查询 goods 数据表中后一个商品价格与当前商品价格的差值。</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	id, category, NAME, behind_price, price,behind_price <span class="operator">-</span> price <span class="keyword">AS</span> diff_price </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	(</span><br><span class="line">	<span class="keyword">SELECT</span></span><br><span class="line">		id, category, NAME, price, <span class="built_in">LEAD</span>( price, <span class="number">1</span> ) <span class="keyword">OVER</span> w <span class="keyword">AS</span> behind_price </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	goods <span class="keyword">WINDOW</span> w <span class="keyword">AS</span> ( <span class="keyword">PARTITION</span> <span class="keyword">BY</span> category_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> price )) t;</span><br><span class="line"></span><br><span class="line"># 结果:</span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------------------+-----------------+--------------+---------+------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> category            <span class="operator">|</span> NAME            <span class="operator">|</span> behind_price <span class="operator">|</span> price   <span class="operator">|</span> diff_price <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------------------+-----------------+--------------+---------+------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 百褶裙          <span class="operator">|</span>        <span class="number">39.90</span> <span class="operator">|</span>   <span class="number">29.90</span> <span class="operator">|</span>      <span class="number">10.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> T恤             <span class="operator">|</span>        <span class="number">79.90</span> <span class="operator">|</span>   <span class="number">39.90</span> <span class="operator">|</span>      <span class="number">40.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 连衣裙          <span class="operator">|</span>        <span class="number">89.90</span> <span class="operator">|</span>   <span class="number">79.90</span> <span class="operator">|</span>      <span class="number">10.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 卫衣            <span class="operator">|</span>        <span class="number">89.90</span> <span class="operator">|</span>   <span class="number">89.90</span> <span class="operator">|</span>       <span class="number">0.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 牛仔裤          <span class="operator">|</span>       <span class="number">399.90</span> <span class="operator">|</span>   <span class="number">89.90</span> <span class="operator">|</span>     <span class="number">310.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">6</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 呢绒外套        <span class="operator">|</span>         <span class="keyword">NULL</span> <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span>       <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">9</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 登山杖          <span class="operator">|</span>       <span class="number">399.90</span> <span class="operator">|</span>   <span class="number">59.90</span> <span class="operator">|</span>     <span class="number">340.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">7</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 自行车          <span class="operator">|</span>       <span class="number">399.90</span> <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span>       <span class="number">0.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">10</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 骑行装备        <span class="operator">|</span>       <span class="number">499.90</span> <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span>     <span class="number">100.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">12</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 滑板            <span class="operator">|</span>       <span class="number">799.90</span> <span class="operator">|</span>  <span class="number">499.90</span> <span class="operator">|</span>     <span class="number">300.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">11</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 运动外套        <span class="operator">|</span>      <span class="number">1399.90</span> <span class="operator">|</span>  <span class="number">799.90</span> <span class="operator">|</span>     <span class="number">600.00</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">8</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 山地自行车      <span class="operator">|</span>         <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1399.90</span> <span class="operator">|</span>       <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------------------+-----------------+--------------+---------+------------+</span></span><br><span class="line"><span class="number">12</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>首尾函数 - <code>FIRST_VALUE(expr)</code> 函数 和 <code>LAST_VALUE（expr)</code> 函数</p>
<p>  <code>FIRST_VALUE(expr)</code> 函数返回第一个 expr 的值。<code>LAST_VALUE（expr)</code> 函数 返回最后一个 expr 的值。</p>
<blockquote>
<p>注意：</p>
<p>在 LAST_VALUE(expr) 函数中，默认帧规范为 <code>RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW</code>，这意味着框架从第一行开始，到当前行结束。为了获取所有数据中最后一条，需要将框架规格更改为 <code>RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING </code>。</p>
</blockquote>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"># 按照价格排序，查询第一个商品的价格信息</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	id, category, NAME, price, stock, <span class="built_in">FIRST_VALUE</span>( price ) <span class="keyword">OVER</span> w <span class="keyword">AS</span> first_price </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	goods <span class="keyword">WINDOW</span> w <span class="keyword">AS</span> ( <span class="keyword">PARTITION</span> <span class="keyword">BY</span> category_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> price );</span><br><span class="line"></span><br><span class="line"># 结果：</span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------------------+-----------------+---------+-------+-------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> category            <span class="operator">|</span> NAME            <span class="operator">|</span> price   <span class="operator">|</span> stock <span class="operator">|</span> first_price <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------------------+-----------------+---------+-------+-------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 百褶裙          <span class="operator">|</span>   <span class="number">29.90</span> <span class="operator">|</span>   <span class="number">500</span> <span class="operator">|</span>       <span class="number">29.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> T恤             <span class="operator">|</span>   <span class="number">39.90</span> <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span>       <span class="number">29.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 连衣裙          <span class="operator">|</span>   <span class="number">79.90</span> <span class="operator">|</span>  <span class="number">2500</span> <span class="operator">|</span>       <span class="number">29.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 卫衣            <span class="operator">|</span>   <span class="number">89.90</span> <span class="operator">|</span>  <span class="number">1500</span> <span class="operator">|</span>       <span class="number">29.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 牛仔裤          <span class="operator">|</span>   <span class="number">89.90</span> <span class="operator">|</span>  <span class="number">3500</span> <span class="operator">|</span>       <span class="number">29.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">6</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 呢绒外套        <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span>  <span class="number">1200</span> <span class="operator">|</span>       <span class="number">29.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">9</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 登山杖          <span class="operator">|</span>   <span class="number">59.90</span> <span class="operator">|</span>  <span class="number">1500</span> <span class="operator">|</span>       <span class="number">59.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">7</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 自行车          <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span>       <span class="number">59.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">10</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 骑行装备        <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span>  <span class="number">3500</span> <span class="operator">|</span>       <span class="number">59.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">12</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 滑板            <span class="operator">|</span>  <span class="number">499.90</span> <span class="operator">|</span>  <span class="number">1200</span> <span class="operator">|</span>       <span class="number">59.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">11</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 运动外套        <span class="operator">|</span>  <span class="number">799.90</span> <span class="operator">|</span>   <span class="number">500</span> <span class="operator">|</span>       <span class="number">59.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">8</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 山地自行车      <span class="operator">|</span> <span class="number">1399.90</span> <span class="operator">|</span>  <span class="number">2500</span> <span class="operator">|</span>       <span class="number">59.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------------------+-----------------+---------+-------+-------------+</span></span><br><span class="line"><span class="number">12</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line"># 按照价格排序，查询最后一个商品的价格信息</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	id, category, NAME, price, stock, <span class="built_in">LAST_VALUE</span>( price ) <span class="keyword">OVER</span> w <span class="keyword">AS</span> last_price </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	goods <span class="keyword">WINDOW</span> w <span class="keyword">AS</span> ( <span class="keyword">PARTITION</span> <span class="keyword">BY</span> category_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> price <span class="keyword">RANGE</span> <span class="keyword">BETWEEN</span> UNBOUNDED PRECEDING <span class="keyword">AND</span> UNBOUNDED FOLLOWING );</span><br><span class="line"></span><br><span class="line"># 结果：</span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------------------+-----------------+---------+-------+------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> category            <span class="operator">|</span> NAME            <span class="operator">|</span> price   <span class="operator">|</span> stock <span class="operator">|</span> last_price <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------------------+-----------------+---------+-------+------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 百褶裙          <span class="operator">|</span>   <span class="number">29.90</span> <span class="operator">|</span>   <span class="number">500</span> <span class="operator">|</span>     <span class="number">399.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> T恤             <span class="operator">|</span>   <span class="number">39.90</span> <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span>     <span class="number">399.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 连衣裙          <span class="operator">|</span>   <span class="number">79.90</span> <span class="operator">|</span>  <span class="number">2500</span> <span class="operator">|</span>     <span class="number">399.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 卫衣            <span class="operator">|</span>   <span class="number">89.90</span> <span class="operator">|</span>  <span class="number">1500</span> <span class="operator">|</span>     <span class="number">399.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 牛仔裤          <span class="operator">|</span>   <span class="number">89.90</span> <span class="operator">|</span>  <span class="number">3500</span> <span class="operator">|</span>     <span class="number">399.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">6</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 呢绒外套        <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span>  <span class="number">1200</span> <span class="operator">|</span>     <span class="number">399.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">9</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 登山杖          <span class="operator">|</span>   <span class="number">59.90</span> <span class="operator">|</span>  <span class="number">1500</span> <span class="operator">|</span>    <span class="number">1399.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">7</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 自行车          <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span>    <span class="number">1399.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">10</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 骑行装备        <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span>  <span class="number">3500</span> <span class="operator">|</span>    <span class="number">1399.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">12</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 滑板            <span class="operator">|</span>  <span class="number">499.90</span> <span class="operator">|</span>  <span class="number">1200</span> <span class="operator">|</span>    <span class="number">1399.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">11</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 运动外套        <span class="operator">|</span>  <span class="number">799.90</span> <span class="operator">|</span>   <span class="number">500</span> <span class="operator">|</span>    <span class="number">1399.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">8</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 山地自行车      <span class="operator">|</span> <span class="number">1399.90</span> <span class="operator">|</span>  <span class="number">2500</span> <span class="operator">|</span>    <span class="number">1399.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------------------+-----------------+---------+-------+------------+</span></span><br><span class="line"><span class="number">12</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>其它函数 - <code>NTH_VALUE(expr, n)</code> 函数</p>
<p>  返回第 n 个 expr 的值。</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 查询 goods 数据表中排名第 <span class="number">3</span> 和 第 <span class="number">4</span> 的价格信息</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	id, category, NAME, price, <span class="built_in">NTH_VALUE</span>( price, <span class="number">2</span> ) <span class="keyword">OVER</span> w <span class="keyword">AS</span> second_price, <span class="built_in">NTH_VALUE</span>(price, <span class="number">3</span>) <span class="keyword">OVER</span> w <span class="keyword">AS</span> third_price </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	goods <span class="keyword">WINDOW</span> w <span class="keyword">AS</span> ( <span class="keyword">PARTITION</span> <span class="keyword">BY</span> category_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> price );</span><br><span class="line">	</span><br><span class="line"># 结果：</span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------------------+-----------------+---------+--------------+-------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> category            <span class="operator">|</span> NAME            <span class="operator">|</span> price   <span class="operator">|</span> second_price <span class="operator">|</span> third_price <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------------------+-----------------+---------+--------------+-------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 百褶裙          <span class="operator">|</span>   <span class="number">29.90</span> <span class="operator">|</span>         <span class="keyword">NULL</span> <span class="operator">|</span>        <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> T恤             <span class="operator">|</span>   <span class="number">39.90</span> <span class="operator">|</span>        <span class="number">39.90</span> <span class="operator">|</span>        <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 连衣裙          <span class="operator">|</span>   <span class="number">79.90</span> <span class="operator">|</span>        <span class="number">39.90</span> <span class="operator">|</span>       <span class="number">79.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 卫衣            <span class="operator">|</span>   <span class="number">89.90</span> <span class="operator">|</span>        <span class="number">39.90</span> <span class="operator">|</span>       <span class="number">79.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 牛仔裤          <span class="operator">|</span>   <span class="number">89.90</span> <span class="operator">|</span>        <span class="number">39.90</span> <span class="operator">|</span>       <span class="number">79.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">6</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 呢绒外套        <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span>        <span class="number">39.90</span> <span class="operator">|</span>       <span class="number">79.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">9</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 登山杖          <span class="operator">|</span>   <span class="number">59.90</span> <span class="operator">|</span>         <span class="keyword">NULL</span> <span class="operator">|</span>        <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">7</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 自行车          <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span>       <span class="number">399.90</span> <span class="operator">|</span>      <span class="number">399.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">10</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 骑行装备        <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span>       <span class="number">399.90</span> <span class="operator">|</span>      <span class="number">399.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">12</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 滑板            <span class="operator">|</span>  <span class="number">499.90</span> <span class="operator">|</span>       <span class="number">399.90</span> <span class="operator">|</span>      <span class="number">399.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">11</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 运动外套        <span class="operator">|</span>  <span class="number">799.90</span> <span class="operator">|</span>       <span class="number">399.90</span> <span class="operator">|</span>      <span class="number">399.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">8</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 山地自行车      <span class="operator">|</span> <span class="number">1399.90</span> <span class="operator">|</span>       <span class="number">399.90</span> <span class="operator">|</span>      <span class="number">399.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------------------+-----------------+---------+--------------+-------------+</span></span><br><span class="line"><span class="number">12</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>其它函数 - <code>NTILE(n)</code> 函数</p>
<p>  将分区中的有序数据分为 n 个桶，记录桶编号。</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 将 goods 表中的商品按照价格分为 <span class="number">3</span> 组。</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">	<span class="built_in">NTILE</span>(<span class="number">3</span>) <span class="keyword">OVER</span> w <span class="keyword">AS</span> nt, id, category, NAME, price</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	goods <span class="keyword">WINDOW</span> w <span class="keyword">AS</span> ( <span class="keyword">PARTITION</span> <span class="keyword">BY</span> category_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> price );</span><br><span class="line">	</span><br><span class="line"># 结果：</span><br><span class="line"><span class="operator">+</span><span class="comment">----+----+---------------------+-----------------+---------+</span></span><br><span class="line"><span class="operator">|</span> nt <span class="operator">|</span> id <span class="operator">|</span> category            <span class="operator">|</span> NAME            <span class="operator">|</span> price   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+----+---------------------+-----------------+---------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 百褶裙          <span class="operator">|</span>   <span class="number">29.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> T恤             <span class="operator">|</span>   <span class="number">39.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 连衣裙          <span class="operator">|</span>   <span class="number">79.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 卫衣            <span class="operator">|</span>   <span class="number">89.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 牛仔裤          <span class="operator">|</span>   <span class="number">89.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span>  <span class="number">6</span> <span class="operator">|</span> 女装<span class="operator">/</span>女士精品       <span class="operator">|</span> 呢绒外套        <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span>  <span class="number">9</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 登山杖          <span class="operator">|</span>   <span class="number">59.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span>  <span class="number">7</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 自行车          <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> <span class="number">10</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 骑行装备        <span class="operator">|</span>  <span class="number">399.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> <span class="number">12</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 滑板            <span class="operator">|</span>  <span class="number">499.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> <span class="number">11</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 运动外套        <span class="operator">|</span>  <span class="number">799.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span>  <span class="number">8</span> <span class="operator">|</span> 户外运动            <span class="operator">|</span> 山地自行车      <span class="operator">|</span> <span class="number">1399.90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+----+---------------------+-----------------+---------+</span></span><br><span class="line"><span class="number">12</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-4-小结"><a href="#2-4-小结" class="headerlink" title="2.4 小结"></a>2.4 小结</h4><p>窗口函数的特点是可以分组，而且可以在分组内排序。另外，窗口函数不会因为分组而减少原表中的行数，这对我们在原表数据的基础上进行统计和排序非常有用。</p>
<h3 id="3-新特性2-公用表表达式"><a href="#3-新特性2-公用表表达式" class="headerlink" title="3. 新特性2: 公用表表达式"></a>3. 新特性2: 公用表表达式</h3><p>公用表表达式 (或通用表表达式) 简称 CTE (Common Table Expressions)。CTE 是一个命名的临时结果集，作用范围是当前语句。CTE 可以理解成一个可以复用的子查询，当然跟子查询还是有点区别的，CTE 可以引用其它 CTE，但子查询不能引用其它子查询。所以，可以考虑代替子查询。</p>
<p>一句语法结构和执行方式的不同，公用表表达式分为<strong>普通公用表表达式</strong>和<strong>递归公用表表达式</strong>两种。</p>
<h4 id="3-1-普通公用表表达式"><a href="#3-1-普通公用表表达式" class="headerlink" title="3.1 普通公用表表达式"></a>3.1 普通公用表表达式</h4><p>普通公用表表达式的语法结构是：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> CTE名称</span><br><span class="line"><span class="keyword">AS</span> (子查询)</span><br><span class="line"><span class="keyword">SELECT</span><span class="operator">|</span><span class="keyword">DELETE</span><span class="operator">|</span><span class="keyword">UPDATE</span> 语句;</span><br></pre></td></tr></table></figure>

<p>普通公用表表达式类似于子查询，不过跟子查询不同的是，它可以被多次引用，而且可以被其他的普通公用表表达式所引用。</p>
<h4 id="3-2-递归公用表表达式"><a href="#3-2-递归公用表表达式" class="headerlink" title="3.2 递归公用表表达式"></a>3.2 递归公用表表达式</h4><p>递归公用表表达式也是一种公用表表达式，只不过，除了普通公用表表达式的特点以外，它还有自己的特点，就是可以调用自己。它的语法结构是：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> <span class="keyword">RECURSIVE</span></span><br><span class="line">CTE名称 <span class="keyword">AS</span> (子查询)</span><br><span class="line"><span class="keyword">SELECT</span><span class="operator">|</span><span class="keyword">DELETE</span><span class="operator">|</span><span class="keyword">UPDATE</span> 语句;</span><br></pre></td></tr></table></figure>

<p>递归公用表表达式由两部分组成，分别是种子查询和递归查询，中间通过关键字 UNION [ALL] 进行连接。这里的<strong>种子查询，意思就是获得递归的初始值</strong>。这个查询只会运行一次，以创建初始数据集，之后递归查询会一直执行，直到没有任何新的查询数据产生，递归返回。</p>
<h4 id="3-3-小结"><a href="#3-3-小结" class="headerlink" title="3.3 小结"></a>3.3 小结</h4><p>公用表表达式可以替代子查询，而且可以被多次引用。递归公用表表达式对查询有一个共同根结点的树形结构数据非常高效，可以轻松搞定其他查询方式难以处理的查询。</p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a></div><div class="post_share"><div class="social-share" data-image="http://1.117.162.142:9000/blog/cover.jpeg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/10/31/mysql-advanced/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://1.117.162.142:9000/blog/cover.jpeg" onerror="onerror=null;src='http://1.117.162.142:9000/blog/404.png'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">MySQL 进阶</div></div></a></div><div class="next-post pull-right"><a href="/2022/09/02/dsa/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://1.117.162.142:9000/blog/cover.jpeg" onerror="onerror=null;src='http://1.117.162.142:9000/blog/404.png'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">数据结构与算法</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/10/31/mysql-advanced/" title="MySQL 进阶"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://1.117.162.142:9000/blog/cover.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-31</div><div class="title">MySQL 进阶</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">一、数据库概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-RDBMS-%E4%B8%8E-%E9%9D%9E-RDBMS"><span class="toc-number">1.1.</span> <span class="toc-text">1. RDBMS 与 非 RDBMS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93-RDBMS"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 关系型数据库 (RDBMS)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E9%9D%9E%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93-%E9%9D%9ERDBMS"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2 非关系型数据库 (非RDBMS)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E8%A7%84%E5%88%99"><span class="toc-number">1.2.</span> <span class="toc-text">2. 关系型数据库设计规则</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E8%A1%A8%E3%80%81%E8%AE%B0%E5%BD%95%E3%80%81%E5%AD%97%E6%AE%B5"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 表、记录、字段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E8%A1%A8%E7%9A%84%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 表的关联关系</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81MySQL-%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">二、MySQL 安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E5%AE%89%E8%A3%85-MySQL%EF%BC%8C%E5%B9%B6%E5%8D%B8%E8%BD%BD"><span class="toc-number">2.1.</span> <span class="toc-text">1. 检查是否安装 MySQL，并卸载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AE%89%E8%A3%85"><span class="toc-number">2.2.</span> <span class="toc-text">2. 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%9F%A5%E7%9C%8B-MySQL-%E7%89%88%E6%9C%AC"><span class="toc-number">2.3.</span> <span class="toc-text">3. 查看 MySQL 版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">2.4.</span> <span class="toc-text">4. 服务的初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95"><span class="toc-number">2.5.</span> <span class="toc-text">5. 远程登录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E6%95%B0%E6%8D%AE%E7%9B%AE%E5%BD%95"><span class="toc-number">2.6.</span> <span class="toc-text">6. 数据目录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81SQL-%E6%A6%82%E8%BF%B0"><span class="toc-number">3.</span> <span class="toc-text">三、SQL 概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-SQL-%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">3.1.</span> <span class="toc-text">1. SQL 的分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-SQL-%E8%AF%AD%E8%A8%80%E7%9A%84%E8%A7%84%E5%88%99%E5%92%8C%E8%A7%84%E8%8C%83"><span class="toc-number">3.2.</span> <span class="toc-text">2. SQL 语言的规则和规范</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E5%9F%BA%E6%9C%AC%E8%A7%84%E5%88%99"><span class="toc-number">3.2.1.</span> <span class="toc-text">2.1 基本规则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-SQL%E5%A4%A7%E5%B0%8F%E5%86%99%E8%A7%84%E8%8C%83"><span class="toc-number">3.2.2.</span> <span class="toc-text">2.2 SQL大小写规范</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E6%B3%A8%E9%87%8A"><span class="toc-number">3.2.3.</span> <span class="toc-text">2.3 注释</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99"><span class="toc-number">3.2.4.</span> <span class="toc-text">2.4 命名规则</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9A%84-SELECT-%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.3.</span> <span class="toc-text">3. 最基本的 SELECT 语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">4.</span> <span class="toc-text">四、运算符</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">4.1.</span> <span class="toc-text">1. 算术运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">4.2.</span> <span class="toc-text">2. 比较运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">4.3.</span> <span class="toc-text">3. 逻辑运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%BD%8D%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">4.4.</span> <span class="toc-text">4. 位运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">4.5.</span> <span class="toc-text">5. 运算符的优先级</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%8E%92%E5%BA%8F%E4%B8%8E%E5%88%86%E9%A1%B5"><span class="toc-number">5.</span> <span class="toc-text">五、排序与分页</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%8E%92%E5%BA%8F%E6%95%B0%E6%8D%AE"><span class="toc-number">5.1.</span> <span class="toc-text">1. 排序数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E6%8E%92%E5%BA%8F%E8%A7%84%E5%88%99"><span class="toc-number">5.1.1.</span> <span class="toc-text">1.1 排序规则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E5%8D%95%E5%88%97%E6%8E%92%E5%BA%8F"><span class="toc-number">5.1.2.</span> <span class="toc-text">1.2 单列排序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E5%A4%9A%E5%88%97%E6%8E%92%E5%BA%8F"><span class="toc-number">5.1.3.</span> <span class="toc-text">1.3 多列排序</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%86%E9%A1%B5"><span class="toc-number">5.2.</span> <span class="toc-text">2. 分页</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E5%AE%9E%E7%8E%B0%E8%A7%84%E5%88%99"><span class="toc-number">5.2.1.</span> <span class="toc-text">2.1 实现规则</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.</span> <span class="toc-text">六、多表查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF-%E4%BA%A4%E5%8F%89%E8%BF%9E%E6%8E%A5"><span class="toc-number">6.1.</span> <span class="toc-text">1. 笛卡尔积 (交叉连接)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E4%BA%A7%E7%94%9F%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF%E9%94%99%E8%AF%AF%E7%9A%84%E6%9D%A1%E4%BB%B6%EF%BC%9A"><span class="toc-number">6.1.1.</span> <span class="toc-text">1.1 产生笛卡尔积错误的条件：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-%E7%A7%8D-SQL-JOIN-%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">6.2.</span> <span class="toc-text">2. 7 种 SQL JOIN 的实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E5%90%88%E5%B9%B6%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C"><span class="toc-number">6.2.1.</span> <span class="toc-text">2.1 合并查询结果</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-UNION-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">6.2.2.</span> <span class="toc-text">2.2 UNION 的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-UNION-ALL-%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">6.2.3.</span> <span class="toc-text">2.3 UNION ALL 操作符</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E5%87%BD%E6%95%B0"><span class="toc-number">7.</span> <span class="toc-text">七、函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%B8%8D%E5%90%8C-DBMS-%E5%87%BD%E6%95%B0%E7%9A%84%E5%B7%AE%E5%BC%82"><span class="toc-number">7.1.</span> <span class="toc-text">1. 不同 DBMS 函数的差异</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-MySQL-%E7%9A%84%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0%E5%8F%8A%E5%88%86%E7%B1%BB"><span class="toc-number">7.2.</span> <span class="toc-text">2. MySQL 的内置函数及分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%8D%95%E8%A1%8C%E5%87%BD%E6%95%B0"><span class="toc-number">7.3.</span> <span class="toc-text">3. 单行函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E6%95%B0%E5%80%BC%E5%87%BD%E6%95%B0"><span class="toc-number">7.3.1.</span> <span class="toc-text">3.1 数值函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="toc-number">7.3.2.</span> <span class="toc-text">3.2 字符串函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E5%87%BD%E6%95%B0"><span class="toc-number">7.3.3.</span> <span class="toc-text">3.3 日期和时间函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E5%87%BD%E6%95%B0"><span class="toc-number">7.3.4.</span> <span class="toc-text">3.4 流程控制函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-%E5%8A%A0%E5%AF%86%E4%B8%8E%E8%A7%A3%E5%AF%86%E5%87%BD%E6%95%B0"><span class="toc-number">7.3.5.</span> <span class="toc-text">3.5 加密与解密函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-MySQL-%E4%BF%A1%E6%81%AF%E5%87%BD%E6%95%B0"><span class="toc-number">7.3.6.</span> <span class="toc-text">3.6 MySQL 信息函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-%E5%85%B6%E4%BB%96%E5%87%BD%E6%95%B0"><span class="toc-number">7.3.7.</span> <span class="toc-text">3.7 其他函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="toc-number">7.4.</span> <span class="toc-text">4. 聚合函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-MySQL-%E4%B8%AD%E5%B8%B8%E7%94%A8%E7%9A%84%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0%E7%B1%BB%E5%9E%8B%EF%BC%9A"><span class="toc-number">7.4.1.</span> <span class="toc-text">4.1 MySQL 中常用的聚合函数类型：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-GROUP-BY-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">7.4.2.</span> <span class="toc-text">4.2 GROUP BY 的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-HAVING-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">7.4.3.</span> <span class="toc-text">4.3 HAVING 的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-SQL-%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B"><span class="toc-number">7.4.4.</span> <span class="toc-text">4.4 SQL 语句的执行过程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">8.</span> <span class="toc-text">八、子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AD%90%E6%9F%A5%E8%AF%A2%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">8.1.</span> <span class="toc-text">1. 子查询的基本使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AD%90%E6%9F%A5%E8%AF%A2%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">8.2.</span> <span class="toc-text">2. 子查询的分类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E5%88%9B%E5%BB%BA%E5%92%8C%E7%AE%A1%E7%90%86%E8%A1%A8"><span class="toc-number">9.</span> <span class="toc-text">九、创建和管理表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">9.1.</span> <span class="toc-text">1. 基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E4%B8%80%E6%9D%A1%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E7%9A%84%E8%BF%87%E7%A8%8B"><span class="toc-number">9.1.1.</span> <span class="toc-text">1.1 一条数据存储的过程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E6%A0%87%E8%AF%86%E7%AC%A6%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99"><span class="toc-number">9.1.2.</span> <span class="toc-text">1.2 标识符命名规则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-MySQL-%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">9.1.3.</span> <span class="toc-text">1.3 MySQL 中的数据类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E5%92%8C%E7%AE%A1%E7%90%86%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">9.2.</span> <span class="toc-text">2. 创建和管理数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">9.2.1.</span> <span class="toc-text">2.1 创建数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">9.2.2.</span> <span class="toc-text">2.2 使用数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">9.2.3.</span> <span class="toc-text">2.3 修改数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">9.2.4.</span> <span class="toc-text">2.4 删除数据库</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%88%9B%E5%BB%BA%E5%92%8C%E7%AE%A1%E7%90%86%E8%A1%A8"><span class="toc-number">9.3.</span> <span class="toc-text">3. 创建和管理表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="toc-number">9.3.1.</span> <span class="toc-text">3.1 创建表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E4%BF%AE%E6%94%B9%E8%A1%A8"><span class="toc-number">9.3.2.</span> <span class="toc-text">3.2 修改表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E9%87%8D%E5%91%BD%E5%90%8D%E8%A1%A8"><span class="toc-number">9.3.3.</span> <span class="toc-text">3.3 重命名表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-%E5%88%A0%E9%99%A4%E8%A1%A8"><span class="toc-number">9.3.4.</span> <span class="toc-text">3.4 删除表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-%E6%B8%85%E7%A9%BA%E8%A1%A8"><span class="toc-number">9.3.5.</span> <span class="toc-text">3.5 清空表</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-DCL-%E4%B8%AD%E7%9A%84-COMMIT-%E5%92%8C-ROLLBACK-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">9.4.</span> <span class="toc-text">4. DCL 中的 COMMIT 和 ROLLBACK 的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E3%80%8AJava-%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C%E3%80%8B%E4%B9%8B-MySQL-%E5%AD%97%E6%AE%B5%E5%91%BD%E5%90%8D"><span class="toc-number">9.5.</span> <span class="toc-text">5. 阿里巴巴《Java 开发手册》之 MySQL 字段命名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E6%B8%85%E7%A9%BA%E8%A1%A8%E3%80%81%E5%88%A0%E9%99%A4%E8%A1%A8%E7%AD%89%E6%93%8D%E4%BD%9C%E9%9C%80%E8%B0%A8%E6%85%8E%EF%BC%9F"><span class="toc-number">9.6.</span> <span class="toc-text">6. 如何理解清空表、删除表等操作需谨慎？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-MySQL-8-%E6%96%B0%E7%89%B9%E6%80%A7%E2%80%94%E2%80%94DDL-%E7%9A%84%E5%8E%9F%E5%AD%90%E5%8C%96"><span class="toc-number">9.7.</span> <span class="toc-text">7. MySQL 8 新特性——DDL 的原子化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E3%80%81%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E4%B9%8B%E5%A2%9E%E5%88%A0%E6%94%B9"><span class="toc-number">10.</span> <span class="toc-text">十、数据处理之增删改</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">10.1.</span> <span class="toc-text">1. 插入数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E6%96%B9%E5%BC%8F%E4%B8%80%EF%BC%9AVALUES-%E7%9A%84%E6%96%B9%E5%BC%8F%E6%B7%BB%E5%8A%A0"><span class="toc-number">10.1.1.</span> <span class="toc-text">1.1 方式一：VALUES 的方式添加</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E6%96%B9%E5%BC%8F%E4%BA%8C%EF%BC%9A%E5%B0%86%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%E6%8F%92%E5%85%A5%E5%88%B0%E8%A1%A8%E4%B8%AD"><span class="toc-number">10.1.2.</span> <span class="toc-text">1.2 方式二：将查询结果插入到表中</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="toc-number">10.2.</span> <span class="toc-text">2. 删除数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE"><span class="toc-number">10.3.</span> <span class="toc-text">3. 修改数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-MySQL-8-%E6%96%B0%E7%89%B9%E6%80%A7%E2%80%94%E2%80%94%E8%AE%A1%E7%AE%97%E5%88%97"><span class="toc-number">10.4.</span> <span class="toc-text">4. MySQL 8 新特性——计算列</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%80%E3%80%81MySQL-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%B2%BE%E8%AE%B2"><span class="toc-number">11.</span> <span class="toc-text">十一、MySQL 数据类型精讲</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-MySQL-%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">11.1.</span> <span class="toc-text">1. MySQL 中的数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%95%B4%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="toc-number">11.2.</span> <span class="toc-text">2. 整数类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%B5%AE%E7%82%B9%E7%B1%BB%E5%9E%8B"><span class="toc-number">11.3.</span> <span class="toc-text">3. 浮点类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E7%B1%BB%E5%9E%8B%E4%BB%8B%E7%BB%8D"><span class="toc-number">11.3.1.</span> <span class="toc-text">3.1 类型介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E6%95%B0%E6%8D%AE%E7%B2%BE%E5%BA%A6%E8%AF%B4%E6%98%8E"><span class="toc-number">11.3.2.</span> <span class="toc-text">3.2 数据精度说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E7%B2%BE%E5%BA%A6%E8%AF%AF%E5%B7%AE%E8%AF%B4%E6%98%8E"><span class="toc-number">11.3.3.</span> <span class="toc-text">3.3 精度误差说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%AE%9A%E7%82%B9%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="toc-number">11.4.</span> <span class="toc-text">4. 定点数类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E7%B1%BB%E5%9E%8B%E4%BB%8B%E7%BB%8D"><span class="toc-number">11.4.1.</span> <span class="toc-text">4.1 类型介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E5%BC%80%E5%8F%91%E4%B8%AD%E7%BB%8F%E9%AA%8C"><span class="toc-number">11.4.2.</span> <span class="toc-text">4.2 开发中经验</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E4%BD%8D%E7%B1%BB%E5%9E%8B%EF%BC%9ABIT"><span class="toc-number">11.5.</span> <span class="toc-text">5. 位类型：BIT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E7%B1%BB%E5%9E%8B"><span class="toc-number">11.6.</span> <span class="toc-text">6. 日期和时间类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-YEAR-%E7%B1%BB%E5%9E%8B"><span class="toc-number">11.6.1.</span> <span class="toc-text">6.1 YEAR 类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-DATE-%E7%B1%BB%E5%9E%8B"><span class="toc-number">11.6.2.</span> <span class="toc-text">6.2 DATE 类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-TIME-%E7%B1%BB%E5%9E%8B"><span class="toc-number">11.6.3.</span> <span class="toc-text">6.3 TIME 类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-DATETIME-%E7%B1%BB%E5%9E%8B"><span class="toc-number">11.6.4.</span> <span class="toc-text">6.4 DATETIME 类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-5-TIMESTAMP-%E7%B1%BB%E5%9E%8B"><span class="toc-number">11.6.5.</span> <span class="toc-text">6.5 TIMESTAMP 类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-6-%E5%BC%80%E5%8F%91%E4%B8%AD%E7%BB%8F%E9%AA%8C"><span class="toc-number">11.6.6.</span> <span class="toc-text">6.6 开发中经验</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E6%96%87%E6%9C%AC%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E5%9E%8B"><span class="toc-number">11.7.</span> <span class="toc-text">7. 文本字符串类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-CHAR-%E4%B8%8E-VARCHAR-%E7%B1%BB%E5%9E%8B"><span class="toc-number">11.7.1.</span> <span class="toc-text">7.1 CHAR 与 VARCHAR 类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-TEXT-%E7%B1%BB%E5%9E%8B"><span class="toc-number">11.7.2.</span> <span class="toc-text">7.2 TEXT 类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-ENUM-%E7%B1%BB%E5%9E%8B"><span class="toc-number">11.8.</span> <span class="toc-text">8. ENUM 类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-SET-%E7%B1%BB%E5%9E%8B"><span class="toc-number">11.9.</span> <span class="toc-text">9. SET 类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E5%9E%8B"><span class="toc-number">11.10.</span> <span class="toc-text">10. 二进制字符串类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-JSON-%E7%B1%BB%E5%9E%8B"><span class="toc-number">11.11.</span> <span class="toc-text">11. JSON 类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-%E7%A9%BA%E9%97%B4%E7%B1%BB%E5%9E%8B"><span class="toc-number">11.12.</span> <span class="toc-text">12. 空间类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-%E5%B0%8F%E7%BB%93%E5%8F%8A%E9%80%89%E6%8B%A9%E5%BB%BA%E8%AE%AE"><span class="toc-number">11.13.</span> <span class="toc-text">13. 小结及选择建议</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81%E7%BA%A6%E6%9D%9F"><span class="toc-number">12.</span> <span class="toc-text">十二、约束</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%BA%A6%E6%9D%9F-constraint-%E6%A6%82%E8%BF%B0"><span class="toc-number">12.1.</span> <span class="toc-text">1. 约束 (constraint) 概述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E7%BA%A6%E6%9D%9F"><span class="toc-number">12.1.1.</span> <span class="toc-text">1.1 为什么需要约束</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%A6%E6%9D%9F"><span class="toc-number">12.1.2.</span> <span class="toc-text">1.2 什么是约束</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E7%BA%A6%E6%9D%9F%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">12.1.3.</span> <span class="toc-text">1.3 约束的分类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%9D%9E%E7%A9%BA%E7%BA%A6%E6%9D%9F"><span class="toc-number">12.2.</span> <span class="toc-text">2.非空约束</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E4%BD%9C%E7%94%A8"><span class="toc-number">12.2.1.</span> <span class="toc-text">2.1 作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">12.2.2.</span> <span class="toc-text">2.2 关键字</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E7%89%B9%E7%82%B9"><span class="toc-number">12.2.3.</span> <span class="toc-text">2.3 特点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-%E6%B7%BB%E5%8A%A0%E9%9D%9E%E7%A9%BA%E7%BA%A6%E6%9D%9F"><span class="toc-number">12.2.4.</span> <span class="toc-text">2.4 添加非空约束</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-%E5%88%A0%E9%99%A4%E9%9D%9E%E7%A9%BA%E7%BA%A6%E6%9D%9F"><span class="toc-number">12.2.5.</span> <span class="toc-text">2.5 删除非空约束</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%94%AF%E4%B8%80%E6%80%A7%E7%BA%A6%E6%9D%9F"><span class="toc-number">12.3.</span> <span class="toc-text">3. 唯一性约束</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E4%BD%9C%E7%94%A8"><span class="toc-number">12.3.1.</span> <span class="toc-text">3.1 作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">12.3.2.</span> <span class="toc-text">3.2 关键字</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E7%89%B9%E7%82%B9"><span class="toc-number">12.3.3.</span> <span class="toc-text">3.3 特点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-%E6%B7%BB%E5%8A%A0%E5%94%AF%E4%B8%80%E7%BA%A6%E6%9D%9F"><span class="toc-number">12.3.4.</span> <span class="toc-text">3.4 添加唯一约束</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-%E5%85%B3%E4%BA%8E%E5%A4%8D%E5%90%88%E5%94%AF%E4%B8%80%E7%BA%A6%E6%9D%9F"><span class="toc-number">12.3.5.</span> <span class="toc-text">3.5 关于复合唯一约束</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-%E5%88%A0%E9%99%A4%E5%94%AF%E4%B8%80%E7%BA%A6%E6%9D%9F"><span class="toc-number">12.3.6.</span> <span class="toc-text">3.6 删除唯一约束</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%B8%BB%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">12.4.</span> <span class="toc-text">4. 主键约束</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E4%BD%9C%E7%94%A8"><span class="toc-number">12.4.1.</span> <span class="toc-text">4.1 作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">12.4.2.</span> <span class="toc-text">4.2 关键字</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-%E7%89%B9%E7%82%B9"><span class="toc-number">12.4.3.</span> <span class="toc-text">4.3 特点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-%E6%B7%BB%E5%8A%A0%E4%B8%BB%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">12.4.4.</span> <span class="toc-text">4.4 添加主键约束</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5-%E5%88%A0%E9%99%A4%E4%B8%BB%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">12.4.5.</span> <span class="toc-text">4.5 删除主键约束</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E8%87%AA%E5%A2%9E%E5%88%97"><span class="toc-number">12.5.</span> <span class="toc-text">5. 自增列</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-%E4%BD%9C%E7%94%A8"><span class="toc-number">12.5.1.</span> <span class="toc-text">5.1 作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">12.5.2.</span> <span class="toc-text">5.2 关键字</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-%E7%89%B9%E7%82%B9%E5%92%8C%E8%A6%81%E6%B1%82"><span class="toc-number">12.5.3.</span> <span class="toc-text">5.3 特点和要求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-%E6%8C%87%E5%AE%9A%E8%87%AA%E5%A2%9E%E7%BA%A6%E6%9D%9F"><span class="toc-number">12.5.4.</span> <span class="toc-text">5.4 指定自增约束</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-%E5%88%A0%E9%99%A4%E8%87%AA%E5%A2%9E%E7%BA%A6%E6%9D%9F"><span class="toc-number">12.5.5.</span> <span class="toc-text">5.5 删除自增约束</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-6-MySQL-8-0-%E6%96%B0%E7%89%B9%E6%80%A7%E2%80%94%E2%80%94%E8%87%AA%E5%A2%9E%E5%8F%98%E9%87%8F%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">12.5.6.</span> <span class="toc-text">5.6 MySQL 8.0 新特性——自增变量的持久化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">12.6.</span> <span class="toc-text">6. 外键约束</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-%E4%BD%9C%E7%94%A8"><span class="toc-number">12.6.1.</span> <span class="toc-text">6.1 作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">12.6.2.</span> <span class="toc-text">6.2 关键字</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-%E4%B8%BB%E8%A1%A8%E5%92%8C%E4%BB%8E%E8%A1%A8-x2F-%E7%88%B6%E8%A1%A8%E5%92%8C%E5%AD%90%E8%A1%A8"><span class="toc-number">12.6.3.</span> <span class="toc-text">6.3 主表和从表&#x2F;父表和子表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-%E7%89%B9%E7%82%B9"><span class="toc-number">12.6.4.</span> <span class="toc-text">6.4 特点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-5-%E6%B7%BB%E5%8A%A0%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">12.6.5.</span> <span class="toc-text">6.5 添加外键约束</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-6-%E7%BA%A6%E6%9D%9F%E7%AD%89%E7%BA%A7"><span class="toc-number">12.6.6.</span> <span class="toc-text">6.6 约束等级</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-7-%E5%88%A0%E9%99%A4%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">12.6.7.</span> <span class="toc-text">6.7 删除外键约束</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-8-%E5%BC%80%E5%8F%91%E5%9C%BA%E6%99%AF"><span class="toc-number">12.6.8.</span> <span class="toc-text">6.8 开发场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-9-%E9%98%BF%E9%87%8C%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83"><span class="toc-number">12.6.9.</span> <span class="toc-text">6.9 阿里开发规范</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-CHECK-%E7%BA%A6%E6%9D%9F"><span class="toc-number">12.7.</span> <span class="toc-text">7. CHECK 约束</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-%E4%BD%9C%E7%94%A8"><span class="toc-number">12.7.1.</span> <span class="toc-text">7.1 作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">12.7.2.</span> <span class="toc-text">7.2 关键字</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-%E8%AF%B4%E6%98%8E%EF%BC%9AMySQL-5-7-%E4%B8%8D%E6%94%AF%E6%8C%81"><span class="toc-number">12.7.3.</span> <span class="toc-text">7.3 说明：MySQL 5.7 不支持</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-DEFAULT-%E7%BA%A6%E6%9D%9F"><span class="toc-number">12.8.</span> <span class="toc-text">8. DEFAULT 约束</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-%E4%BD%9C%E7%94%A8"><span class="toc-number">12.8.1.</span> <span class="toc-text">8.1 作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">12.8.2.</span> <span class="toc-text">8.2 关键字</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-%E5%A6%82%E6%9E%9C%E7%BB%99%E5%AD%97%E6%AE%B5%E5%8A%A0%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="toc-number">12.8.3.</span> <span class="toc-text">8.3 如果给字段加默认值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-4-%E5%88%A0%E9%99%A4%E9%BB%98%E8%AE%A4%E5%80%BC%E7%BA%A6%E6%9D%9F"><span class="toc-number">12.8.4.</span> <span class="toc-text">8.4 删除默认值约束</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-%E9%9D%A2%E8%AF%95%E9%A2%98"><span class="toc-number">12.9.</span> <span class="toc-text">9. 面试题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%89%E3%80%81%E8%A7%86%E5%9B%BE"><span class="toc-number">13.</span> <span class="toc-text">十三、视图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%B9%E8%B1%A1"><span class="toc-number">13.1.</span> <span class="toc-text">1. 常见的数据库对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%A7%86%E5%9B%BE%E6%A6%82%E8%BF%B0"><span class="toc-number">13.2.</span> <span class="toc-text">2. 视图概述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8%E8%A7%86%E5%9B%BE%EF%BC%9F"><span class="toc-number">13.2.1.</span> <span class="toc-text">2.1 为什么使用视图？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E8%A7%86%E5%9B%BE%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-number">13.2.2.</span> <span class="toc-text">2.2 视图的理解</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%88%9B%E5%BB%BA%E8%A7%86%E5%9B%BE"><span class="toc-number">13.3.</span> <span class="toc-text">3. 创建视图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E5%88%9B%E5%BB%BA%E5%8D%95%E8%A1%A8%E8%A7%86%E5%9B%BE"><span class="toc-number">13.3.1.</span> <span class="toc-text">3.1 创建单表视图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E5%88%9B%E5%BB%BA%E5%A4%9A%E8%A1%A8%E8%A7%86%E5%9B%BE"><span class="toc-number">13.3.2.</span> <span class="toc-text">3.2 创建多表视图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E5%9F%BA%E4%BA%8E%E8%A7%86%E5%9B%BE%E5%88%9B%E5%BB%BA%E8%A7%86%E5%9B%BE"><span class="toc-number">13.3.3.</span> <span class="toc-text">3.3 基于视图创建视图</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%9F%A5%E7%9C%8B%E8%A7%86%E5%9B%BE"><span class="toc-number">13.4.</span> <span class="toc-text">4. 查看视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E4%BF%AE%E6%94%B9%E8%A7%86%E5%9B%BE%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-number">13.5.</span> <span class="toc-text">5. 修改视图的数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-%E4%B8%80%E8%88%AC%E6%83%85%E5%86%B5"><span class="toc-number">13.5.1.</span> <span class="toc-text">5.1 一般情况</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-%E4%B8%8D%E5%8F%AF%E6%9B%B4%E6%96%B0%E7%9A%84%E8%A7%86%E5%9B%BE"><span class="toc-number">13.5.2.</span> <span class="toc-text">5.2 不可更新的视图</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E4%BF%AE%E6%94%B9%E3%80%81%E5%88%A0%E9%99%A4%E8%A7%86%E5%9B%BE"><span class="toc-number">13.6.</span> <span class="toc-text">6. 修改、删除视图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-%E4%BF%AE%E6%94%B9%E8%A7%86%E5%9B%BE"><span class="toc-number">13.6.1.</span> <span class="toc-text">6.1 修改视图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-%E5%88%A0%E9%99%A4%E8%A7%86%E5%9B%BE"><span class="toc-number">13.6.2.</span> <span class="toc-text">6.2 删除视图</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E6%80%BB%E7%BB%93"><span class="toc-number">13.7.</span> <span class="toc-text">7. 总结</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-%E8%A7%86%E5%9B%BE%E4%BC%98%E7%82%B9"><span class="toc-number">13.7.1.</span> <span class="toc-text">7.1 视图优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-%E8%A7%86%E5%9B%BE%E4%B8%8D%E8%B6%B3"><span class="toc-number">13.7.2.</span> <span class="toc-text">7.2 视图不足</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E5%9B%9B%E3%80%81%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%B8%8E%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0"><span class="toc-number">14.</span> <span class="toc-text">十四、存储过程与存储函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E6%A6%82%E8%BF%B0"><span class="toc-number">14.1.</span> <span class="toc-text">1. 存储过程概述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E7%90%86%E8%A7%A3"><span class="toc-number">14.1.1.</span> <span class="toc-text">1.1 理解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E5%88%86%E7%B1%BB"><span class="toc-number">14.1.2.</span> <span class="toc-text">1.2 分类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">14.2.</span> <span class="toc-text">2. 创建存储过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90"><span class="toc-number">14.2.1.</span> <span class="toc-text">2.1 语法分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E8%B0%83%E7%94%A8"><span class="toc-number">14.3.</span> <span class="toc-text">3. 存储过程调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">14.4.</span> <span class="toc-text">4. 存储函数的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90"><span class="toc-number">14.4.1.</span> <span class="toc-text">4.1 语法分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E8%B0%83%E7%94%A8%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0"><span class="toc-number">14.4.2.</span> <span class="toc-text">4.2 调用存储函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-%E5%AF%B9%E6%AF%94%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0%E5%92%8C%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">14.4.3.</span> <span class="toc-text">4.3 对比存储函数和存储过程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%92%8C%E5%87%BD%E6%95%B0%E7%9A%84%E6%9F%A5%E7%9C%8B%E3%80%81%E4%BF%AE%E6%94%B9%E3%80%81%E5%88%A0%E9%99%A4"><span class="toc-number">14.5.</span> <span class="toc-text">5. 存储过程和函数的查看、修改、删除</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-%E6%9F%A5%E7%9C%8B"><span class="toc-number">14.5.1.</span> <span class="toc-text">5.1 查看</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-%E4%BF%AE%E6%94%B9"><span class="toc-number">14.5.2.</span> <span class="toc-text">5.2 修改</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-%E5%88%A0%E9%99%A4"><span class="toc-number">14.5.3.</span> <span class="toc-text">5.3 删除</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%85%B3%E4%BA%8E%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%92%8C%E5%87%BD%E6%95%B0%E4%BD%BF%E7%94%A8%E7%9A%84%E4%BA%89%E8%AE%AE"><span class="toc-number">14.6.</span> <span class="toc-text">6. 关于存储过程和函数使用的争议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-%E4%BC%98%E7%82%B9"><span class="toc-number">14.6.1.</span> <span class="toc-text">6.1 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-%E7%BC%BA%E7%82%B9"><span class="toc-number">14.6.2.</span> <span class="toc-text">6.2 缺点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%BA%94%E3%80%81%E5%8F%98%E9%87%8F%E3%80%81%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E4%B8%8E%E6%B8%B8%E6%A0%87"><span class="toc-number">15.</span> <span class="toc-text">十五、变量、流程控制与游标</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%8F%98%E9%87%8F"><span class="toc-number">15.1.</span> <span class="toc-text">1. 变量</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E7%B3%BB%E7%BB%9F%E5%8F%98%E9%87%8F"><span class="toc-number">15.1.1.</span> <span class="toc-text">1.1 系统变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E7%94%A8%E6%88%B7%E5%8F%98%E9%87%8F"><span class="toc-number">15.1.2.</span> <span class="toc-text">1.2 用户变量</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AE%9A%E4%B9%89%E6%9D%A1%E4%BB%B6%E4%B8%8E%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F"><span class="toc-number">15.2.</span> <span class="toc-text">2. 定义条件与处理程序</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E5%AE%9A%E4%B9%89%E6%9D%A1%E4%BB%B6"><span class="toc-number">15.2.1.</span> <span class="toc-text">2.1 定义条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E5%AE%9A%E4%B9%89%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F"><span class="toc-number">15.2.2.</span> <span class="toc-text">2.2 定义处理程序</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6"><span class="toc-number">15.3.</span> <span class="toc-text">3. 流程控制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E5%88%86%E6%94%AF%E7%BB%93%E6%9E%84%E4%B9%8B-IF"><span class="toc-number">15.3.1.</span> <span class="toc-text">3.1 分支结构之 IF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E5%88%86%E6%94%AF%E7%BB%93%E6%9E%84%E4%B9%8B-CASE"><span class="toc-number">15.3.2.</span> <span class="toc-text">3.2 分支结构之 CASE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E5%BE%AA%E7%8E%AF%E7%BB%93%E6%9E%84%E5%80%BC-LOOP"><span class="toc-number">15.3.3.</span> <span class="toc-text">3.3 循环结构值 LOOP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-%E5%BE%AA%E7%8E%AF%E7%BB%93%E6%9E%84%E4%B9%8B-WHILE"><span class="toc-number">15.3.4.</span> <span class="toc-text">3.4 循环结构之 WHILE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-%E5%BE%AA%E7%8E%AF%E7%BB%93%E6%9E%84%E4%B9%8B-REPEAT"><span class="toc-number">15.3.5.</span> <span class="toc-text">3.5 循环结构之 REPEAT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-%E8%B7%B3%E8%BD%AC%E8%AF%AD%E5%8F%A5%E4%B9%8B-LEAVE-%E8%AF%AD%E5%8F%A5"><span class="toc-number">15.3.6.</span> <span class="toc-text">3.6 跳转语句之 LEAVE 语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-%E8%B7%B3%E8%BD%AC%E8%AF%AD%E5%8F%A5%E4%B9%8B-ITERATE-%E8%AF%AD%E5%8F%A5"><span class="toc-number">15.3.7.</span> <span class="toc-text">3.7 跳转语句之 ITERATE 语句</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%B8%B8%E6%A0%87"><span class="toc-number">15.4.</span> <span class="toc-text">4. 游标</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E4%BB%80%E4%B9%88%E6%98%AF%E6%B8%B8%E6%A0%87-%E6%88%96%E5%85%89%E6%A0%87"><span class="toc-number">15.4.1.</span> <span class="toc-text">4.1 什么是游标 (或光标)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E4%BD%BF%E7%94%A8%E6%B8%B8%E6%A0%87%E7%9A%84%E6%AD%A5%E9%AA%A4"><span class="toc-number">15.4.2.</span> <span class="toc-text">4.2 使用游标的步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-%E5%B0%8F%E7%BB%93"><span class="toc-number">15.4.3.</span> <span class="toc-text">4.3 小结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-MySQL-8-0-%E7%9A%84%E6%96%B0%E7%89%B9%E6%80%A7%E2%80%94%E2%80%94%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">15.5.</span> <span class="toc-text">5. MySQL 8.0 的新特性——全局变量的持久化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E5%85%AD%E3%80%81%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">16.</span> <span class="toc-text">十六、触发器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%A7%A6%E5%8F%91%E5%99%A8%E7%9A%84%E6%A6%82%E8%BF%B0"><span class="toc-number">16.1.</span> <span class="toc-text">1. 触发器的概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%A7%A6%E5%8F%91%E5%99%A8%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="toc-number">16.2.</span> <span class="toc-text">2. 触发器的创建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E5%88%9B%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8%E8%AF%AD%E6%B3%95"><span class="toc-number">16.2.1.</span> <span class="toc-text">2.1 创建触发器语法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%9F%A5%E7%9C%8B%E3%80%81%E5%88%A0%E9%99%A4%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">16.3.</span> <span class="toc-text">3. 查看、删除触发器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E6%9F%A5%E7%9C%8B%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">16.3.1.</span> <span class="toc-text">3.1 查看触发器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E5%88%A0%E9%99%A4%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">16.3.2.</span> <span class="toc-text">3.2 删除触发器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E8%A7%A6%E5%8F%91%E5%99%A8%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">16.4.</span> <span class="toc-text">4. 触发器的优缺点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E4%BC%98%E7%82%B9"><span class="toc-number">16.4.1.</span> <span class="toc-text">4.1 优点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E7%BC%BA%E7%82%B9"><span class="toc-number">16.4.2.</span> <span class="toc-text">4.2 缺点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="toc-number">16.4.3.</span> <span class="toc-text">4.3 注意点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%83%E3%80%81MySQL-8-%E5%85%B6%E5%AE%83%E6%96%B0%E7%89%B9%E6%80%A7"><span class="toc-number">17.</span> <span class="toc-text">十七、MySQL 8 其它新特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-MySQL-8-%E6%96%B0%E7%89%B9%E6%80%A7%E6%A6%82%E8%BF%B0"><span class="toc-number">17.1.</span> <span class="toc-text">1. MySQL 8 新特性概述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-MySQ-L-8-0-%E6%96%B0%E5%A2%9E%E7%89%B9%E6%80%A7"><span class="toc-number">17.1.1.</span> <span class="toc-text">1.1 MySQ L 8.0 新增特性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-MySQL-8-0-%E7%A7%BB%E9%99%A4%E7%9A%84%E6%97%A7%E7%89%B9%E6%80%A7"><span class="toc-number">17.1.2.</span> <span class="toc-text">1.2 MySQL 8.0 移除的旧特性</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0"><span class="toc-number">17.2.</span> <span class="toc-text">2. 窗口函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0%E5%88%86%E7%B1%BB"><span class="toc-number">17.2.1.</span> <span class="toc-text">2.1 窗口函数分类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E8%AF%AD%E6%B3%95%E7%BB%93%E6%9E%84"><span class="toc-number">17.2.2.</span> <span class="toc-text">2.2 语法结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E5%88%86%E7%B1%BB%E8%AE%B2%E8%A7%A3"><span class="toc-number">17.2.3.</span> <span class="toc-text">2.3 分类讲解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-%E5%B0%8F%E7%BB%93"><span class="toc-number">17.2.4.</span> <span class="toc-text">2.4 小结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%96%B0%E7%89%B9%E6%80%A72-%E5%85%AC%E7%94%A8%E8%A1%A8%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">17.3.</span> <span class="toc-text">3. 新特性2: 公用表表达式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E6%99%AE%E9%80%9A%E5%85%AC%E7%94%A8%E8%A1%A8%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">17.3.1.</span> <span class="toc-text">3.1 普通公用表表达式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E9%80%92%E5%BD%92%E5%85%AC%E7%94%A8%E8%A1%A8%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">17.3.2.</span> <span class="toc-text">3.2 递归公用表表达式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E5%B0%8F%E7%BB%93"><span class="toc-number">17.3.3.</span> <span class="toc-text">3.3 小结</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023 By Zhang Jian</div><div class="footer_custom_text">I wish you to become your own sun, no need to rely on who's light.<p><a target="_blank" href="https://hexo.io/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="博客框架为Hexo"></a>&nbsp;<a target="_blank" href="https://butterfly.js.org/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="主题采用butterfly"></a>&nbsp;<a target="_blank" href="https://www.jsdelivr.com/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&logo=jsDelivr" title="本站使用JsDelivr为静态资源提供CDN加速"></a> &nbsp;<a target="_blank" href="https://vercel.com/ "><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Hosted-Vervel-brightgreen?style=flat&logo=Vercel" title="本站采用双线部署，默认线路托管于Vercel"></a>&nbsp;<a target="_blank" href="https://vercel.com/ "><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Hosted-Coding-0cedbe?style=flat&logo=Codio" title="本站采用双线部署，联通线路托管于Coding"></a>&nbsp;<a target="_blank" href="https://github.com/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="本站项目由Gtihub托管"></a>&nbsp;<a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a></p></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script defer src="/js/light.js"></script><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="30" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
    function butterfly_categories_card_injector_config(){
      var parent_div_git = document.getElementById('recent-posts');
      var item_html = '<style>li.categoryBar-list-item{width:32.3%;}.categoryBar-list{max-height: 570px;overflow:auto;}.categoryBar-list::-webkit-scrollbar{width:0!important}@media screen and (max-width: 650px){.categoryBar-list{max-height: 480px;}}</style><div class="recent-post-item" style="height:auto;width:100%;padding:0px;"><div id="categoryBar"><ul class="categoryBar-list"><li class="categoryBar-list-item" style="background:url(http://1.117.162.142:9000/blog/cover1.webp);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/DXC-实习/&quot;);" href="javascript:void(0);">DXC 实习</a><span class="categoryBar-list-count">1</span><span class="categoryBar-list-descr">Spring 全家桶</span></li><li class="categoryBar-list-item" style="background:url(http://1.117.162.142:9000/blog/cover2.webp);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/Linux/&quot;);" href="javascript:void(0);">Linux</a><span class="categoryBar-list-count">1</span><span class="categoryBar-list-descr">Linux 操作系统</span></li><li class="categoryBar-list-item" style="background:url(http://1.117.162.142:9000/blog/cover3.webp);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/Spring/&quot;);" href="javascript:void(0);">Spring</a><span class="categoryBar-list-count">1</span><span class="categoryBar-list-descr">计算机网络知识体系</span></li><li class="categoryBar-list-item" style="background:url(http://1.117.162.142:9000/blog/cover4.webp);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/计算机网络/&quot;);" href="javascript:void(0);">计算机网络</a><span class="categoryBar-list-count">1</span><span class="categoryBar-list-descr">其他文档集合</span></li><li class="categoryBar-list-item" style="background:url(http://1.117.162.142:9000/blog/cover5.webp);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/其他/&quot;);" href="javascript:void(0);">其他</a><span class="categoryBar-list-count">2</span><span class="categoryBar-list-descr">Java 知识</span></li><li class="categoryBar-list-item" style="background:url(http://1.117.162.142:9000/blog/cover6.webp);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/Java/&quot;);" href="javascript:void(0);">Java</a><span class="categoryBar-list-count">4</span><span class="categoryBar-list-descr">数据结构与算法</span></li><li class="categoryBar-list-item" style="background:url(http://1.117.162.142:9000/blog/cover1.webp);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/数据结构与算法/&quot;);" href="javascript:void(0);">数据结构与算法</a><span class="categoryBar-list-count">1</span><span class="categoryBar-list-descr">海量中间件</span></li><li class="categoryBar-list-item" style="background:url(http://1.117.162.142:9000/blog/cover2.webp);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/中间件/&quot;);" href="javascript:void(0);">中间件</a><span class="categoryBar-list-count">1</span><span class="categoryBar-list-descr">关系型数据库和非关系型数据库</span></li><li class="categoryBar-list-item" style="background:url(http://1.117.162.142:9000/blog/cover3.webp);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/操作系统/&quot;);" href="javascript:void(0);">操作系统</a><span class="categoryBar-list-count">1</span><span class="categoryBar-list-descr">操作系统知识</span></li><li class="categoryBar-list-item" style="background:url(undefined);"> <a class="categoryBar-list-link" onclick="pjax.loadUrl(&quot;categories/数据库/&quot;);" href="javascript:void(0);">数据库</a><span class="categoryBar-list-count">2</span><span class="categoryBar-list-descr"></span></li></ul></div></div>';
      console.log('已挂载butterfly_categories_card')
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      }
    if( document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    butterfly_categories_card_injector_config()
    }
  </script><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var qweather_key = 'd8ef7a65db7c4006a56ac333e3160913';
  var gaud_map_key = 'b08b224a212eea586a32bbcc5605bbe4';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '113.34532,23.15624';
  var clock_default_rectangle_enable = 'false';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.js"></script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;2022/11/28/kafka/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://1.117.162.142:9000/blog/cover.jpeg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-11-28</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;2022/11/28/kafka/&quot;);" href="javascript:void(0);" alt="">Kafka</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;2022/11/28/kafka/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><script data-pjax src="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.js"></script><script data-pjax>
  function gitcalendar_injector_config(){
      var parent_div_git = document.getElementById('gitZone');
      var item_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 280px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>';
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      console.log('已挂载gitcalendar')
      }

    if( document.getElementById('gitZone') && (location.pathname ==='/about/'|| '/about/' ==='all')){
        gitcalendar_injector_config()
        GitCalendarInit("https://gitcalendar.fomal.cc/api?zhangjianGorilla",['#d9e0df', '#c6e0dc', '#a8dcd4', '#9adcd2', '#89ded1', '#77e0d0', '#5fdecb', '#47dcc6', '#39dcc3', '#1fdabe', '#00dab9'],'zhangjianGorilla')
    }
  </script><!-- hexo injector body_end end --></body></html>